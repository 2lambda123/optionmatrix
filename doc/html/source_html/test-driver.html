<!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><i><font color="#9A1900">#! /bin/sh</font></i>
<i><font color="#9A1900"># test-driver - basic testsuite driver script.</font></i>

<font color="#009900">scriptversion</font><font color="#990000">=</font><font color="#993399">2013</font>-<font color="#993399">07</font>-<font color="#993399">13.22</font><font color="#990000">;</font> <i><font color="#9A1900"># UTC</font></i>

<i><font color="#9A1900"># Copyright (C) 2011-2013 Free Software Foundation, Inc.</font></i>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># This program is free software; you can redistribute it and/or modify</font></i>
<i><font color="#9A1900"># it under the terms of the GNU General Public License as published by</font></i>
<i><font color="#9A1900"># the Free Software Foundation; either version 2, or (at your option)</font></i>
<i><font color="#9A1900"># any later version.</font></i>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># This program is distributed in the hope that it will be useful,</font></i>
<i><font color="#9A1900"># but WITHOUT ANY WARRANTY; without even the implied warranty of</font></i>
<i><font color="#9A1900"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</font></i>
<i><font color="#9A1900"># GNU General Public License for more details.</font></i>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># You should have received a copy of the GNU General Public License</font></i>
<i><font color="#9A1900"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</font></i>

<i><font color="#9A1900"># As a special exception to the GNU General Public License, if you</font></i>
<i><font color="#9A1900"># distribute this file as part of a program that contains a</font></i>
<i><font color="#9A1900"># configuration script generated by Autoconf, you may include it under</font></i>
<i><font color="#9A1900"># the same distribution terms that you use for the rest of that program.</font></i>

<i><font color="#9A1900"># This file is maintained in Automake, please report</font></i>
<i><font color="#9A1900"># bugs to &lt;bug-automake@gnu.org&gt; or send patches to</font></i>
<i><font color="#9A1900"># &lt;automake-patches@gnu.org&gt;.</font></i>

<i><font color="#9A1900"># Make unconditional expansion of undefined variables an error.  This</font></i>
<i><font color="#9A1900"># helps a lot in preventing typo-related bugs.</font></i>
<b><font color="#0000FF">set</font></b> -u

<b><font color="#000000">usage_error ()</font></b>
{
  echo <font color="#FF0000">"$0: $*"</font> <font color="#990000">&gt;&amp;</font><font color="#993399">2</font>
  print_usage <font color="#990000">&gt;&amp;</font><font color="#993399">2</font>
  <b><font color="#0000FF">exit</font></b> <font color="#993399">2</font>
}

<b><font color="#000000">print_usage ()</font></b>
{
  cat <font color="#990000">&lt;&lt;</font>END
Usage<font color="#990000">:</font>
  test-driver --test-name<font color="#990000">=</font>NAME --log-file<font color="#990000">=</font>PATH --trs-file<font color="#990000">=</font>PATH
              <font color="#990000">[</font>--expect-failure<font color="#990000">=</font>{yes<font color="#990000">|</font>no}<font color="#990000">]</font> <font color="#990000">[</font>--color-tests<font color="#990000">=</font>{yes<font color="#990000">|</font>no}<font color="#990000">]</font>
              <font color="#990000">[</font>--enable-hard-errors<font color="#990000">=</font>{yes<font color="#990000">|</font>no}<font color="#990000">]</font> <font color="#990000">[</font>--<font color="#990000">]</font>
              TEST-SCRIPT <font color="#990000">[</font>TEST-SCRIPT-ARGUMENTS<font color="#990000">]</font>
The <font color="#FF0000">'--test-name'</font><font color="#990000">,</font> <font color="#FF0000">'--log-file'</font> and <font color="#FF0000">'--trs-file'</font> options are mandatory<font color="#990000">.</font>
END
}

<font color="#009900">test_name</font><font color="#990000">=</font> <i><font color="#9A1900"># Used for reporting.</font></i>
<font color="#009900">log_file</font><font color="#990000">=</font>  <i><font color="#9A1900"># Where to save the output of the test script.</font></i>
<font color="#009900">trs_file</font><font color="#990000">=</font>  <i><font color="#9A1900"># Where to save the metadata of the test run.</font></i>
<font color="#009900">expect_failure</font><font color="#990000">=</font>no
<font color="#009900">color_tests</font><font color="#990000">=</font>no
<font color="#009900">enable_hard_errors</font><font color="#990000">=</font>yes
<b><font color="#0000FF">while</font></b> <b><font color="#0000FF">test</font></b> <font color="#009900">$#</font> -gt <font color="#993399">0</font><font color="#990000">;</font> <b><font color="#0000FF">do</font></b>
  <b><font color="#0000FF">case</font></b> <font color="#009900">$1</font> <b><font color="#0000FF">in</font></b>
  --help<font color="#990000">)</font> print_usage<font color="#990000">;</font> <b><font color="#0000FF">exit</font></b> <font color="#009900">$?</font><font color="#990000">;;</font>
  --version<font color="#990000">)</font> echo <font color="#FF0000">"test-driver $scriptversion"</font><font color="#990000">;</font> <b><font color="#0000FF">exit</font></b> <font color="#009900">$?</font><font color="#990000">;;</font>
  --test-name<font color="#990000">)</font> <font color="#009900">test_name</font><font color="#990000">=</font><font color="#009900">$2</font><font color="#990000">;</font> <b><font color="#0000FF">shift</font></b><font color="#990000">;;</font>
  --log-file<font color="#990000">)</font> <font color="#009900">log_file</font><font color="#990000">=</font><font color="#009900">$2</font><font color="#990000">;</font> <b><font color="#0000FF">shift</font></b><font color="#990000">;;</font>
  --trs-file<font color="#990000">)</font> <font color="#009900">trs_file</font><font color="#990000">=</font><font color="#009900">$2</font><font color="#990000">;</font> <b><font color="#0000FF">shift</font></b><font color="#990000">;;</font>
  --color-tests<font color="#990000">)</font> <font color="#009900">color_tests</font><font color="#990000">=</font><font color="#009900">$2</font><font color="#990000">;</font> <b><font color="#0000FF">shift</font></b><font color="#990000">;;</font>
  --expect-failure<font color="#990000">)</font> <font color="#009900">expect_failure</font><font color="#990000">=</font><font color="#009900">$2</font><font color="#990000">;</font> <b><font color="#0000FF">shift</font></b><font color="#990000">;;</font>
  --enable-hard-errors<font color="#990000">)</font> <font color="#009900">enable_hard_errors</font><font color="#990000">=</font><font color="#009900">$2</font><font color="#990000">;</font> <b><font color="#0000FF">shift</font></b><font color="#990000">;;</font>
  --<font color="#990000">)</font> <b><font color="#0000FF">shift</font></b><font color="#990000">;</font> <b><font color="#0000FF">break</font></b><font color="#990000">;;</font>
  -<font color="#990000">*)</font> usage_error <font color="#FF0000">"invalid option: '$1'"</font><font color="#990000">;;</font>
   <font color="#990000">*)</font> <b><font color="#0000FF">break</font></b><font color="#990000">;;</font>
  <b><font color="#0000FF">esac</font></b>
  <b><font color="#0000FF">shift</font></b>
<b><font color="#0000FF">done</font></b>

<font color="#009900">missing_opts</font><font color="#990000">=</font>
<b><font color="#0000FF">test</font></b> x<font color="#FF0000">"$test_name"</font> <font color="#990000">=</font> x <font color="#990000">&amp;&amp;</font> <font color="#009900">missing_opts</font><font color="#990000">=</font><font color="#FF0000">"$missing_opts --test-name"</font>
<b><font color="#0000FF">test</font></b> x<font color="#FF0000">"$log_file"</font>  <font color="#990000">=</font> x <font color="#990000">&amp;&amp;</font> <font color="#009900">missing_opts</font><font color="#990000">=</font><font color="#FF0000">"$missing_opts --log-file"</font>
<b><font color="#0000FF">test</font></b> x<font color="#FF0000">"$trs_file"</font>  <font color="#990000">=</font> x <font color="#990000">&amp;&amp;</font> <font color="#009900">missing_opts</font><font color="#990000">=</font><font color="#FF0000">"$missing_opts --trs-file"</font>
<b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> x<font color="#FF0000">"$missing_opts"</font> <font color="#990000">!=</font> x<font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
  usage_error <font color="#FF0000">"the following mandatory options are missing:$missing_opts"</font>
<b><font color="#0000FF">fi</font></b>

<b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> <font color="#009900">$#</font> -eq <font color="#993399">0</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
  usage_error <font color="#FF0000">"missing argument"</font>
<b><font color="#0000FF">fi</font></b>

<b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> <font color="#009900">$color_tests</font> <font color="#990000">=</font> yes<font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
  <i><font color="#9A1900"># Keep this in sync with 'lib/am/check.am:$(am__tty_colors)'.</font></i>
  <font color="#009900">red</font><font color="#990000">=</font><font color="#FF0000">'[0;31m'</font> <i><font color="#9A1900"># Red.</font></i>
  <font color="#009900">grn</font><font color="#990000">=</font><font color="#FF0000">'[0;32m'</font> <i><font color="#9A1900"># Green.</font></i>
  <font color="#009900">lgn</font><font color="#990000">=</font><font color="#FF0000">'[1;32m'</font> <i><font color="#9A1900"># Light green.</font></i>
  <font color="#009900">blu</font><font color="#990000">=</font><font color="#FF0000">'[1;34m'</font> <i><font color="#9A1900"># Blue.</font></i>
  <font color="#009900">mgn</font><font color="#990000">=</font><font color="#FF0000">'[0;35m'</font> <i><font color="#9A1900"># Magenta.</font></i>
  <font color="#009900">std</font><font color="#990000">=</font><font color="#FF0000">'[m'</font>     <i><font color="#9A1900"># No color.</font></i>
<b><font color="#0000FF">else</font></b>
  <font color="#009900">red</font><font color="#990000">=</font> <font color="#009900">grn</font><font color="#990000">=</font> <font color="#009900">lgn</font><font color="#990000">=</font> <font color="#009900">blu</font><font color="#990000">=</font> <font color="#009900">mgn</font><font color="#990000">=</font> <font color="#009900">std</font><font color="#990000">=</font>
<b><font color="#0000FF">fi</font></b>

<font color="#009900">do_exit</font><font color="#990000">=</font><font color="#FF0000">'rm -f $log_file $trs_file; (exit $st); exit $st'</font>
<b><font color="#0000FF">trap</font></b> <font color="#FF0000">"st=129; $do_exit"</font> <font color="#993399">1</font>
<b><font color="#0000FF">trap</font></b> <font color="#FF0000">"st=130; $do_exit"</font> <font color="#993399">2</font>
<b><font color="#0000FF">trap</font></b> <font color="#FF0000">"st=141; $do_exit"</font> <font color="#993399">13</font>
<b><font color="#0000FF">trap</font></b> <font color="#FF0000">"st=143; $do_exit"</font> <font color="#993399">15</font>

<i><font color="#9A1900"># Test script is run here.</font></i>
<font color="#FF0000">"$@"</font> <font color="#990000">&gt;</font><font color="#009900">$log_file</font> <font color="#993399">2</font><font color="#990000">&gt;&amp;</font><font color="#993399">1</font>
<font color="#009900">estatus</font><font color="#990000">=</font><font color="#009900">$?</font>
<b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> <font color="#009900">$enable_hard_errors</font> <font color="#990000">=</font> no <font color="#990000">&amp;&amp;</font> <b><font color="#0000FF">test</font></b> <font color="#009900">$estatus</font> -eq <font color="#993399">99</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
  <font color="#009900">estatus</font><font color="#990000">=</font><font color="#993399">1</font>
<b><font color="#0000FF">fi</font></b>

<b><font color="#0000FF">case</font></b> <font color="#009900">$estatus</font><font color="#990000">:</font><font color="#009900">$expect_failure</font> <b><font color="#0000FF">in</font></b>
  <font color="#993399">0</font><font color="#990000">:</font>yes<font color="#990000">)</font> <font color="#009900">col</font><font color="#990000">=</font><font color="#009900">$red</font> <font color="#009900">res</font><font color="#990000">=</font>XPASS <font color="#009900">recheck</font><font color="#990000">=</font>yes <font color="#009900">gcopy</font><font color="#990000">=</font>yes<font color="#990000">;;</font>
  <font color="#993399">0</font><font color="#990000">:*)</font>   <font color="#009900">col</font><font color="#990000">=</font><font color="#009900">$grn</font> <font color="#009900">res</font><font color="#990000">=</font>PASS  <font color="#009900">recheck</font><font color="#990000">=</font>no  <font color="#009900">gcopy</font><font color="#990000">=</font>no<font color="#990000">;;</font>
  <font color="#993399">77</font><font color="#990000">:*)</font>  <font color="#009900">col</font><font color="#990000">=</font><font color="#009900">$blu</font> <font color="#009900">res</font><font color="#990000">=</font>SKIP  <font color="#009900">recheck</font><font color="#990000">=</font>no  <font color="#009900">gcopy</font><font color="#990000">=</font>yes<font color="#990000">;;</font>
  <font color="#993399">99</font><font color="#990000">:*)</font>  <font color="#009900">col</font><font color="#990000">=</font><font color="#009900">$mgn</font> <font color="#009900">res</font><font color="#990000">=</font>ERROR <font color="#009900">recheck</font><font color="#990000">=</font>yes <font color="#009900">gcopy</font><font color="#990000">=</font>yes<font color="#990000">;;</font>
  <font color="#990000">*:</font>yes<font color="#990000">)</font> <font color="#009900">col</font><font color="#990000">=</font><font color="#009900">$lgn</font> <font color="#009900">res</font><font color="#990000">=</font>XFAIL <font color="#009900">recheck</font><font color="#990000">=</font>no  <font color="#009900">gcopy</font><font color="#990000">=</font>yes<font color="#990000">;;</font>
  <font color="#990000">*:*)</font>   <font color="#009900">col</font><font color="#990000">=</font><font color="#009900">$red</font> <font color="#009900">res</font><font color="#990000">=</font>FAIL  <font color="#009900">recheck</font><font color="#990000">=</font>yes <font color="#009900">gcopy</font><font color="#990000">=</font>yes<font color="#990000">;;</font>
<b><font color="#0000FF">esac</font></b>

<i><font color="#9A1900"># Report outcome to console.</font></i>
echo <font color="#FF0000">"${col}${res}${std}: $test_name"</font>

<i><font color="#9A1900"># Register the test result, and other relevant metadata.</font></i>
echo <font color="#FF0000">":test-result: $res"</font> <font color="#990000">&gt;</font> <font color="#009900">$trs_file</font>
echo <font color="#FF0000">":global-test-result: $res"</font> <font color="#990000">&gt;&gt;</font> <font color="#009900">$trs_file</font>
echo <font color="#FF0000">":recheck: $recheck"</font> <font color="#990000">&gt;&gt;</font> <font color="#009900">$trs_file</font>
echo <font color="#FF0000">":copy-in-global-log: $gcopy"</font> <font color="#990000">&gt;&gt;</font> <font color="#009900">$trs_file</font>

<i><font color="#9A1900"># Local Variables:</font></i>
<i><font color="#9A1900"># mode: shell-script</font></i>
<i><font color="#9A1900"># sh-indentation: 2</font></i>
<i><font color="#9A1900"># eval: (add-hook 'write-file-hooks 'time-stamp)</font></i>
<i><font color="#9A1900"># time-stamp-start: "scriptversion="</font></i>
<i><font color="#9A1900"># time-stamp-format: "%:y-%02m-%02d.%02H"</font></i>
<i><font color="#9A1900"># time-stamp-time-zone: "UTC"</font></i>
<i><font color="#9A1900"># time-stamp-end: "; # UTC"</font></i>
<i><font color="#9A1900"># End:</font></i>
</tt></pre>
