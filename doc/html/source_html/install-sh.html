<!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><i><font color="#9A1900">#!/bin/sh</font></i>
<i><font color="#9A1900"># install - install a program, script, or datafile</font></i>

<font color="#009900">scriptversion</font><font color="#990000">=</font><font color="#993399">2009</font>-<font color="#993399">04</font>-<font color="#993399">28.21</font><font color="#990000">;</font> <i><font color="#9A1900"># UTC</font></i>

<i><font color="#9A1900"># This originates from X11R5 (mit/util/scripts/install.sh), which was</font></i>
<i><font color="#9A1900"># later released in X11R6 (xc/config/util/install.sh) with the</font></i>
<i><font color="#9A1900"># following copyright and license.</font></i>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># Copyright (C) 1994 X Consortium</font></i>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># Permission is hereby granted, free of charge, to any person obtaining a copy</font></i>
<i><font color="#9A1900"># of this software and associated documentation files (the "Software"), to</font></i>
<i><font color="#9A1900"># deal in the Software without restriction, including without limitation the</font></i>
<i><font color="#9A1900"># rights to use, copy, modify, merge, publish, distribute, sublicense, and/or</font></i>
<i><font color="#9A1900"># sell copies of the Software, and to permit persons to whom the Software is</font></i>
<i><font color="#9A1900"># furnished to do so, subject to the following conditions:</font></i>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># The above copyright notice and this permission notice shall be included in</font></i>
<i><font color="#9A1900"># all copies or substantial portions of the Software.</font></i>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</font></i>
<i><font color="#9A1900"># IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</font></i>
<i><font color="#9A1900"># FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE</font></i>
<i><font color="#9A1900"># X CONSORTIUM BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN</font></i>
<i><font color="#9A1900"># AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNEC-</font></i>
<i><font color="#9A1900"># TION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</font></i>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># Except as contained in this notice, the name of the X Consortium shall not</font></i>
<i><font color="#9A1900"># be used in advertising or otherwise to promote the sale, use or other deal-</font></i>
<i><font color="#9A1900"># ings in this Software without prior written authorization from the X Consor-</font></i>
<i><font color="#9A1900"># tium.</font></i>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># FSF changes to this file are in the public domain.</font></i>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># Calling this script install-sh is preferred over install.sh, to prevent</font></i>
<i><font color="#9A1900"># `make' implicit rules from creating a file called install from it</font></i>
<i><font color="#9A1900"># when there is no Makefile.</font></i>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># This script is compatible with the BSD install script, but was written</font></i>
<i><font color="#9A1900"># from scratch.</font></i>

<font color="#009900">nl</font><font color="#990000">=</font><font color="#FF0000">'</font>
<font color="#FF0000">'</font>
<font color="#009900">IFS</font><font color="#990000">=</font><font color="#FF0000">" ""	$nl"</font>

<i><font color="#9A1900"># set DOITPROG to echo to test this script</font></i>

<i><font color="#9A1900"># Don't use :- since 4.3BSD and earlier shells don't like it.</font></i>
<font color="#009900">doit</font><font color="#990000">=</font><font color="#009900">${DOITPROG-}</font>
<b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> -z <font color="#FF0000">"$doit"</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
  <font color="#009900">doit_exec</font><font color="#990000">=</font><b><font color="#0000FF">exec</font></b>
<b><font color="#0000FF">else</font></b>
  <font color="#009900">doit_exec</font><font color="#990000">=</font><font color="#009900">$doit</font>
<b><font color="#0000FF">fi</font></b>

<i><font color="#9A1900"># Put in absolute file names if you don't have them in your path;</font></i>
<i><font color="#9A1900"># or use environment vars.</font></i>

<font color="#009900">chgrpprog</font><font color="#990000">=</font><font color="#009900">${CHGRPPROG-chgrp}</font>
<font color="#009900">chmodprog</font><font color="#990000">=</font><font color="#009900">${CHMODPROG-chmod}</font>
<font color="#009900">chownprog</font><font color="#990000">=</font><font color="#009900">${CHOWNPROG-chown}</font>
<font color="#009900">cmpprog</font><font color="#990000">=</font><font color="#009900">${CMPPROG-cmp}</font>
<font color="#009900">cpprog</font><font color="#990000">=</font><font color="#009900">${CPPROG-cp}</font>
<font color="#009900">mkdirprog</font><font color="#990000">=</font><font color="#009900">${MKDIRPROG-mkdir}</font>
<font color="#009900">mvprog</font><font color="#990000">=</font><font color="#009900">${MVPROG-mv}</font>
<font color="#009900">rmprog</font><font color="#990000">=</font><font color="#009900">${RMPROG-rm}</font>
<font color="#009900">stripprog</font><font color="#990000">=</font><font color="#009900">${STRIPPROG-strip}</font>

<font color="#009900">posix_glob</font><font color="#990000">=</font><font color="#FF0000">'?'</font>
<font color="#009900">initialize_posix_glob</font><font color="#990000">=</font><font color="#FF0000">'</font>
<font color="#FF0000">  test "$posix_glob" != "?" || {</font>
<font color="#FF0000">    if (set -f) 2&gt;/dev/null; then</font>
<font color="#FF0000">      posix_glob=</font>
<font color="#FF0000">    else</font>
<font color="#FF0000">      posix_glob=:</font>
<font color="#FF0000">    fi</font>
<font color="#FF0000">  }</font>
<font color="#FF0000">'</font>

<font color="#009900">posix_mkdir</font><font color="#990000">=</font>

<i><font color="#9A1900"># Desired mode of installed file.</font></i>
<font color="#009900">mode</font><font color="#990000">=</font><font color="#993399">0755</font>

<font color="#009900">chgrpcmd</font><font color="#990000">=</font>
<font color="#009900">chmodcmd</font><font color="#990000">=</font><font color="#009900">$chmodprog</font>
<font color="#009900">chowncmd</font><font color="#990000">=</font>
<font color="#009900">mvcmd</font><font color="#990000">=</font><font color="#009900">$mvprog</font>
<font color="#009900">rmcmd</font><font color="#990000">=</font><font color="#FF0000">"$rmprog -f"</font>
<font color="#009900">stripcmd</font><font color="#990000">=</font>

<font color="#009900">src</font><font color="#990000">=</font>
<font color="#009900">dst</font><font color="#990000">=</font>
<font color="#009900">dir_arg</font><font color="#990000">=</font>
<font color="#009900">dst_arg</font><font color="#990000">=</font>

<font color="#009900">copy_on_change</font><font color="#990000">=</font><b><font color="#0000FF">false</font></b>
<font color="#009900">no_target_directory</font><font color="#990000">=</font>

<font color="#009900">usage</font><font color="#990000">=</font><font color="#FF0000">"\</font>
<font color="#FF0000">Usage: $0 [OPTION]... [-T] SRCFILE DSTFILE</font>
<font color="#FF0000">   or: $0 [OPTION]... SRCFILES... DIRECTORY</font>
<font color="#FF0000">   or: $0 [OPTION]... -t DIRECTORY SRCFILES...</font>
<font color="#FF0000">   or: $0 [OPTION]... -d DIRECTORIES...</font>

<font color="#FF0000">In the 1st form, copy SRCFILE to DSTFILE.</font>
<font color="#FF0000">In the 2nd and 3rd, copy all SRCFILES to DIRECTORY.</font>
<font color="#FF0000">In the 4th, create DIRECTORIES.</font>

<font color="#FF0000">Options:</font>
<font color="#FF0000">     --help     display this help and exit.</font>
<font color="#FF0000">     --version  display version info and exit.</font>

<font color="#FF0000">  -c            (ignored)</font>
<font color="#FF0000">  -C            install only if different (preserve the last data modification time)</font>
<font color="#FF0000">  -d            create directories instead of installing files.</font>
<font color="#FF0000">  -g GROUP      $chgrpprog installed files to GROUP.</font>
<font color="#FF0000">  -m MODE       $chmodprog installed files to MODE.</font>
<font color="#FF0000">  -o USER       $chownprog installed files to USER.</font>
<font color="#FF0000">  -s            $stripprog installed files.</font>
<font color="#FF0000">  -t DIRECTORY  install into DIRECTORY.</font>
<font color="#FF0000">  -T            report an error if DSTFILE is a directory.</font>

<font color="#FF0000">Environment variables override the default commands:</font>
<font color="#FF0000">  CHGRPPROG CHMODPROG CHOWNPROG CMPPROG CPPROG MKDIRPROG MVPROG</font>
<font color="#FF0000">  RMPROG STRIPPROG</font>
<font color="#FF0000">"</font>

<b><font color="#0000FF">while</font></b> <b><font color="#0000FF">test</font></b> <font color="#009900">$#</font> -ne <font color="#993399">0</font><font color="#990000">;</font> <b><font color="#0000FF">do</font></b>
  <b><font color="#0000FF">case</font></b> <font color="#009900">$1</font> <b><font color="#0000FF">in</font></b>
    -c<font color="#990000">)</font> <font color="#990000">;;</font>

    -C<font color="#990000">)</font> <font color="#009900">copy_on_change</font><font color="#990000">=</font><b><font color="#0000FF">true</font></b><font color="#990000">;;</font>

    -d<font color="#990000">)</font> <font color="#009900">dir_arg</font><font color="#990000">=</font><b><font color="#0000FF">true</font></b><font color="#990000">;;</font>

    -g<font color="#990000">)</font> <font color="#009900">chgrpcmd</font><font color="#990000">=</font><font color="#FF0000">"$chgrpprog $2"</font>
	<b><font color="#0000FF">shift</font></b><font color="#990000">;;</font>

    --help<font color="#990000">)</font> echo <font color="#FF0000">"$usage"</font><font color="#990000">;</font> <b><font color="#0000FF">exit</font></b> <font color="#009900">$?</font><font color="#990000">;;</font>

    -m<font color="#990000">)</font> <font color="#009900">mode</font><font color="#990000">=</font><font color="#009900">$2</font>
	<b><font color="#0000FF">case</font></b> <font color="#009900">$mode</font> <b><font color="#0000FF">in</font></b>
	  <font color="#990000">*</font><font color="#FF0000">' '</font><font color="#990000">*</font> <font color="#990000">|</font> <font color="#990000">*</font><font color="#FF0000">'	'</font><font color="#990000">*</font> <font color="#990000">|</font> <font color="#990000">*</font><font color="#FF0000">'</font>
<font color="#FF0000">'</font><font color="#990000">*</font>	  <font color="#990000">|</font> <font color="#990000">*</font><font color="#FF0000">'*'</font><font color="#990000">*</font> <font color="#990000">|</font> <font color="#990000">*</font><font color="#FF0000">'?'</font><font color="#990000">*</font> <font color="#990000">|</font> <font color="#990000">*</font><font color="#FF0000">'['</font><font color="#990000">*)</font>
	    echo <font color="#FF0000">"$0: invalid mode: $mode"</font> <font color="#990000">&gt;&amp;</font><font color="#993399">2</font>
	    <b><font color="#0000FF">exit</font></b> <font color="#993399">1</font><font color="#990000">;;</font>
	<b><font color="#0000FF">esac</font></b>
	<b><font color="#0000FF">shift</font></b><font color="#990000">;;</font>

    -o<font color="#990000">)</font> <font color="#009900">chowncmd</font><font color="#990000">=</font><font color="#FF0000">"$chownprog $2"</font>
	<b><font color="#0000FF">shift</font></b><font color="#990000">;;</font>

    -s<font color="#990000">)</font> <font color="#009900">stripcmd</font><font color="#990000">=</font><font color="#009900">$stripprog</font><font color="#990000">;;</font>

    -t<font color="#990000">)</font> <font color="#009900">dst_arg</font><font color="#990000">=</font><font color="#009900">$2</font>
	<b><font color="#0000FF">shift</font></b><font color="#990000">;;</font>

    -T<font color="#990000">)</font> <font color="#009900">no_target_directory</font><font color="#990000">=</font><b><font color="#0000FF">true</font></b><font color="#990000">;;</font>

    --version<font color="#990000">)</font> echo <font color="#FF0000">"$0 $scriptversion"</font><font color="#990000">;</font> <b><font color="#0000FF">exit</font></b> <font color="#009900">$?</font><font color="#990000">;;</font>

    --<font color="#990000">)</font>	<b><font color="#0000FF">shift</font></b>
	<b><font color="#0000FF">break</font></b><font color="#990000">;;</font>

    -<font color="#990000">*)</font>	echo <font color="#FF0000">"$0: invalid option: $1"</font> <font color="#990000">&gt;&amp;</font><font color="#993399">2</font>
	<b><font color="#0000FF">exit</font></b> <font color="#993399">1</font><font color="#990000">;;</font>

    <font color="#990000">*)</font>  <b><font color="#0000FF">break</font></b><font color="#990000">;;</font>
  <b><font color="#0000FF">esac</font></b>
  <b><font color="#0000FF">shift</font></b>
<b><font color="#0000FF">done</font></b>

<b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> <font color="#009900">$#</font> -ne <font color="#993399">0</font> <font color="#990000">&amp;&amp;</font> <b><font color="#0000FF">test</font></b> -z <font color="#FF0000">"$dir_arg$dst_arg"</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
  <i><font color="#9A1900"># When -d is used, all remaining arguments are directories to create.</font></i>
  <i><font color="#9A1900"># When -t is used, the destination is already specified.</font></i>
  <i><font color="#9A1900"># Otherwise, the last argument is the destination.  Remove it from $@.</font></i>
  <b><font color="#0000FF">for</font></b> arg
  <b><font color="#0000FF">do</font></b>
    <b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> -n <font color="#FF0000">"$dst_arg"</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
      <i><font color="#9A1900"># $@ is not empty: it contains at least $arg.</font></i>
      <b><font color="#0000FF">set</font></b> fnord <font color="#FF0000">"$@"</font> <font color="#FF0000">"$dst_arg"</font>
      <b><font color="#0000FF">shift</font></b> <i><font color="#9A1900"># fnord</font></i>
    <b><font color="#0000FF">fi</font></b>
    <b><font color="#0000FF">shift</font></b> <i><font color="#9A1900"># arg</font></i>
    <font color="#009900">dst_arg</font><font color="#990000">=</font><font color="#009900">$arg</font>
  <b><font color="#0000FF">done</font></b>
<b><font color="#0000FF">fi</font></b>

<b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> <font color="#009900">$#</font> -eq <font color="#993399">0</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
  <b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> -z <font color="#FF0000">"$dir_arg"</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
    echo <font color="#FF0000">"$0: no input file specified."</font> <font color="#990000">&gt;&amp;</font><font color="#993399">2</font>
    <b><font color="#0000FF">exit</font></b> <font color="#993399">1</font>
  <b><font color="#0000FF">fi</font></b>
  <i><font color="#9A1900"># It's OK to call `install-sh -d' without argument.</font></i>
  <i><font color="#9A1900"># This can happen when creating conditional directories.</font></i>
  <b><font color="#0000FF">exit</font></b> <font color="#993399">0</font>
<b><font color="#0000FF">fi</font></b>

<b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> -z <font color="#FF0000">"$dir_arg"</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
  <b><font color="#0000FF">trap</font></b> <font color="#FF0000">'(exit $?); exit'</font> <font color="#993399">1</font> <font color="#993399">2</font> <font color="#993399">13</font> <font color="#993399">15</font>

  <i><font color="#9A1900"># Set umask so as not to create temps with too-generous modes.</font></i>
  <i><font color="#9A1900"># However, 'strip' requires both read and write access to temps.</font></i>
  <b><font color="#0000FF">case</font></b> <font color="#009900">$mode</font> <b><font color="#0000FF">in</font></b>
    <i><font color="#9A1900"># Optimize common cases.</font></i>
    <font color="#990000">*</font><font color="#993399">644</font><font color="#990000">)</font> <font color="#009900">cp_umask</font><font color="#990000">=</font><font color="#993399">133</font><font color="#990000">;;</font>
    <font color="#990000">*</font><font color="#993399">755</font><font color="#990000">)</font> <font color="#009900">cp_umask</font><font color="#990000">=</font><font color="#993399">22</font><font color="#990000">;;</font>

    <font color="#990000">*[</font><font color="#993399">0</font>-<font color="#993399">7</font><font color="#990000">])</font>
      <b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> -z <font color="#FF0000">"$stripcmd"</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
	<font color="#009900">u_plus_rw</font><font color="#990000">=</font>
      <b><font color="#0000FF">else</font></b>
	<font color="#009900">u_plus_rw</font><font color="#990000">=</font><font color="#FF0000">'% 200'</font>
      <b><font color="#0000FF">fi</font></b>
      <font color="#009900">cp_umask</font><font color="#990000">=</font>`expr <font color="#FF0000">'('</font> <font color="#993399">777</font> - <font color="#009900">$mode</font> <font color="#990000">%</font> <font color="#993399">1000</font> <font color="#FF0000">')'</font> <font color="#009900">$u_plus_rw</font>`<font color="#990000">;;</font>
    <font color="#990000">*)</font>
      <b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> -z <font color="#FF0000">"$stripcmd"</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
	<font color="#009900">u_plus_rw</font><font color="#990000">=</font>
      <b><font color="#0000FF">else</font></b>
	<font color="#009900">u_plus_rw</font><font color="#990000">=,</font>u<font color="#990000">+</font>rw
      <b><font color="#0000FF">fi</font></b>
      <font color="#009900">cp_umask</font><font color="#990000">=</font><font color="#009900">$mode$u_plus_rw</font><font color="#990000">;;</font>
  <b><font color="#0000FF">esac</font></b>
<b><font color="#0000FF">fi</font></b>

<b><font color="#0000FF">for</font></b> src
<b><font color="#0000FF">do</font></b>
  <i><font color="#9A1900"># Protect names starting with `-'.</font></i>
  <b><font color="#0000FF">case</font></b> <font color="#009900">$src</font> <b><font color="#0000FF">in</font></b>
    -<font color="#990000">*)</font> <font color="#009900">src</font><font color="#990000">=./</font><font color="#009900">$src</font><font color="#990000">;;</font>
  <b><font color="#0000FF">esac</font></b>

  <b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> -n <font color="#FF0000">"$dir_arg"</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
    <font color="#009900">dst</font><font color="#990000">=</font><font color="#009900">$src</font>
    <font color="#009900">dstdir</font><font color="#990000">=</font><font color="#009900">$dst</font>
    <b><font color="#0000FF">test</font></b> -d <font color="#FF0000">"$dstdir"</font>
    <font color="#009900">dstdir_status</font><font color="#990000">=</font><font color="#009900">$?</font>
  <b><font color="#0000FF">else</font></b>

    <i><font color="#9A1900"># Waiting for this to be detected by the "$cpprog $src $dsttmp" command</font></i>
    <i><font color="#9A1900"># might cause directories to be created, which would be especially bad</font></i>
    <i><font color="#9A1900"># if $src (and thus $dsttmp) contains '*'.</font></i>
    <b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> <font color="#990000">!</font> -f <font color="#FF0000">"$src"</font> <font color="#990000">&amp;&amp;</font> <b><font color="#0000FF">test</font></b> <font color="#990000">!</font> -d <font color="#FF0000">"$src"</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
      echo <font color="#FF0000">"$0: $src does not exist."</font> <font color="#990000">&gt;&amp;</font><font color="#993399">2</font>
      <b><font color="#0000FF">exit</font></b> <font color="#993399">1</font>
    <b><font color="#0000FF">fi</font></b>

    <b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> -z <font color="#FF0000">"$dst_arg"</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
      echo <font color="#FF0000">"$0: no destination specified."</font> <font color="#990000">&gt;&amp;</font><font color="#993399">2</font>
      <b><font color="#0000FF">exit</font></b> <font color="#993399">1</font>
    <b><font color="#0000FF">fi</font></b>

    <font color="#009900">dst</font><font color="#990000">=</font><font color="#009900">$dst_arg</font>
    <i><font color="#9A1900"># Protect names starting with `-'.</font></i>
    <b><font color="#0000FF">case</font></b> <font color="#009900">$dst</font> <b><font color="#0000FF">in</font></b>
      -<font color="#990000">*)</font> <font color="#009900">dst</font><font color="#990000">=./</font><font color="#009900">$dst</font><font color="#990000">;;</font>
    <b><font color="#0000FF">esac</font></b>

    <i><font color="#9A1900"># If destination is a directory, append the input filename; won't work</font></i>
    <i><font color="#9A1900"># if double slashes aren't ignored.</font></i>
    <b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> -d <font color="#FF0000">"$dst"</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
      <b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> -n <font color="#FF0000">"$no_target_directory"</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
	echo <font color="#FF0000">"$0: $dst_arg: Is a directory"</font> <font color="#990000">&gt;&amp;</font><font color="#993399">2</font>
	<b><font color="#0000FF">exit</font></b> <font color="#993399">1</font>
      <b><font color="#0000FF">fi</font></b>
      <font color="#009900">dstdir</font><font color="#990000">=</font><font color="#009900">$dst</font>
      <font color="#009900">dst</font><font color="#990000">=</font><font color="#009900">$dstdir</font><font color="#990000">/</font>`basename <font color="#FF0000">"$src"</font>`
      <font color="#009900">dstdir_status</font><font color="#990000">=</font><font color="#993399">0</font>
    <b><font color="#0000FF">else</font></b>
      <i><font color="#9A1900"># Prefer dirname, but fall back on a substitute if dirname fails.</font></i>
      <font color="#009900">dstdir</font><font color="#990000">=</font>`
	<font color="#990000">(</font>dirname <font color="#FF0000">"$dst"</font><font color="#990000">)</font> <font color="#993399">2</font><font color="#990000">&gt;</font>/dev/null <font color="#990000">||</font>
	expr X<font color="#FF0000">"$dst"</font> <font color="#990000">:</font> <font color="#FF0000">'X</font><font color="#CC33CC">\(</font><font color="#FF0000">.*[^/]</font><font color="#CC33CC">\)</font><font color="#FF0000">//*[^/][^/]*/*$'</font> <font color="#990000">\|</font> <font color="#990000">\</font>
	     X<font color="#FF0000">"$dst"</font> <font color="#990000">:</font> <font color="#FF0000">'X</font><font color="#CC33CC">\(</font><font color="#FF0000">//</font><font color="#CC33CC">\)</font><font color="#FF0000">[^/]'</font> <font color="#990000">\|</font> <font color="#990000">\</font>
	     X<font color="#FF0000">"$dst"</font> <font color="#990000">:</font> <font color="#FF0000">'X</font><font color="#CC33CC">\(</font><font color="#FF0000">//</font><font color="#CC33CC">\)</font><font color="#FF0000">$'</font> <font color="#990000">\|</font> <font color="#990000">\</font>
	     X<font color="#FF0000">"$dst"</font> <font color="#990000">:</font> <font color="#FF0000">'X</font><font color="#CC33CC">\(</font><font color="#FF0000">/</font><font color="#CC33CC">\)</font><font color="#FF0000">'</font> <font color="#990000">\|</font> <font color="#990000">.</font> <font color="#993399">2</font><font color="#990000">&gt;</font>/dev/null <font color="#990000">||</font>
	echo X<font color="#FF0000">"$dst"</font> <font color="#990000">|</font>
	    sed <font color="#FF0000">'/^X</font><font color="#CC33CC">\(</font><font color="#FF0000">.*[^/]</font><font color="#CC33CC">\)\/\/</font><font color="#FF0000">*[^/][^/]*</font><font color="#CC33CC">\/</font><font color="#FF0000">*$/{</font>
<font color="#FF0000">		   s//</font><font color="#CC33CC">\1</font><font color="#FF0000">/</font>
<font color="#FF0000">		   q</font>
<font color="#FF0000">		 }</font>
<font color="#FF0000">		 /^X</font><font color="#CC33CC">\(\/\/\)</font><font color="#FF0000">[^/].*/{</font>
<font color="#FF0000">		   s//</font><font color="#CC33CC">\1</font><font color="#FF0000">/</font>
<font color="#FF0000">		   q</font>
<font color="#FF0000">		 }</font>
<font color="#FF0000">		 /^X</font><font color="#CC33CC">\(\/\/\)</font><font color="#FF0000">$/{</font>
<font color="#FF0000">		   s//</font><font color="#CC33CC">\1</font><font color="#FF0000">/</font>
<font color="#FF0000">		   q</font>
<font color="#FF0000">		 }</font>
<font color="#FF0000">		 /^X</font><font color="#CC33CC">\(\/\)</font><font color="#FF0000">.*/{</font>
<font color="#FF0000">		   s//</font><font color="#CC33CC">\1</font><font color="#FF0000">/</font>
<font color="#FF0000">		   q</font>
<font color="#FF0000">		 }</font>
<font color="#FF0000">		 s/.*/./; q'</font>
      `

      <b><font color="#0000FF">test</font></b> -d <font color="#FF0000">"$dstdir"</font>
      <font color="#009900">dstdir_status</font><font color="#990000">=</font><font color="#009900">$?</font>
    <b><font color="#0000FF">fi</font></b>
  <b><font color="#0000FF">fi</font></b>

  <font color="#009900">obsolete_mkdir_used</font><font color="#990000">=</font><b><font color="#0000FF">false</font></b>

  <b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> <font color="#009900">$dstdir_status</font> <font color="#990000">!=</font> <font color="#993399">0</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
    <b><font color="#0000FF">case</font></b> <font color="#009900">$posix_mkdir</font> <b><font color="#0000FF">in</font></b>
      <font color="#FF0000">''</font><font color="#990000">)</font>
	<i><font color="#9A1900"># Create intermediate dirs using mode 755 as modified by the umask.</font></i>
	<i><font color="#9A1900"># This is like FreeBSD 'install' as of 1997-10-28.</font></i>
	<b><font color="#0000FF">umask</font></b><font color="#990000">=</font>`<b><font color="#0000FF">umask</font></b>`
	<b><font color="#0000FF">case</font></b> <font color="#009900">$stripcmd</font><font color="#990000">.</font><font color="#009900">$umask</font> <b><font color="#0000FF">in</font></b>
	  <i><font color="#9A1900"># Optimize common cases.</font></i>
	  <font color="#990000">*[</font><font color="#993399">2367</font><font color="#990000">][</font><font color="#993399">2367</font><font color="#990000">])</font> <font color="#009900">mkdir_umask</font><font color="#990000">=</font><font color="#009900">$umask</font><font color="#990000">;;</font>
	  <font color="#990000">.*</font><font color="#993399">0</font><font color="#990000">[</font><font color="#993399">02</font><font color="#990000">][</font><font color="#993399">02</font><font color="#990000">]</font> <font color="#990000">|</font> <font color="#990000">.[</font><font color="#993399">02</font><font color="#990000">][</font><font color="#993399">02</font><font color="#990000">]</font> <font color="#990000">|</font> <font color="#990000">.[</font><font color="#993399">02</font><font color="#990000">])</font> <font color="#009900">mkdir_umask</font><font color="#990000">=</font><font color="#993399">22</font><font color="#990000">;;</font>

	  <font color="#990000">*[</font><font color="#993399">0</font>-<font color="#993399">7</font><font color="#990000">])</font>
	    <font color="#009900">mkdir_umask</font><font color="#990000">=</font>`expr <font color="#009900">$umask</font> <font color="#990000">+</font> <font color="#993399">22</font> <font color="#990000">\</font>
	      - <font color="#009900">$umask</font> <font color="#990000">%</font> <font color="#993399">100</font> <font color="#990000">%</font> <font color="#993399">40</font> <font color="#990000">+</font> <font color="#009900">$umask</font> <font color="#990000">%</font> <font color="#993399">20</font> <font color="#990000">\</font>
	      - <font color="#009900">$umask</font> <font color="#990000">%</font> <font color="#993399">10</font> <font color="#990000">%</font> <font color="#993399">4</font> <font color="#990000">+</font> <font color="#009900">$umask</font> <font color="#990000">%</font> <font color="#993399">2</font>
	    `<font color="#990000">;;</font>
	  <font color="#990000">*)</font> <font color="#009900">mkdir_umask</font><font color="#990000">=</font><font color="#009900">$umask</font><font color="#990000">,</font>go-w<font color="#990000">;;</font>
	<b><font color="#0000FF">esac</font></b>

	<i><font color="#9A1900"># With -d, create the new directory with the user-specified mode.</font></i>
	<i><font color="#9A1900"># Otherwise, rely on $mkdir_umask.</font></i>
	<b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> -n <font color="#FF0000">"$dir_arg"</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
	  <font color="#009900">mkdir_mode</font><font color="#990000">=</font>-m<font color="#009900">$mode</font>
	<b><font color="#0000FF">else</font></b>
	  <font color="#009900">mkdir_mode</font><font color="#990000">=</font>
	<b><font color="#0000FF">fi</font></b>

	<font color="#009900">posix_mkdir</font><font color="#990000">=</font><b><font color="#0000FF">false</font></b>
	<b><font color="#0000FF">case</font></b> <font color="#009900">$umask</font> <b><font color="#0000FF">in</font></b>
	  <font color="#990000">*[</font><font color="#993399">123567</font><font color="#990000">][</font><font color="#993399">0</font>-<font color="#993399">7</font><font color="#990000">][</font><font color="#993399">0</font>-<font color="#993399">7</font><font color="#990000">])</font>
	    <i><font color="#9A1900"># POSIX mkdir -p sets u+wx bits regardless of umask, which</font></i>
	    <i><font color="#9A1900"># is incompatible with FreeBSD 'install' when (umask &amp; 300) != 0.</font></i>
	    <font color="#990000">;;</font>
	  <font color="#990000">*)</font>
	    <font color="#009900">tmpdir</font><font color="#990000">=</font><font color="#009900">${TMPDIR-/tmp}</font>/ins<font color="#009900">$RANDOM</font>-<font color="#009900">$$</font>
	    <b><font color="#0000FF">trap</font></b> <font color="#FF0000">'ret=$?; rmdir "$tmpdir/d" "$tmpdir" 2&gt;/dev/null; exit $ret'</font> <font color="#993399">0</font>

	    <b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#0000FF">umask</font></b> <font color="#009900">$mkdir_umask</font> <font color="#990000">&amp;&amp;</font>
		<b><font color="#0000FF">exec</font></b> <font color="#009900">$mkdirprog</font> <font color="#009900">$mkdir_mode</font> -p -- <font color="#FF0000">"$tmpdir/d"</font><font color="#990000">)</font> <font color="#990000">&gt;</font>/dev/null <font color="#993399">2</font><font color="#990000">&gt;&amp;</font><font color="#993399">1</font>
	    <b><font color="#0000FF">then</font></b>
	      <b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> -z <font color="#FF0000">"$dir_arg"</font> <font color="#990000">||</font> {
		   <i><font color="#9A1900"># Check for POSIX incompatibilities with -m.</font></i>
		   <i><font color="#9A1900"># HP-UX 11.23 and IRIX 6.5 mkdir -m -p sets group- or</font></i>
		   <i><font color="#9A1900"># other-writeable bit of parent directory when it shouldn't.</font></i>
		   <i><font color="#9A1900"># FreeBSD 6.1 mkdir -m -p sets mode of existing directory.</font></i>
		   <font color="#009900">ls_ld_tmpdir</font><font color="#990000">=</font>`ls -ld <font color="#FF0000">"$tmpdir"</font>`
		   <b><font color="#0000FF">case</font></b> <font color="#009900">$ls_ld_tmpdir</font> <b><font color="#0000FF">in</font></b>
		     d<font color="#990000">????</font>-<font color="#990000">?</font>r-<font color="#990000">*)</font> <font color="#009900">different_mode</font><font color="#990000">=</font><font color="#993399">700</font><font color="#990000">;;</font>
		     d<font color="#990000">????</font>-<font color="#990000">?</font>--<font color="#990000">*)</font> <font color="#009900">different_mode</font><font color="#990000">=</font><font color="#993399">755</font><font color="#990000">;;</font>
		     <font color="#990000">*)</font> <b><font color="#0000FF">false</font></b><font color="#990000">;;</font>
		   <b><font color="#0000FF">esac</font></b> <font color="#990000">&amp;&amp;</font>
		   <font color="#009900">$mkdirprog</font> -m<font color="#009900">$different_mode</font> -p -- <font color="#FF0000">"$tmpdir"</font> <font color="#990000">&amp;&amp;</font> {
		     <font color="#009900">ls_ld_tmpdir_1</font><font color="#990000">=</font>`ls -ld <font color="#FF0000">"$tmpdir"</font>`
		     <b><font color="#0000FF">test</font></b> <font color="#FF0000">"$ls_ld_tmpdir"</font> <font color="#990000">=</font> <font color="#FF0000">"$ls_ld_tmpdir_1"</font>
		   }
		 }
	      <b><font color="#0000FF">then</font></b> <font color="#009900">posix_mkdir</font><font color="#990000">=:</font>
	      <b><font color="#0000FF">fi</font></b>
	      rmdir <font color="#FF0000">"$tmpdir/d"</font> <font color="#FF0000">"$tmpdir"</font>
	    <b><font color="#0000FF">else</font></b>
	      <i><font color="#9A1900"># Remove any dirs left behind by ancient mkdir implementations.</font></i>
	      rmdir <font color="#990000">./</font><font color="#009900">$mkdir_mode</font> <font color="#990000">.</font>/-p <font color="#990000">./</font>-- <font color="#993399">2</font><font color="#990000">&gt;</font>/dev/null
	    <b><font color="#0000FF">fi</font></b>
	    <b><font color="#0000FF">trap</font></b> <font color="#FF0000">''</font> <font color="#993399">0</font><font color="#990000">;;</font>
	<b><font color="#0000FF">esac</font></b><font color="#990000">;;</font>
    <b><font color="#0000FF">esac</font></b>

    <b><font color="#0000FF">if</font></b>
      <font color="#009900">$posix_mkdir</font> <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>
	<b><font color="#0000FF">umask</font></b> <font color="#009900">$mkdir_umask</font> <font color="#990000">&amp;&amp;</font>
	<font color="#009900">$doit_exec</font> <font color="#009900">$mkdirprog</font> <font color="#009900">$mkdir_mode</font> -p -- <font color="#FF0000">"$dstdir"</font>
      <font color="#990000">)</font>
    <b><font color="#0000FF">then</font></b> <font color="#990000">:</font>
    <b><font color="#0000FF">else</font></b>

      <i><font color="#9A1900"># The umask is ridiculous, or mkdir does not conform to POSIX,</font></i>
      <i><font color="#9A1900"># or it failed possibly due to a race condition.  Create the</font></i>
      <i><font color="#9A1900"># directory the slow way, step by step, checking for races as we go.</font></i>

      <b><font color="#0000FF">case</font></b> <font color="#009900">$dstdir</font> <b><font color="#0000FF">in</font></b>
	<font color="#990000">/*)</font> <font color="#009900">prefix</font><font color="#990000">=</font><font color="#FF0000">'/'</font><font color="#990000">;;</font>
	-<font color="#990000">*)</font> <font color="#009900">prefix</font><font color="#990000">=</font><font color="#FF0000">'./'</font><font color="#990000">;;</font>
	<font color="#990000">*)</font>  <font color="#009900">prefix</font><font color="#990000">=</font><font color="#FF0000">''</font><font color="#990000">;;</font>
      <b><font color="#0000FF">esac</font></b>

      <b><font color="#0000FF">eval</font></b> <font color="#FF0000">"$initialize_posix_glob"</font>

      <font color="#009900">oIFS</font><font color="#990000">=</font><font color="#009900">$IFS</font>
      <font color="#009900">IFS</font><font color="#990000">=/</font>
      <font color="#009900">$posix_glob</font> <b><font color="#0000FF">set</font></b> -f
      <b><font color="#0000FF">set</font></b> fnord <font color="#009900">$dstdir</font>
      <b><font color="#0000FF">shift</font></b>
      <font color="#009900">$posix_glob</font> <b><font color="#0000FF">set</font></b> <font color="#990000">+</font>f
      <font color="#009900">IFS</font><font color="#990000">=</font><font color="#009900">$oIFS</font>

      <font color="#009900">prefixes</font><font color="#990000">=</font>

      <b><font color="#0000FF">for</font></b> d
      <b><font color="#0000FF">do</font></b>
	<b><font color="#0000FF">test</font></b> -z <font color="#FF0000">"$d"</font> <font color="#990000">&amp;&amp;</font> <b><font color="#0000FF">continue</font></b>

	<font color="#009900">prefix</font><font color="#990000">=</font><font color="#009900">$prefix$d</font>
	<b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> -d <font color="#FF0000">"$prefix"</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
	  <font color="#009900">prefixes</font><font color="#990000">=</font>
	<b><font color="#0000FF">else</font></b>
	  <b><font color="#0000FF">if</font></b> <font color="#009900">$posix_mkdir</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
	    <font color="#990000">(</font><b><font color="#0000FF">umask</font></b><font color="#990000">=</font><font color="#009900">$mkdir_umask</font> <font color="#990000">&amp;&amp;</font>
	     <font color="#009900">$doit_exec</font> <font color="#009900">$mkdirprog</font> <font color="#009900">$mkdir_mode</font> -p -- <font color="#FF0000">"$dstdir"</font><font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <b><font color="#0000FF">break</font></b>
	    <i><font color="#9A1900"># Don't fail if two instances are running concurrently.</font></i>
	    <b><font color="#0000FF">test</font></b> -d <font color="#FF0000">"$prefix"</font> <font color="#990000">||</font> <b><font color="#0000FF">exit</font></b> <font color="#993399">1</font>
	  <b><font color="#0000FF">else</font></b>
	    <b><font color="#0000FF">case</font></b> <font color="#009900">$prefix</font> <b><font color="#0000FF">in</font></b>
	      <font color="#990000">*</font>\'<font color="#990000">*)</font> <font color="#009900">qprefix</font><font color="#990000">=</font>`echo <font color="#FF0000">"$prefix"</font> <font color="#990000">|</font> sed <font color="#FF0000">"s/'/'</font><font color="#CC33CC">\\\\\\\\</font><font color="#FF0000">''/g"</font>`<font color="#990000">;;</font>
	      <font color="#990000">*)</font> <font color="#009900">qprefix</font><font color="#990000">=</font><font color="#009900">$prefix</font><font color="#990000">;;</font>
	    <b><font color="#0000FF">esac</font></b>
	    <font color="#009900">prefixes</font><font color="#990000">=</font><font color="#FF0000">"$prefixes '$qprefix'"</font>
	  <b><font color="#0000FF">fi</font></b>
	<b><font color="#0000FF">fi</font></b>
	<font color="#009900">prefix</font><font color="#990000">=</font><font color="#009900">$prefix</font><font color="#990000">/</font>
      <b><font color="#0000FF">done</font></b>

      <b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> -n <font color="#FF0000">"$prefixes"</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
	<i><font color="#9A1900"># Don't fail if two instances are running concurrently.</font></i>
	<font color="#990000">(</font><b><font color="#0000FF">umask</font></b> <font color="#009900">$mkdir_umask</font> <font color="#990000">&amp;&amp;</font>
	 <b><font color="#0000FF">eval</font></b> <font color="#FF0000">"</font><font color="#CC33CC">\$</font><font color="#FF0000">doit_exec </font><font color="#CC33CC">\$</font><font color="#FF0000">mkdirprog $prefixes"</font><font color="#990000">)</font> <font color="#990000">||</font>
	  <b><font color="#0000FF">test</font></b> -d <font color="#FF0000">"$dstdir"</font> <font color="#990000">||</font> <b><font color="#0000FF">exit</font></b> <font color="#993399">1</font>
	<font color="#009900">obsolete_mkdir_used</font><font color="#990000">=</font><b><font color="#0000FF">true</font></b>
      <b><font color="#0000FF">fi</font></b>
    <b><font color="#0000FF">fi</font></b>
  <b><font color="#0000FF">fi</font></b>

  <b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> -n <font color="#FF0000">"$dir_arg"</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
    { <b><font color="#0000FF">test</font></b> -z <font color="#FF0000">"$chowncmd"</font> <font color="#990000">||</font> <font color="#009900">$doit</font> <font color="#009900">$chowncmd</font> <font color="#FF0000">"$dst"</font><font color="#990000">;</font> } <font color="#990000">&amp;&amp;</font>
    { <b><font color="#0000FF">test</font></b> -z <font color="#FF0000">"$chgrpcmd"</font> <font color="#990000">||</font> <font color="#009900">$doit</font> <font color="#009900">$chgrpcmd</font> <font color="#FF0000">"$dst"</font><font color="#990000">;</font> } <font color="#990000">&amp;&amp;</font>
    { <b><font color="#0000FF">test</font></b> <font color="#FF0000">"$obsolete_mkdir_used$chowncmd$chgrpcmd"</font> <font color="#990000">=</font> <b><font color="#0000FF">false</font></b> <font color="#990000">||</font>
      <b><font color="#0000FF">test</font></b> -z <font color="#FF0000">"$chmodcmd"</font> <font color="#990000">||</font> <font color="#009900">$doit</font> <font color="#009900">$chmodcmd</font> <font color="#009900">$mode</font> <font color="#FF0000">"$dst"</font><font color="#990000">;</font> } <font color="#990000">||</font> <b><font color="#0000FF">exit</font></b> <font color="#993399">1</font>
  <b><font color="#0000FF">else</font></b>

    <i><font color="#9A1900"># Make a couple of temp file names in the proper directory.</font></i>
    <font color="#009900">dsttmp</font><font color="#990000">=</font><font color="#009900">$dstdir</font><font color="#990000">/</font>_inst<font color="#990000">.</font><font color="#009900">$$</font>_
    <font color="#009900">rmtmp</font><font color="#990000">=</font><font color="#009900">$dstdir</font><font color="#990000">/</font>_rm<font color="#990000">.</font><font color="#009900">$$</font>_

    <i><font color="#9A1900"># Trap to clean up those temp files at exit.</font></i>
    <b><font color="#0000FF">trap</font></b> <font color="#FF0000">'ret=$?; rm -f "$dsttmp" "$rmtmp" &amp;&amp; exit $ret'</font> <font color="#993399">0</font>

    <i><font color="#9A1900"># Copy the file name to the temp name.</font></i>
    <font color="#990000">(</font><b><font color="#0000FF">umask</font></b> <font color="#009900">$cp_umask</font> <font color="#990000">&amp;&amp;</font> <font color="#009900">$doit_exec</font> <font color="#009900">$cpprog</font> <font color="#FF0000">"$src"</font> <font color="#FF0000">"$dsttmp"</font><font color="#990000">)</font> <font color="#990000">&amp;&amp;</font>

    <i><font color="#9A1900"># and set any options; do chmod last to preserve setuid bits.</font></i>
    <i><font color="#9A1900">#</font></i>
    <i><font color="#9A1900"># If any of these fail, we abort the whole thing.  If we want to</font></i>
    <i><font color="#9A1900"># ignore errors from any of these, just make sure not to ignore</font></i>
    <i><font color="#9A1900"># errors from the above "$doit $cpprog $src $dsttmp" command.</font></i>
    <i><font color="#9A1900">#</font></i>
    { <b><font color="#0000FF">test</font></b> -z <font color="#FF0000">"$chowncmd"</font> <font color="#990000">||</font> <font color="#009900">$doit</font> <font color="#009900">$chowncmd</font> <font color="#FF0000">"$dsttmp"</font><font color="#990000">;</font> } <font color="#990000">&amp;&amp;</font>
    { <b><font color="#0000FF">test</font></b> -z <font color="#FF0000">"$chgrpcmd"</font> <font color="#990000">||</font> <font color="#009900">$doit</font> <font color="#009900">$chgrpcmd</font> <font color="#FF0000">"$dsttmp"</font><font color="#990000">;</font> } <font color="#990000">&amp;&amp;</font>
    { <b><font color="#0000FF">test</font></b> -z <font color="#FF0000">"$stripcmd"</font> <font color="#990000">||</font> <font color="#009900">$doit</font> <font color="#009900">$stripcmd</font> <font color="#FF0000">"$dsttmp"</font><font color="#990000">;</font> } <font color="#990000">&amp;&amp;</font>
    { <b><font color="#0000FF">test</font></b> -z <font color="#FF0000">"$chmodcmd"</font> <font color="#990000">||</font> <font color="#009900">$doit</font> <font color="#009900">$chmodcmd</font> <font color="#009900">$mode</font> <font color="#FF0000">"$dsttmp"</font><font color="#990000">;</font> } <font color="#990000">&amp;&amp;</font>

    <i><font color="#9A1900"># If -C, don't bother to copy if it wouldn't change the file.</font></i>
    <b><font color="#0000FF">if</font></b> <font color="#009900">$copy_on_change</font> <font color="#990000">&amp;&amp;</font>
       <font color="#009900">old</font><font color="#990000">=</font>`<font color="#009900">LC_ALL</font><font color="#990000">=</font>C ls -dlL <font color="#FF0000">"$dst"</font>	<font color="#993399">2</font><font color="#990000">&gt;</font>/dev/null` <font color="#990000">&amp;&amp;</font>
       <font color="#009900">new</font><font color="#990000">=</font>`<font color="#009900">LC_ALL</font><font color="#990000">=</font>C ls -dlL <font color="#FF0000">"$dsttmp"</font>	<font color="#993399">2</font><font color="#990000">&gt;</font>/dev/null` <font color="#990000">&amp;&amp;</font>

       <b><font color="#0000FF">eval</font></b> <font color="#FF0000">"$initialize_posix_glob"</font> <font color="#990000">&amp;&amp;</font>
       <font color="#009900">$posix_glob</font> <b><font color="#0000FF">set</font></b> -f <font color="#990000">&amp;&amp;</font>
       <b><font color="#0000FF">set</font></b> X <font color="#009900">$old</font> <font color="#990000">&amp;&amp;</font> <font color="#009900">old</font><font color="#990000">=:</font><font color="#009900">$2</font><font color="#990000">:</font><font color="#009900">$4</font><font color="#990000">:</font><font color="#009900">$5</font><font color="#990000">:</font><font color="#009900">$6</font> <font color="#990000">&amp;&amp;</font>
       <b><font color="#0000FF">set</font></b> X <font color="#009900">$new</font> <font color="#990000">&amp;&amp;</font> <font color="#009900">new</font><font color="#990000">=:</font><font color="#009900">$2</font><font color="#990000">:</font><font color="#009900">$4</font><font color="#990000">:</font><font color="#009900">$5</font><font color="#990000">:</font><font color="#009900">$6</font> <font color="#990000">&amp;&amp;</font>
       <font color="#009900">$posix_glob</font> <b><font color="#0000FF">set</font></b> <font color="#990000">+</font>f <font color="#990000">&amp;&amp;</font>

       <b><font color="#0000FF">test</font></b> <font color="#FF0000">"$old"</font> <font color="#990000">=</font> <font color="#FF0000">"$new"</font> <font color="#990000">&amp;&amp;</font>
       <font color="#009900">$cmpprog</font> <font color="#FF0000">"$dst"</font> <font color="#FF0000">"$dsttmp"</font> <font color="#990000">&gt;</font>/dev/null <font color="#993399">2</font><font color="#990000">&gt;&amp;</font><font color="#993399">1</font>
    <b><font color="#0000FF">then</font></b>
      rm -f <font color="#FF0000">"$dsttmp"</font>
    <b><font color="#0000FF">else</font></b>
      <i><font color="#9A1900"># Rename the file to the real destination.</font></i>
      <font color="#009900">$doit</font> <font color="#009900">$mvcmd</font> -f <font color="#FF0000">"$dsttmp"</font> <font color="#FF0000">"$dst"</font> <font color="#993399">2</font><font color="#990000">&gt;</font>/dev/null <font color="#990000">||</font>

      <i><font color="#9A1900"># The rename failed, perhaps because mv can't rename something else</font></i>
      <i><font color="#9A1900"># to itself, or perhaps because mv is so ancient that it does not</font></i>
      <i><font color="#9A1900"># support -f.</font></i>
      {
	<i><font color="#9A1900"># Now remove or move aside any old file at destination location.</font></i>
	<i><font color="#9A1900"># We try this two ways since rm can't unlink itself on some</font></i>
	<i><font color="#9A1900"># systems and the destination file might be busy for other</font></i>
	<i><font color="#9A1900"># reasons.  In this case, the final cleanup might fail but the new</font></i>
	<i><font color="#9A1900"># file should still install successfully.</font></i>
	{
	  <b><font color="#0000FF">test</font></b> <font color="#990000">!</font> -f <font color="#FF0000">"$dst"</font> <font color="#990000">||</font>
	  <font color="#009900">$doit</font> <font color="#009900">$rmcmd</font> -f <font color="#FF0000">"$dst"</font> <font color="#993399">2</font><font color="#990000">&gt;</font>/dev/null <font color="#990000">||</font>
	  { <font color="#009900">$doit</font> <font color="#009900">$mvcmd</font> -f <font color="#FF0000">"$dst"</font> <font color="#FF0000">"$rmtmp"</font> <font color="#993399">2</font><font color="#990000">&gt;</font>/dev/null <font color="#990000">&amp;&amp;</font>
	    { <font color="#009900">$doit</font> <font color="#009900">$rmcmd</font> -f <font color="#FF0000">"$rmtmp"</font> <font color="#993399">2</font><font color="#990000">&gt;</font>/dev/null<font color="#990000">;</font> <font color="#990000">:;</font> }
	  } <font color="#990000">||</font>
	  { echo <font color="#FF0000">"$0: cannot unlink or rename $dst"</font> <font color="#990000">&gt;&amp;</font><font color="#993399">2</font>
	    <font color="#990000">(</font><b><font color="#0000FF">exit</font></b> <font color="#993399">1</font><font color="#990000">);</font> <b><font color="#0000FF">exit</font></b> <font color="#993399">1</font>
	  }
	} <font color="#990000">&amp;&amp;</font>

	<i><font color="#9A1900"># Now rename the file to the real destination.</font></i>
	<font color="#009900">$doit</font> <font color="#009900">$mvcmd</font> <font color="#FF0000">"$dsttmp"</font> <font color="#FF0000">"$dst"</font>
      }
    <b><font color="#0000FF">fi</font></b> <font color="#990000">||</font> <b><font color="#0000FF">exit</font></b> <font color="#993399">1</font>

    <b><font color="#0000FF">trap</font></b> <font color="#FF0000">''</font> <font color="#993399">0</font>
  <b><font color="#0000FF">fi</font></b>
<b><font color="#0000FF">done</font></b>

<i><font color="#9A1900"># Local variables:</font></i>
<i><font color="#9A1900"># eval: (add-hook 'write-file-hooks 'time-stamp)</font></i>
<i><font color="#9A1900"># time-stamp-start: "scriptversion="</font></i>
<i><font color="#9A1900"># time-stamp-format: "%:y-%02m-%02d.%02H"</font></i>
<i><font color="#9A1900"># time-stamp-time-zone: "UTC"</font></i>
<i><font color="#9A1900"># time-stamp-end: "; # UTC"</font></i>
<i><font color="#9A1900"># End:</font></i>
</tt></pre>
