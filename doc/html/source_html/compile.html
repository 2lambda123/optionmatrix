<!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><i><font color="#9A1900">#! /bin/sh</font></i>
<i><font color="#9A1900"># Wrapper for compilers which do not understand `-c -o'.</font></i>

<font color="#009900">scriptversion</font><font color="#990000">=</font><font color="#993399">2009</font>-<font color="#993399">10</font>-<font color="#993399">06.20</font><font color="#990000">;</font> <i><font color="#9A1900"># UTC</font></i>

<i><font color="#9A1900"># Copyright (C) 1999, 2000, 2003, 2004, 2005, 2009  Free Software</font></i>
<i><font color="#9A1900"># Foundation, Inc.</font></i>
<i><font color="#9A1900"># Written by Tom Tromey &lt;tromey@cygnus.com&gt;.</font></i>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># This program is free software; you can redistribute it and/or modify</font></i>
<i><font color="#9A1900"># it under the terms of the GNU General Public License as published by</font></i>
<i><font color="#9A1900"># the Free Software Foundation; either version 2, or (at your option)</font></i>
<i><font color="#9A1900"># any later version.</font></i>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># This program is distributed in the hope that it will be useful,</font></i>
<i><font color="#9A1900"># but WITHOUT ANY WARRANTY; without even the implied warranty of</font></i>
<i><font color="#9A1900"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</font></i>
<i><font color="#9A1900"># GNU General Public License for more details.</font></i>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># You should have received a copy of the GNU General Public License</font></i>
<i><font color="#9A1900"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</font></i>

<i><font color="#9A1900"># As a special exception to the GNU General Public License, if you</font></i>
<i><font color="#9A1900"># distribute this file as part of a program that contains a</font></i>
<i><font color="#9A1900"># configuration script generated by Autoconf, you may include it under</font></i>
<i><font color="#9A1900"># the same distribution terms that you use for the rest of that program.</font></i>

<i><font color="#9A1900"># This file is maintained in Automake, please report</font></i>
<i><font color="#9A1900"># bugs to &lt;bug-automake@gnu.org&gt; or send patches to</font></i>
<i><font color="#9A1900"># &lt;automake-patches@gnu.org&gt;.</font></i>

<b><font color="#0000FF">case</font></b> <font color="#009900">$1</font> <b><font color="#0000FF">in</font></b>
  <font color="#FF0000">''</font><font color="#990000">)</font>
     echo <font color="#FF0000">"$0: No command.  Try </font><font color="#CC33CC">\`</font><font color="#FF0000">$0 --help' for more information."</font> <font color="#993399">1</font><font color="#990000">&gt;&amp;</font><font color="#993399">2</font>
     <b><font color="#0000FF">exit</font></b> <font color="#993399">1</font><font color="#990000">;</font>
     <font color="#990000">;;</font>
  -h <font color="#990000">|</font> --h<font color="#990000">*)</font>
    cat <font color="#990000">&lt;&lt;\</font>EOF
Usage<font color="#990000">:</font> compile <font color="#990000">[</font>--help<font color="#990000">]</font> <font color="#990000">[</font>--version<font color="#990000">]</font> PROGRAM <font color="#990000">[</font>ARGS<font color="#990000">]</font>

Wrapper <b><font color="#0000FF">for</font></b> compilers which <b><font color="#0000FF">do</font></b> not understand `-c -o<font color="#FF0000">'.</font>
<font color="#FF0000">Remove `-o dest.o'</font> from ARGS<font color="#990000">,</font> run PROGRAM with the remaining
arguments<font color="#990000">,</font> and rename the output as expected<font color="#990000">.</font>

If you are trying to build a whole package this is not the
right script to run<font color="#990000">:</font> please start by reading the file `INSTALL<font color="#FF0000">'.</font>

<font color="#FF0000">Report bugs to &lt;bug-automake@gnu.org&gt;.</font>
<font color="#FF0000">EOF</font>
<font color="#FF0000">    exit $?</font>
<font color="#FF0000">    ;;</font>
<font color="#FF0000">  -v | --v*)</font>
<font color="#FF0000">    echo "compile $scriptversion"</font>
<font color="#FF0000">    exit $?</font>
<font color="#FF0000">    ;;</font>
<font color="#FF0000">esac</font>

<font color="#FF0000">ofile=</font>
<font color="#FF0000">cfile=</font>
<font color="#FF0000">eat=</font>

<font color="#FF0000">for arg</font>
<font color="#FF0000">do</font>
<font color="#FF0000">  if test -n "$eat"; then</font>
<font color="#FF0000">    eat=</font>
<font color="#FF0000">  else</font>
<font color="#FF0000">    case $1 in</font>
<font color="#FF0000">      -o)</font>
<font color="#FF0000">	# configure might choose to run compile as `compile cc -o foo foo.c'</font><font color="#990000">.</font>
	<i><font color="#9A1900"># So we strip `-o arg' only if arg is an object.</font></i>
	<font color="#009900">eat</font><font color="#990000">=</font><font color="#993399">1</font>
	<b><font color="#0000FF">case</font></b> <font color="#009900">$2</font> <b><font color="#0000FF">in</font></b>
	  <font color="#990000">*.</font>o <font color="#990000">|</font> <font color="#990000">*.</font>obj<font color="#990000">)</font>
	    <font color="#009900">ofile</font><font color="#990000">=</font><font color="#009900">$2</font>
	    <font color="#990000">;;</font>
	  <font color="#990000">*)</font>
	    <b><font color="#0000FF">set</font></b> x <font color="#FF0000">"$@"</font> -o <font color="#FF0000">"$2"</font>
	    <b><font color="#0000FF">shift</font></b>
	    <font color="#990000">;;</font>
	<b><font color="#0000FF">esac</font></b>
	<font color="#990000">;;</font>
      <font color="#990000">*.</font>c<font color="#990000">)</font>
	<font color="#009900">cfile</font><font color="#990000">=</font><font color="#009900">$1</font>
	<b><font color="#0000FF">set</font></b> x <font color="#FF0000">"$@"</font> <font color="#FF0000">"$1"</font>
	<b><font color="#0000FF">shift</font></b>
	<font color="#990000">;;</font>
      <font color="#990000">*)</font>
	<b><font color="#0000FF">set</font></b> x <font color="#FF0000">"$@"</font> <font color="#FF0000">"$1"</font>
	<b><font color="#0000FF">shift</font></b>
	<font color="#990000">;;</font>
    <b><font color="#0000FF">esac</font></b>
  <b><font color="#0000FF">fi</font></b>
  <b><font color="#0000FF">shift</font></b>
<b><font color="#0000FF">done</font></b>

<b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> -z <font color="#FF0000">"$ofile"</font> <font color="#990000">||</font> <b><font color="#0000FF">test</font></b> -z <font color="#FF0000">"$cfile"</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
  <i><font color="#9A1900"># If no `-o' option was seen then we might have been invoked from a</font></i>
  <i><font color="#9A1900"># pattern rule where we don't need one.  That is ok -- this is a</font></i>
  <i><font color="#9A1900"># normal compilation that the losing compiler can handle.  If no</font></i>
  <i><font color="#9A1900"># `.c' file was seen then we are probably linking.  That is also</font></i>
  <i><font color="#9A1900"># ok.</font></i>
  <b><font color="#0000FF">exec</font></b> <font color="#FF0000">"$@"</font>
<b><font color="#0000FF">fi</font></b>

<i><font color="#9A1900"># Name of file we expect compiler to create.</font></i>
<font color="#009900">cofile</font><font color="#990000">=</font>`echo <font color="#FF0000">"$cfile"</font> <font color="#990000">|</font> sed <font color="#FF0000">'s|^.*[</font><font color="#CC33CC">\\</font><font color="#FF0000">/]||; s|^[a-zA-Z]:||; s/</font><font color="#CC33CC">\.</font><font color="#FF0000">c$/.o/'</font>`

<i><font color="#9A1900"># Create the lock directory.</font></i>
<i><font color="#9A1900"># Note: use `[/\\:.-]' here to ensure that we don't use the same name</font></i>
<i><font color="#9A1900"># that we are using for the .o file.  Also, base the name on the expected</font></i>
<i><font color="#9A1900"># object file name, since that is what matters with a parallel build.</font></i>
<font color="#009900">lockdir</font><font color="#990000">=</font>`echo <font color="#FF0000">"$cofile"</font> <font color="#990000">|</font> sed -e <font color="#FF0000">'s|[/</font><font color="#CC33CC">\\</font><font color="#FF0000">:.-]|_|g'</font>`<font color="#990000">.</font>d
<b><font color="#0000FF">while</font></b> <b><font color="#0000FF">true</font></b><font color="#990000">;</font> <b><font color="#0000FF">do</font></b>
  <b><font color="#0000FF">if</font></b> mkdir <font color="#FF0000">"$lockdir"</font> <font color="#990000">&gt;</font>/dev/null <font color="#993399">2</font><font color="#990000">&gt;&amp;</font><font color="#993399">1</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
    <b><font color="#0000FF">break</font></b>
  <b><font color="#0000FF">fi</font></b>
  sleep <font color="#993399">1</font>
<b><font color="#0000FF">done</font></b>
<i><font color="#9A1900"># FIXME: race condition here if user kills between mkdir and trap.</font></i>
<b><font color="#0000FF">trap</font></b> <font color="#FF0000">"rmdir '$lockdir'; exit 1"</font> <font color="#993399">1</font> <font color="#993399">2</font> <font color="#993399">15</font>

<i><font color="#9A1900"># Run the compile.</font></i>
<font color="#FF0000">"$@"</font>
<font color="#009900">ret</font><font color="#990000">=</font><font color="#009900">$?</font>

<b><font color="#0000FF">if</font></b> <b><font color="#0000FF">test</font></b> -f <font color="#FF0000">"$cofile"</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
  <b><font color="#0000FF">test</font></b> <font color="#FF0000">"$cofile"</font> <font color="#990000">=</font> <font color="#FF0000">"$ofile"</font> <font color="#990000">||</font> mv <font color="#FF0000">"$cofile"</font> <font color="#FF0000">"$ofile"</font>
<b><font color="#0000FF">elif</font></b> <b><font color="#0000FF">test</font></b> -f <font color="#FF0000">"${cofile}bj"</font><font color="#990000">;</font> <b><font color="#0000FF">then</font></b>
  <b><font color="#0000FF">test</font></b> <font color="#FF0000">"${cofile}bj"</font> <font color="#990000">=</font> <font color="#FF0000">"$ofile"</font> <font color="#990000">||</font> mv <font color="#FF0000">"${cofile}bj"</font> <font color="#FF0000">"$ofile"</font>
<b><font color="#0000FF">fi</font></b>

rmdir <font color="#FF0000">"$lockdir"</font>
<b><font color="#0000FF">exit</font></b> <font color="#009900">$ret</font>

<i><font color="#9A1900"># Local Variables:</font></i>
<i><font color="#9A1900"># mode: shell-script</font></i>
<i><font color="#9A1900"># sh-indentation: 2</font></i>
<i><font color="#9A1900"># eval: (add-hook 'write-file-hooks 'time-stamp)</font></i>
<i><font color="#9A1900"># time-stamp-start: "scriptversion="</font></i>
<i><font color="#9A1900"># time-stamp-format: "%:y-%02m-%02d.%02H"</font></i>
<i><font color="#9A1900"># time-stamp-time-zone: "UTC"</font></i>
<i><font color="#9A1900"># time-stamp-end: "; # UTC"</font></i>
<i><font color="#9A1900"># End:</font></i>
</tt></pre>
