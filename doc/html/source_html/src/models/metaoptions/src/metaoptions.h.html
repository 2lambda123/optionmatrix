<!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900">    libmetaoptions - A collection of option-related functions. </font></i>
<i><font color="#9A1900">    Copyright (C) 2000-2006 B. Augestad, </font></i><u><font color="#0000FF">bjorn.augestad@gmail.com</font></u><i><font color="#9A1900"> </font></i>

<i><font color="#9A1900">    This program is free software; you can redistribute it and/or modify</font></i>
<i><font color="#9A1900">    it under the terms of the GNU General Public License as published by</font></i>
<i><font color="#9A1900">    the Free Software Foundation; either version 2 of the License, or</font></i>
<i><font color="#9A1900">    (at your option) any later version.</font></i>

<i><font color="#9A1900">    This program is distributed in the hope that it will be useful,</font></i>
<i><font color="#9A1900">    but WITHOUT ANY WARRANTY; without even the implied warranty of</font></i>
<i><font color="#9A1900">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</font></i>
<i><font color="#9A1900">    GNU General Public License for more details.</font></i>

<i><font color="#9A1900">    You should have received a copy of the GNU General Public License</font></i>
<i><font color="#9A1900">    along with this program; if not, write to the Free Software</font></i>
<i><font color="#9A1900">    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</font></i>
<i><font color="#9A1900">*/</font></i>

<b><font color="#000080">#ifndef</font></b> METAOPTIONS_H
<b><font color="#000080">#define</font></b> METAOPTIONS_H

<b><font color="#000080">#include</font></b> <font color="#FF0000">&lt;assert.h&gt;</font>

<b><font color="#000080">#ifdef</font></b> NDEBUG
<b><font color="#000080">#define</font></b> <b><font color="#000000">assert_equal</font></b><font color="#990000">(</font>a<font color="#990000">,</font> b<font color="#990000">)</font> <font color="#990000">(</font><font color="#993399">1</font><font color="#990000">)</font>
<b><font color="#000080">#else</font></b>

<i><font color="#9A1900">/* At least temporarily */</font></i>
<b><font color="#000080">#include</font></b> <font color="#FF0000">&lt;stdio.h&gt;</font>
<b><font color="#000080">#include</font></b> <font color="#FF0000">&lt;stdlib.h&gt;</font>

<b><font color="#000080">#define</font></b> <b><font color="#000000">assert_equal</font></b><font color="#990000">(</font>a<font color="#990000">,</font> b<font color="#990000">)\</font>
<font color="#FF0000">{</font><font color="#990000">\</font>
	<font color="#009900">double</font> x <font color="#990000">=</font> <b><font color="#000000">fabs</font></b><font color="#990000">(</font>a <font color="#990000">-</font> b<font color="#990000">);\</font>
	<font color="#009900">double</font> maxdiff <font color="#990000">=</font> <font color="#993399">0.0001</font><font color="#990000">;\</font>
	<b><font color="#0000FF">if</font></b><font color="#990000">(</font>x <font color="#990000">&gt;</font> maxdiff<font color="#990000">)</font> <font color="#FF0000">{</font><font color="#990000">\</font>
		<b><font color="#000000">fprintf</font></b><font color="#990000">(</font>stderr<font color="#990000">,</font> <font color="#FF0000">"%s():%s(%d): assert_equal failed for values %.10g and %.10g</font><font color="#CC33CC">\n</font><font color="#FF0000">"</font><font color="#990000">,\</font>
		__func__<font color="#990000">,</font> __FILE__<font color="#990000">,</font> __LINE__<font color="#990000">,</font> a<font color="#990000">,</font> b<font color="#990000">);\</font>
		<b><font color="#000000">abort</font></b><font color="#990000">();\</font>
	<font color="#FF0000">}</font><font color="#990000">\</font>
<font color="#FF0000">}</font>
<b><font color="#000080">#endif</font></b>

<i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900"> * Local macros used to verify/sanity check the parameters</font></i>
<i><font color="#9A1900"> * we receive from Excel. We don't want to call our functions</font></i>
<i><font color="#9A1900"> * under all circumstances, so this is error checking with excel specific</font></i>
<i><font color="#9A1900"> * reporting.</font></i>
<i><font color="#9A1900"> */</font></i>
<b><font color="#000080">#define</font></b> VOLATILITY_MIN <font color="#993399">0.0000001</font>
<b><font color="#000080">#define</font></b> VOLATILITY_MAX <font color="#993399">100.99999</font>

<i><font color="#9A1900">/* </font></i>
<i><font color="#9A1900"> * There are approx. 253 trading days per year. We allow for less time than one </font></i>
<i><font color="#9A1900"> * day to avoid rounding errors. Less than an hour is meaningless.</font></i>
<i><font color="#9A1900"> * Max time is 20 (trading) years. Remember that t==1.0 == one trading year</font></i>
<i><font color="#9A1900"> */</font></i>
<b><font color="#000080">#define</font></b> <b><font color="#000000">TIME_MIN</font></b> <font color="#990000">(</font><font color="#993399">1.0</font><font color="#990000">/(</font><font color="#993399">253.0</font> <font color="#990000">*</font> <font color="#993399">24.0</font><font color="#990000">))</font> 
<b><font color="#000080">#define</font></b> <b><font color="#000000">TIME_MAX</font></b> <font color="#990000">(</font><font color="#993399">20.0</font><font color="#990000">)</font>

<i><font color="#9A1900">/* </font></i>
<i><font color="#9A1900"> * Some sanity checks for interest rate. We cannot have negative rates</font></i>
<i><font color="#9A1900"> * as that screws up the entire economic system. Not so sure about max values</font></i>
<i><font color="#9A1900"> * because from time to time one gets insane rates. We set some kind of max anyway</font></i>
<i><font color="#9A1900"> */</font></i>
<b><font color="#000080">#define</font></b> INTEREST_RATE_MIN <font color="#993399">0.0</font> <i><font color="#9A1900">/* Zero is OK and happens from time to time, e.g. Japan */</font></i>
<b><font color="#000080">#define</font></b> INTEREST_RATE_MAX <font color="#993399">1000.0</font> <i><font color="#9A1900">/* 100000% yearly is quite a lot */</font></i>

<i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900"> * Strike and price min/max are equal. Nothing is free, so PRICE_MIN &gt; 0.0</font></i>
<i><font color="#9A1900"> * There's no theoretical upper bound for price, but we want to avoid infinity</font></i>
<i><font color="#9A1900"> * and set a max price anyway.</font></i>
<i><font color="#9A1900"> */</font></i>
<b><font color="#000080">#define</font></b> PRICE_MIN <font color="#993399">0.000001</font>
<b><font color="#000080">#define</font></b> PRICE_MAX <font color="#993399">1000000000000.0</font>

<b><font color="#000080">#define</font></b> <font color="#008080">STRIKE_MIN</font> PRICE_MIN
<b><font color="#000080">#define</font></b> <font color="#008080">STRIKE_MAX</font> PRICE_MAX

<i><font color="#9A1900">/* </font></i>
<i><font color="#9A1900"> * Cost of carry is defined here.</font></i>
<i><font color="#9A1900"> * I guess we could apply rules like COC &lt;= INTEREST_RATE as noone would</font></i>
<i><font color="#9A1900"> * ever buy something with a cost of carry &gt; risk free rate. </font></i>
<i><font color="#9A1900"> * What about negative costs? Happens when underlying pays a yield greater</font></i>
<i><font color="#9A1900"> * than risk free rate. </font></i>
<i><font color="#9A1900"> */</font></i>
<b><font color="#000080">#define</font></b> COST_OF_CARRY_MIN	<font color="#990000">-</font>INTEREST_RATE_MAX
<b><font color="#000080">#define</font></b> <font color="#008080">COST_OF_CARRY_MAX</font>	INTEREST_RATE_MAX

<i><font color="#9A1900">/**</font></i>
<i><font color="#9A1900"> * Some constants we use a lot.</font></i>
<i><font color="#9A1900"> * The M_E and friends from math.h is not a part of the ANSI C standard,</font></i>
<i><font color="#9A1900"> * so we add them here instead.</font></i>
<i><font color="#9A1900"> * e, pi and sqrt(2*pi);</font></i>
<i><font color="#9A1900"> * A common calculation is (1/sqrt2pi) *e, which equals e/sqr2pi.</font></i>
<i><font color="#9A1900"> *</font></i>
<i><font color="#9A1900"> * Use the gcc flag -Wshadow to locate scoping problems</font></i>
<i><font color="#9A1900"> */</font></i>
<b><font color="#0000FF">static</font></b> <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> e <font color="#990000">=</font> <font color="#993399">2.7182818284590452354</font><font color="#990000">;</font>
<b><font color="#0000FF">static</font></b> <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> pi <font color="#990000">=</font> <font color="#993399">3.14159265358979323846</font><font color="#990000">;</font>	
<b><font color="#0000FF">static</font></b> <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> sqrt2pi <font color="#990000">=</font> <font color="#993399">2.50662827463100024161</font><font color="#990000">;</font>
<b><font color="#0000FF">static</font></b> <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> e_div_sqrt2pi <font color="#990000">=</font> <font color="#993399">1.08443755141922748564</font><font color="#990000">;</font>
<b><font color="#0000FF">static</font></b> <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> one_div_sqrt2pi <font color="#990000">=</font> <font color="#993399">0.39894228040143270286</font><font color="#990000">;</font>

<b><font color="#000080">#if</font></b> <font color="#993399">0</font>
<b><font color="#0000FF">static</font></b> <b><font color="#0000FF">inline</font></b> <font color="#009900">double</font> <b><font color="#000000">pow2</font></b>    <font color="#990000">(</font><font color="#009900">double</font> n<font color="#990000">)</font> <font color="#FF0000">{</font> <b><font color="#0000FF">return</font></b> n <font color="#990000">*</font> n<font color="#990000">;</font> <font color="#FF0000">}</font>
<b><font color="#0000FF">static</font></b> <b><font color="#0000FF">inline</font></b> <font color="#009900">double</font> <b><font color="#000000">normdist</font></b><font color="#990000">(</font><font color="#009900">double</font> x<font color="#990000">)</font> <font color="#FF0000">{</font> <b><font color="#0000FF">return</font></b> one_div_sqrt2pi <font color="#990000">*</font> <b><font color="#000000">exp</font></b><font color="#990000">(-((</font>x <font color="#990000">*</font> x<font color="#990000">)/</font> <font color="#993399">2.0</font><font color="#990000">));</font> <font color="#FF0000">}</font>
<b><font color="#000080">#else</font></b>
<b><font color="#000080">#define</font></b> <b><font color="#000000">pow2</font></b><font color="#990000">(</font>n<font color="#990000">)</font> <font color="#990000">((</font>n<font color="#990000">)</font> <font color="#990000">*</font> <font color="#990000">(</font>n<font color="#990000">))</font>
<b><font color="#000080">#define</font></b> <b><font color="#000000">normdist</font></b><font color="#990000">(</font>x<font color="#990000">)</font> <font color="#990000">(</font> one_div_sqrt2pi <font color="#990000">*</font> <b><font color="#000000">exp</font></b><font color="#990000">(-(((</font>x<font color="#990000">)</font> <font color="#990000">*</font> <font color="#990000">(</font>x<font color="#990000">))/</font> <font color="#993399">2.0</font><font color="#990000">)))</font>
<b><font color="#000080">#endif</font></b>



<i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900"> * Error checking macros, used to aid users of the library.</font></i>
<i><font color="#9A1900"> * We define our own is_sane() macro which tests a double as much as possible.</font></i>
<i><font color="#9A1900"> * Some platforms and standards have *very* poor support for this, namely C89.</font></i>
<i><font color="#9A1900"> * This is the main reason we use our own function.</font></i>
<i><font color="#9A1900"> */</font></i>
<b><font color="#000080">#if</font></b> <font color="#993399">1</font>
<b><font color="#000080">#define</font></b> <b><font color="#000000">is_sane</font></b><font color="#990000">(</font>a<font color="#990000">)</font> <font color="#990000">((</font>a<font color="#990000">)</font> <font color="#990000">==</font> <font color="#990000">(</font>a<font color="#990000">))</font> <i><font color="#9A1900">/* if not, it is NaN on many systems. */</font></i>
<b><font color="#000080">#else</font></b>
<i><font color="#9A1900">/* Windows version */</font></i>
<b><font color="#000080">#include</font></b> <font color="#FF0000">&lt;float.h&gt;</font>
<b><font color="#000080">#define</font></b> <b><font color="#000000">is_sane</font></b><font color="#990000">(</font>a<font color="#990000">)</font> <font color="#990000">(!</font><b><font color="#000000">_isnan</font></b><font color="#990000">((</font>a<font color="#990000">))</font> <font color="#990000">&amp;&amp;</font> <b><font color="#000000">_finite</font></b><font color="#990000">((</font>a<font color="#990000">)))</font>
<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#if</font></b> <font color="#993399">0</font>
<i><font color="#9A1900">/* More silly C89 shit, no fmin/fmax macros */</font></i>
<b><font color="#000080">#define</font></b> <b><font color="#000000">fmax</font></b><font color="#990000">(</font>x<font color="#990000">,</font> y<font color="#990000">)</font> <font color="#990000">((</font>x<font color="#990000">)</font> <font color="#990000">&gt;</font> <font color="#990000">(</font>y<font color="#990000">)</font> <font color="#990000">?</font> <font color="#990000">(</font>x<font color="#990000">)</font> <font color="#990000">:</font> <font color="#990000">(</font>y<font color="#990000">))</font>
<b><font color="#000080">#define</font></b> <b><font color="#000000">fmin</font></b><font color="#990000">(</font>x<font color="#990000">,</font> y<font color="#990000">)</font> <font color="#990000">((</font>x<font color="#990000">)</font> <font color="#990000">&lt;</font> <font color="#990000">(</font>y<font color="#990000">)</font> <font color="#990000">?</font> <font color="#990000">(</font>x<font color="#990000">)</font> <font color="#990000">:</font> <font color="#990000">(</font>y<font color="#990000">))</font>
<b><font color="#000080">#endif</font></b>


<b><font color="#000080">#define</font></b> <b><font color="#000000">assert_valid_price</font></b><font color="#990000">(</font>S<font color="#990000">)</font>			<b><font color="#000000">assert</font></b><font color="#990000">(</font><b><font color="#000000">is_sane</font></b><font color="#990000">(</font>S<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>S<font color="#990000">)</font> <font color="#990000">&gt;=</font> PRICE_MIN <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>S<font color="#990000">)</font> <font color="#990000">&lt;=</font> PRICE_MAX<font color="#990000">)</font>
<b><font color="#000080">#define</font></b> <b><font color="#000000">assert_valid_strike</font></b><font color="#990000">(</font>X<font color="#990000">)</font>			<b><font color="#000000">assert</font></b><font color="#990000">(</font><b><font color="#000000">is_sane</font></b><font color="#990000">(</font>X<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>X<font color="#990000">)</font> <font color="#990000">&gt;=</font> STRIKE_MIN <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>X<font color="#990000">)</font> <font color="#990000">&lt;=</font> STRIKE_MAX<font color="#990000">)</font>
<b><font color="#000080">#define</font></b> <b><font color="#000000">assert_valid_time</font></b><font color="#990000">(</font>T<font color="#990000">)</font>			<b><font color="#000000">assert</font></b><font color="#990000">(</font><b><font color="#000000">is_sane</font></b><font color="#990000">(</font>T<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>T<font color="#990000">)</font> <font color="#990000">&gt;=</font> TIME_MIN <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>T<font color="#990000">)</font> <font color="#990000">&lt;=</font> TIME_MAX<font color="#990000">)</font>
<b><font color="#000080">#define</font></b> <b><font color="#000000">assert_valid_interest_rate</font></b><font color="#990000">(</font>r<font color="#990000">)</font>	<b><font color="#000000">assert</font></b><font color="#990000">(</font><b><font color="#000000">is_sane</font></b><font color="#990000">(</font>r<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>r<font color="#990000">)</font> <font color="#990000">&gt;=</font> INTEREST_RATE_MIN <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>r<font color="#990000">)</font> <font color="#990000">&lt;=</font> INTEREST_RATE_MAX<font color="#990000">)</font>
<b><font color="#000080">#define</font></b> <b><font color="#000000">assert_valid_cost_of_carry</font></b><font color="#990000">(</font>b<font color="#990000">)</font>	<b><font color="#000000">assert</font></b><font color="#990000">(</font><b><font color="#000000">is_sane</font></b><font color="#990000">(</font>b<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>b<font color="#990000">)</font> <font color="#990000">&gt;=</font> COST_OF_CARRY_MIN <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>b<font color="#990000">)</font> <font color="#990000">&lt;=</font> COST_OF_CARRY_MAX<font color="#990000">)</font>
<b><font color="#000080">#define</font></b> <b><font color="#000000">assert_valid_volatility</font></b><font color="#990000">(</font>v<font color="#990000">)</font>		<b><font color="#000000">assert</font></b><font color="#990000">(</font><b><font color="#000000">is_sane</font></b><font color="#990000">(</font>v<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>v<font color="#990000">)</font> <font color="#990000">&gt;=</font> VOLATILITY_MIN <font color="#990000">&amp;&amp;</font> v <font color="#990000">&lt;=</font> VOLATILITY_MAX<font color="#990000">)</font>

<i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900"> * Parameter rules, naming conventions:</font></i>
<i><font color="#9A1900"> * X - Strike</font></i>
<i><font color="#9A1900"> * S - Stock price right now</font></i>
<i><font color="#9A1900"> * T - Time to expiry as fraction of year. 6 months == 0.5, 9 months == 0.75</font></i>
<i><font color="#9A1900"> * r - Risk free interest rate. 10% == 0.10</font></i>
<i><font color="#9A1900"> * b - Cost of Carry. 10% == 0.10</font></i>
<i><font color="#9A1900"> * v - Volatility, 30% == 0.30</font></i>
<i><font color="#9A1900"> */</font></i>

<i><font color="#9A1900">/* Cumulative normal distribution */</font></i>
<font color="#009900">double</font> <b><font color="#000000">cnd</font></b><font color="#990000">(</font><font color="#009900">double</font> x<font color="#990000">);</font>

<i><font color="#9A1900">/* Cumulative bivariate normal distribution */</font></i>
<font color="#009900">double</font> <b><font color="#000000">cbnd</font></b><font color="#990000">(</font><font color="#009900">double</font> a<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> Rho<font color="#990000">);</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">blackscholes</font></b><font color="#990000">(</font><font color="#009900">int</font> fCall<font color="#990000">,</font> <font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>

<i><font color="#9A1900">/* gbs == generalized black &amp; scholes */</font></i>
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">gbs</font></b><font color="#990000">(</font><font color="#009900">int</font> fCall<font color="#990000">,</font> <font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">gbs_put</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">gbs_call</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">delta</font></b><font color="#990000">(</font><font color="#009900">int</font> fCall<font color="#990000">,</font> <font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">delta_put</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font>  <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">delta_call</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font>  <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">Gamma</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">carry</font></b><font color="#990000">(</font><font color="#009900">int</font> fCall<font color="#990000">,</font> <font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">carry_put</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font> 
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">carry_call</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">theta</font></b><font color="#990000">(</font><font color="#009900">int</font> fCall<font color="#990000">,</font> <font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">theta_put</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font> 
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">theta_call</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">rho</font></b><font color="#990000">(</font><font color="#009900">int</font> fCall<font color="#990000">,</font> <font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">rho_put</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">rho_call</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">black76</font></b><font color="#990000">(</font><font color="#009900">int</font> fCall<font color="#990000">,</font> <font color="#009900">double</font> F<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">black76_put</font></b><font color="#990000">(</font><font color="#009900">double</font> F<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font> 
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">black76_call</font></b><font color="#990000">(</font><font color="#009900">double</font> F<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font> 

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">blackscholes_put</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font> 
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">blackscholes_call</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font> 

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">french</font></b><font color="#990000">(</font><font color="#009900">int</font> fCall<font color="#990000">,</font> <font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> t1<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">french_put</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> t1<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">french_call</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> t1<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">vega</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>

<i><font color="#9A1900">/* American Calls on stocks with known dividends, Roll-Geske-Whaley */</font></i>
    <i><font color="#9A1900">/*t1 time to dividend payout */</font></i>
    <i><font color="#9A1900">/*T2 time to option expiration */</font></i>
<font color="#009900">double</font> <b><font color="#000000">RollGeskeWhaley</font></b><font color="#990000">(</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> t1<font color="#990000">,</font>
	<font color="#009900">double</font> T2<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> d<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>

<i><font color="#9A1900">/* The Barone-Adesi and Whaley (1987) American approximation */</font></i>
<font color="#009900">double</font> <b><font color="#000000">BAWAmericanApprox</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>

<i><font color="#9A1900">/* The Bjerksund and Stensland (1993) American approximation */</font></i>
<font color="#009900">double</font> <b><font color="#000000">BSAmericanApprox</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>

<i><font color="#9A1900">/* Partial-time fixed strike lookback options */</font></i>
<font color="#009900">double</font> <b><font color="#000000">PartialFixedLB</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> t1<font color="#990000">,</font>
	<font color="#009900">double</font> T2<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">EuropeanExchangeOption</font></b><font color="#990000">(</font>
	<font color="#009900">double</font> S1<font color="#990000">,</font>
	<font color="#009900">double</font> S2<font color="#990000">,</font>
	<font color="#009900">double</font> Q1<font color="#990000">,</font>
	<font color="#009900">double</font> Q2<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b1<font color="#990000">,</font>
	<font color="#009900">double</font> b2<font color="#990000">,</font>
	<font color="#009900">double</font> v1<font color="#990000">,</font>
	<font color="#009900">double</font> v2<font color="#990000">,</font>
	<font color="#009900">double</font> Rho<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">AmericanExchangeOption</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S1<font color="#990000">,</font>
	<font color="#009900">double</font> S2<font color="#990000">,</font>
	<font color="#009900">double</font> Q1<font color="#990000">,</font>
	<font color="#009900">double</font> Q2<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b1<font color="#990000">,</font>
	<font color="#009900">double</font> b2<font color="#990000">,</font>
	<font color="#009900">double</font> v1<font color="#990000">,</font>
	<font color="#009900">double</font> v2<font color="#990000">,</font>
	<font color="#009900">double</font> Rho<font color="#990000">);</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">AssetOrNothing_put</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">AssetOrNothing_call</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">AssetOrNothing</font></b><font color="#990000">(</font><font color="#009900">int</font> fCall<font color="#990000">,</font> <font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">BSAmericanCallApprox</font></b><font color="#990000">(</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">CashOrNothing</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> K<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">ComplexChooser</font></b><font color="#990000">(</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> Xc<font color="#990000">,</font>
	<font color="#009900">double</font> Xp<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> Tc<font color="#990000">,</font> 
	<font color="#009900">double</font> Tp<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">EquityLinkedFXO</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> E<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> rf<font color="#990000">,</font>
	<font color="#009900">double</font> q<font color="#990000">,</font>
	<font color="#009900">double</font> vS<font color="#990000">,</font>
	<font color="#009900">double</font> vE<font color="#990000">,</font>
	<font color="#009900">double</font> Rho<font color="#990000">);</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">Executive_call</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">,</font> <font color="#009900">double</font> lambda<font color="#990000">);</font>
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">Executive_put</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">,</font> <font color="#009900">double</font> lambda<font color="#990000">);</font>
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">Executive</font></b><font color="#990000">(</font><font color="#009900">int</font> fCall<font color="#990000">,</font> <font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> X<font color="#990000">,</font> <font color="#009900">double</font> T<font color="#990000">,</font> <font color="#009900">double</font> r<font color="#990000">,</font> <font color="#009900">double</font> b<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">,</font> <font color="#009900">double</font> lambda<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">ExchangeExchangeOption</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> TypeFlag<font color="#990000">,</font>
	<font color="#009900">double</font> S1<font color="#990000">,</font>
	<font color="#009900">double</font> S2<font color="#990000">,</font>
	<font color="#009900">double</font> q<font color="#990000">,</font>
	<font color="#009900">double</font> t1<font color="#990000">,</font>
	<font color="#009900">double</font> T2<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b1<font color="#990000">,</font>
	<font color="#009900">double</font> b2<font color="#990000">,</font>
	<font color="#009900">double</font> v1<font color="#990000">,</font>
	<font color="#009900">double</font> v2<font color="#990000">,</font>
	<font color="#009900">double</font> Rho<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">ExtendibleWriter</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X1<font color="#990000">,</font>
	<font color="#009900">double</font> X2<font color="#990000">,</font>
	<font color="#009900">double</font> t1<font color="#990000">,</font>
	<font color="#009900">double</font> T2<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>



<i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900"> * We have four different types of extreme spread options, the regular put/call</font></i>
<i><font color="#9A1900"> * as well as extreme or "reverse extreme". We use some defined constants for this.</font></i>
<i><font color="#9A1900"> * Use one of them as typeflag.</font></i>
<i><font color="#9A1900"> */</font></i>
<b><font color="#000080">#define</font></b> ESO_CALL			<font color="#993399">1</font>
<b><font color="#000080">#define</font></b> ESO_PUT				<font color="#993399">2</font>
<b><font color="#000080">#define</font></b> ESO_REVERSE_CALL	<font color="#993399">3</font>
<b><font color="#000080">#define</font></b> ESO_REVERSE_PUT		<font color="#993399">4</font>
<font color="#009900">double</font> <b><font color="#000000">ExtremeSpreadOption</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> TypeFlag<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> SMin<font color="#990000">,</font>
	<font color="#009900">double</font> SMax<font color="#990000">,</font>
	<font color="#009900">double</font> t1<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font> 

<font color="#009900">double</font> <b><font color="#000000">FixedStrikeLookback</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> SMin<font color="#990000">,</font>
	<font color="#009900">double</font> SMax<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">FloatingStrikeLookback</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> SMin<font color="#990000">,</font>
	<font color="#009900">double</font> SMax<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>


<font color="#009900">double</font> <b><font color="#000000">ForEquOptInDomCur</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> E<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> q<font color="#990000">,</font>
	<font color="#009900">double</font> vS<font color="#990000">,</font>
	<font color="#009900">double</font> vE<font color="#990000">,</font>
	<font color="#009900">double</font> Rho<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">ForwardStartOption</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> alpha<font color="#990000">,</font>
	<font color="#009900">double</font> t1<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">GapOption</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X1<font color="#990000">,</font>
	<font color="#009900">double</font> X2<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">GeometricAverageRateOption</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> SA<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> T2<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">JumpDiffusion</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">,</font>
	<font color="#009900">double</font> lambda<font color="#990000">,</font>
	<font color="#009900">double</font> gamma_val<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">LevyAsian</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> SA<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> T2<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">MiltersenSchwartz</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> Pt<font color="#990000">,</font>
	<font color="#009900">double</font> FT<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> t1<font color="#990000">,</font>
	<font color="#009900">double</font> T2<font color="#990000">,</font>
	<font color="#009900">double</font> vS<font color="#990000">,</font>
	<font color="#009900">double</font> vE<font color="#990000">,</font>
	<font color="#009900">double</font> vf<font color="#990000">,</font>
	<font color="#009900">double</font> rhoSe<font color="#990000">,</font>
	<font color="#009900">double</font> rhoSf<font color="#990000">,</font>
	<font color="#009900">double</font> rhoef<font color="#990000">,</font>
	<font color="#009900">double</font> Kappae<font color="#990000">,</font>
	<font color="#009900">double</font> Kappaf<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">OptionsOnTheMaxMin</font></b><font color="#990000">(</font>
	<b><font color="#0000FF">const</font></b> <font color="#009900">char</font><font color="#990000">*</font> TypeFlag<font color="#990000">,</font>
	<font color="#009900">double</font> S1<font color="#990000">,</font>
	<font color="#009900">double</font> S2<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b1<font color="#990000">,</font>
	<font color="#009900">double</font> b2<font color="#990000">,</font>
	<font color="#009900">double</font> v1<font color="#990000">,</font>
	<font color="#009900">double</font> v2<font color="#990000">,</font>
	<font color="#009900">double</font> Rho<font color="#990000">);</font>

<i><font color="#9A1900">/* We can have a couple of combinations for OoO, </font></i>
<i><font color="#9A1900"> * and use an integer to define the combos. No enums since</font></i>
<i><font color="#9A1900"> * that makes it harder to call the function from other languages.</font></i>
<i><font color="#9A1900"> */</font></i>
<b><font color="#000080">#define</font></b> OOO_PUT_ON_CALL		<font color="#993399">1</font>
<b><font color="#000080">#define</font></b> OOO_CALL_ON_CALL	<font color="#993399">2</font>
<b><font color="#000080">#define</font></b> OOO_PUT_ON_PUT 		<font color="#993399">3</font>
<b><font color="#000080">#define</font></b> OOO_CALL_ON_PUT		<font color="#993399">4</font>
<font color="#009900">double</font> <b><font color="#000000">OptionsOnOptions</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> typeflag<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X1<font color="#990000">,</font>
	<font color="#009900">double</font> X2<font color="#990000">,</font>
	<font color="#009900">double</font> t1<font color="#990000">,</font>
	<font color="#009900">double</font> T2<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">PartialFloatLB</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> SMin<font color="#990000">,</font>
	<font color="#009900">double</font> SMax<font color="#990000">,</font>
	<font color="#009900">double</font> t1<font color="#990000">,</font>
	<font color="#009900">double</font> T2<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">,</font>
	<font color="#009900">double</font> lambda<font color="#990000">);</font>


<i><font color="#9A1900">/*************** BARRIER FORMULAS START ******************/</font></i>
<font color="#009900">double</font> <b><font color="#000000">BinaryBarrier</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> TypeFlag<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> H<font color="#990000">,</font>
	<font color="#009900">double</font> K<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">,</font>
	<font color="#009900">int</font> eta<font color="#990000">,</font>
	<font color="#009900">int</font> phi<font color="#990000">);</font>

<i><font color="#9A1900">/* We have 4 types of DoubleBarrier options, defined here */</font></i>
<b><font color="#000080">#define</font></b> DB_PUT_IN		<font color="#993399">1</font>
<b><font color="#000080">#define</font></b> DB_PUT_OUT		<font color="#993399">2</font>
<b><font color="#000080">#define</font></b> DB_CALL_IN		<font color="#993399">3</font>
<b><font color="#000080">#define</font></b> DB_CALL_OUT		<font color="#993399">4</font>
<font color="#009900">double</font> <b><font color="#000000">DoubleBarrier</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> TypeFlag<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> L<font color="#990000">,</font>
	<font color="#009900">double</font> U<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">,</font>
	<font color="#009900">double</font> delta1<font color="#990000">,</font>
	<font color="#009900">double</font> delta2<font color="#990000">);</font>


<font color="#009900">double</font> <b><font color="#000000">DiscreteAdjustedBarrier</font></b><font color="#990000">(</font><font color="#009900">double</font> S<font color="#990000">,</font> <font color="#009900">double</font> H<font color="#990000">,</font> <font color="#009900">double</font> v<font color="#990000">,</font> <font color="#009900">double</font> dt<font color="#990000">);</font>
<i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900"> * Option types for StandardBarrier(), LookBarrier(),</font></i>
<i><font color="#9A1900"> * PartialTimeTwoAssetBarrier() and SoftBarrier() .</font></i>
<i><font color="#9A1900"> * LookBarrier() accepts </font></i>
<i><font color="#9A1900"> * 		SB_CALL_UP_OUT, </font></i>
<i><font color="#9A1900"> * 		SB_PUT_DOWN_OUT, </font></i>
<i><font color="#9A1900"> * 		SB_CALL_UP_IN and </font></i>
<i><font color="#9A1900"> * 		SB_PUT_DOWN_IN</font></i>
<i><font color="#9A1900"> * BarrierBinominal() uses: </font></i>
<i><font color="#9A1900"> * 		SB_CALL_UP_OUT, </font></i>
<i><font color="#9A1900"> * 		SB_CALL_DOWN_OUT, </font></i>
<i><font color="#9A1900"> * 		SB_PUT_UP_OUT, </font></i>
<i><font color="#9A1900"> * 		SB_PUT_DOWN_OUT</font></i>
<i><font color="#9A1900"> */</font></i>
<b><font color="#000080">#define</font></b> SB_CALL_DOWN_IN		<font color="#993399">1</font>
<b><font color="#000080">#define</font></b> SB_CALL_DOWN_OUT	<font color="#993399">2</font>
<b><font color="#000080">#define</font></b> SB_CALL_UP_IN		<font color="#993399">3</font>
<b><font color="#000080">#define</font></b> SB_CALL_UP_OUT		<font color="#993399">4</font>
<b><font color="#000080">#define</font></b> SB_PUT_DOWN_IN		<font color="#993399">5</font>
<b><font color="#000080">#define</font></b> SB_PUT_DOWN_OUT		<font color="#993399">6</font>
<b><font color="#000080">#define</font></b> SB_PUT_UP_IN		<font color="#993399">7</font>
<b><font color="#000080">#define</font></b> SB_PUT_UP_OUT		<font color="#993399">8</font>
<font color="#009900">double</font> <b><font color="#000000">StandardBarrier</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> typeflag<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> H<font color="#990000">,</font>
	<font color="#009900">double</font> K<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">SoftBarrier</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> typeflag<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> L<font color="#990000">,</font>
	<font color="#009900">double</font> U<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font> 

<font color="#009900">double</font> <b><font color="#000000">PartialTimeTwoAssetBarrier</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> typeflag<font color="#990000">,</font>
	<font color="#009900">double</font> S1<font color="#990000">,</font>
	<font color="#009900">double</font> S2<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> H<font color="#990000">,</font>
	<font color="#009900">double</font> t1<font color="#990000">,</font>
	<font color="#009900">double</font> T2<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b1<font color="#990000">,</font>
	<font color="#009900">double</font> b2<font color="#990000">,</font>
	<font color="#009900">double</font> v1<font color="#990000">,</font>
	<font color="#009900">double</font> v2<font color="#990000">,</font>
	<font color="#009900">double</font> Rho<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">LookBarrier</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> type<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> H<font color="#990000">,</font>
	<font color="#009900">double</font> t1<font color="#990000">,</font>
	<font color="#009900">double</font> T2<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">BarrierBinomial</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> EuropeanOption<font color="#990000">,</font>
	<font color="#009900">int</font> type<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> H<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">,</font>
	<font color="#009900">int</font> n<font color="#990000">);</font>



<i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900"> * Partial time barrier accepts the following option types:</font></i>
<i><font color="#9A1900"> * NOTE: See the </font></i><b>TODO</b><i><font color="#9A1900"> file ASAP, as in Before you do anything else.</font></i>
<i><font color="#9A1900"> */</font></i>
<b><font color="#000080">#define</font></b> PTB_CALL_UP_OUT_A		<font color="#993399">1</font>
<b><font color="#000080">#define</font></b> PTB_CALL_DOWN_OUT_A		<font color="#993399">2</font>
<b><font color="#000080">#define</font></b> PTB_CALL_DOWN_OUT_B1	<font color="#993399">3</font>
<b><font color="#000080">#define</font></b> PTB_CALL_DOWN_OUT_B2	<font color="#993399">4</font>
<b><font color="#000080">#define</font></b> PTB_CALL_UP_OUT_B2		<font color="#993399">5</font>
<b><font color="#000080">#define</font></b> PTB_CALL_OUT_B1			<font color="#993399">6</font>
<b><font color="#000080">#define</font></b> PTB_PUT_DOWN_OUT_A		<font color="#993399">7</font>
<b><font color="#000080">#define</font></b> PTB_PUT_UP_OUT_A		<font color="#993399">8</font>
<b><font color="#000080">#define</font></b> PTB_PUT_OUT_B1			<font color="#993399">9</font>
<b><font color="#000080">#define</font></b> PTB_PUT_DOWN_OUT_B2		<font color="#993399">10</font>

<font color="#009900">double</font> <b><font color="#000000">PartialTimeBarrier</font></b><font color="#990000">(</font>
	<b><font color="#0000FF">const</font></b> <font color="#009900">char</font><font color="#990000">*</font> TypeFlag<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> H<font color="#990000">,</font>
	<font color="#009900">double</font> t1<font color="#990000">,</font>
	<font color="#009900">double</font> T2<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">TwoAssetBarrier</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> type<font color="#990000">,</font>
	<font color="#009900">double</font> S1<font color="#990000">,</font>
	<font color="#009900">double</font> S2<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> H<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b1<font color="#990000">,</font>
	<font color="#009900">double</font> b2<font color="#990000">,</font>
	<font color="#009900">double</font> v1<font color="#990000">,</font>
	<font color="#009900">double</font> v2<font color="#990000">,</font>
	<font color="#009900">double</font> Rho<font color="#990000">);</font> 

<i><font color="#9A1900">/*************** BARRIER FORMULAS END  ******************/</font></i>

<font color="#009900">double</font> <b><font color="#000000">Quanto</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> Ep<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> rf<font color="#990000">,</font>
	<font color="#009900">double</font> q<font color="#990000">,</font>
	<font color="#009900">double</font> vS<font color="#990000">,</font>
	<font color="#009900">double</font> vE<font color="#990000">,</font>
	<font color="#009900">double</font> Rho<font color="#990000">);</font> 

<font color="#009900">double</font> <b><font color="#000000">SimpleChooser</font></b><font color="#990000">(</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> t1<font color="#990000">,</font>
	<font color="#009900">double</font> T2<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font> 

<font color="#009900">double</font> <b><font color="#000000">SpreadApproximation</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> f1<font color="#990000">,</font>
	<font color="#009900">double</font> f2<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> v1<font color="#990000">,</font>
	<font color="#009900">double</font> v2<font color="#990000">,</font>
	<font color="#009900">double</font> Rho<font color="#990000">);</font> 

<font color="#009900">double</font> <b><font color="#000000">SuperShare</font></b><font color="#990000">(</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> XL<font color="#990000">,</font>
	<font color="#009900">double</font> XH<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font> 

<font color="#009900">double</font> <b><font color="#000000">TakeoverFXoption</font></b><font color="#990000">(</font>
	<font color="#009900">double</font> v<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> E<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> rf<font color="#990000">,</font>
	<font color="#009900">double</font> vV<font color="#990000">,</font>
	<font color="#009900">double</font> vE<font color="#990000">,</font>
	<font color="#009900">double</font> Rho<font color="#990000">);</font> 

<font color="#009900">double</font> <b><font color="#000000">TimeSwitchOption</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> a<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">int</font> m <font color="#990000">,</font>
	<font color="#009900">double</font> dt<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font> 

<font color="#009900">double</font> <b><font color="#000000">TurnbullWakemanAsian</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> SA<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> T2<font color="#990000">,</font>
	<font color="#009900">double</font> tau<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font> 

<font color="#009900">double</font> <b><font color="#000000">TwoAssetCashOrNothing</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> TypeFlag<font color="#990000">,</font>
	<font color="#009900">double</font> S1<font color="#990000">,</font>
	<font color="#009900">double</font> S2<font color="#990000">,</font>
	<font color="#009900">double</font> X1<font color="#990000">,</font>
	<font color="#009900">double</font> X2<font color="#990000">,</font>
	<font color="#009900">double</font> K<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font> 
	<font color="#009900">double</font> b1<font color="#990000">,</font>
	<font color="#009900">double</font> b2<font color="#990000">,</font>
	<font color="#009900">double</font> v1<font color="#990000">,</font>
	<font color="#009900">double</font> v2<font color="#990000">,</font>
	<font color="#009900">double</font> Rho<font color="#990000">);</font> 

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">TwoAssetCorrelation</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S1<font color="#990000">,</font>
	<font color="#009900">double</font> S2<font color="#990000">,</font>
	<font color="#009900">double</font> X1<font color="#990000">,</font>
	<font color="#009900">double</font> X2<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> b1<font color="#990000">,</font>
	<font color="#009900">double</font> b2<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> v1<font color="#990000">,</font>
	<font color="#009900">double</font> v2<font color="#990000">,</font>
	<font color="#009900">double</font> Rho<font color="#990000">);</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">merton73</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> q<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font> 

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">GarmanKohlhagen</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>	<i><font color="#9A1900">/* Risk free rate for the currency */</font></i>
	<font color="#009900">double</font> rf<font color="#990000">,</font>	<i><font color="#9A1900">/* Risk free rate for the foreign currency */</font></i>
	<font color="#009900">double</font> v<font color="#990000">);</font> 

<i><font color="#9A1900">/* Find the Implied Volatility for a european stock option */</font></i>
<b><font color="#0000FF">extern</font></b> <font color="#009900">int</font> <b><font color="#000000">NewtonRaphson</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> cm<font color="#990000">,</font>
	<font color="#009900">double</font> <font color="#990000">*</font>piv<font color="#990000">);</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">int</font> <b><font color="#000000">NewtonRaphson_put</font></b><font color="#990000">(</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> cm<font color="#990000">,</font>
	<font color="#009900">double</font> <font color="#990000">*</font>piv<font color="#990000">);</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">int</font> <b><font color="#000000">NewtonRaphson_call</font></b><font color="#990000">(</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> cm<font color="#990000">,</font>
	<font color="#009900">double</font> <font color="#990000">*</font>piv<font color="#990000">);</font>

<i><font color="#9A1900">/* Black-76 European swap option */</font></i>
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">Swapoption</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> t1<font color="#990000">,</font>
	<font color="#009900">double</font> m<font color="#990000">,</font>
	<font color="#009900">double</font> F<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">VasicekBondPrice</font></b><font color="#990000">(</font>
	<font color="#009900">double</font> t1<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> Theta<font color="#990000">,</font>
	<font color="#009900">double</font> Kappa<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>

<font color="#009900">double</font> <b><font color="#000000">VasicekBondOption</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> F<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> tau<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> Theta<font color="#990000">,</font>
	<font color="#009900">double</font> kappa<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">);</font>

<i><font color="#9A1900">/* </font></i>
<i><font color="#9A1900"> * Bisection algorithm for finding IV </font></i>
<i><font color="#9A1900"> * using BAWAmericanApprox() to compute value.</font></i>
<i><font color="#9A1900"> */</font></i>
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">BAWbisection</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> price<font color="#990000">);</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">BSbisection</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> price<font color="#990000">);</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">int</font> <b><font color="#000000">bisection</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> price<font color="#990000">,</font>
	<font color="#009900">double</font> <font color="#990000">*</font>piv<font color="#990000">);</font>

<i><font color="#9A1900">/* Cox-Ross-Rubinstein binomial tree */</font></i>
<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">CRRBinomial</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> EuropeanOption<font color="#990000">,</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">,</font>
	<font color="#009900">int</font> n<font color="#990000">);</font>

<i><font color="#9A1900">/* Convertible bonds in binomial trees.</font></i>
<i><font color="#9A1900"> * T2: Time to maturity </font></i>
<i><font color="#9A1900"> * t1: Time to to first conversion date, only used when the option is American </font></i>
<i><font color="#9A1900"> * k   Issuer's credit spread above risk-free return(similar Treasuries). </font></i>
<i><font color="#9A1900"> * q   Stock dividend yield </font></i>
<i><font color="#9A1900"> * v:  Stock volatility </font></i>
<i><font color="#9A1900"> * n:  Number of time-steps in the tree </font></i>
<i><font color="#9A1900"> * F   Bond face value </font></i>
<i><font color="#9A1900"> */</font></i>

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">ConvertibleBond</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> EuropeanOption<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T2<font color="#990000">,</font>
	<font color="#009900">double</font> t1<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> k<font color="#990000">,</font>
	<font color="#009900">double</font> q<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">,</font>
	<font color="#009900">double</font> F<font color="#990000">,</font>
	<font color="#009900">double</font> Coupon<font color="#990000">,</font>
	<font color="#009900">int</font> n<font color="#990000">);</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">TrinomialTree</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> EuropeanOption<font color="#990000">,</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">,</font>
	<font color="#009900">double</font> n<font color="#990000">);</font>

<i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900"> * The TypeFlag can have 7 different values, from 1..7.</font></i>
<i><font color="#9A1900"> * The TDB_ prefix is short for ThreeDimensionalBinominal_</font></i>
<i><font color="#9A1900"> * As usual, we don't use an enum to support more (calling) languages.</font></i>
<i><font color="#9A1900"> */</font></i>
<b><font color="#000080">#define</font></b> TDB_SPREAD_OPTION 				<font color="#993399">1</font>
<b><font color="#000080">#define</font></b> TDB_OPTION_ON_THE_MAX			<font color="#993399">2</font> <i><font color="#9A1900">/* between two assets */</font></i>
<b><font color="#000080">#define</font></b> TDB_OPTION_ON_THE_MIN			<font color="#993399">3</font> <i><font color="#9A1900">/* between two assets */</font></i>
<b><font color="#000080">#define</font></b> TDB_DUAL_STRIKE_OPTION			<font color="#993399">4</font>
<b><font color="#000080">#define</font></b> TDB_REVERSE_DUAL_STRIKE_OPTION	<font color="#993399">5</font>
<b><font color="#000080">#define</font></b> TDB_PORTFOLIO_OPTION			<font color="#993399">6</font>
<b><font color="#000080">#define</font></b> TDB_EXCHANGE_OPTION				<font color="#993399">7</font>

<b><font color="#000080">#define</font></b> TDB_OPTIONTYPE_MIN				<font color="#993399">1</font>
<b><font color="#000080">#define</font></b> TDB_OPTIONTYPE_MAX				<font color="#993399">7</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">ThreeDimensionalBinomial</font></b><font color="#990000">(</font>
	<font color="#009900">int</font> type<font color="#990000">,</font>
	<font color="#009900">int</font> EuropeanOption<font color="#990000">,</font>
	<font color="#009900">int</font> fCall<font color="#990000">,</font>
	<font color="#009900">double</font> S1<font color="#990000">,</font>
	<font color="#009900">double</font> S2<font color="#990000">,</font>
	<font color="#009900">double</font> Q1<font color="#990000">,</font>
	<font color="#009900">double</font> Q2<font color="#990000">,</font>
	<font color="#009900">double</font> X1<font color="#990000">,</font>
	<font color="#009900">double</font> X2<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b1<font color="#990000">,</font>
	<font color="#009900">double</font> b2<font color="#990000">,</font>
	<font color="#009900">double</font> v1<font color="#990000">,</font>
	<font color="#009900">double</font> v2<font color="#990000">,</font>
	<font color="#009900">double</font> Rho<font color="#990000">,</font>
	<font color="#009900">int</font> n<font color="#990000">);</font>

<b><font color="#0000FF">extern</font></b> <font color="#009900">double</font> <b><font color="#000000">ImpliedTrinomialTree</font></b><font color="#990000">(</font>
	<b><font color="#0000FF">const</font></b> <font color="#009900">char</font><font color="#990000">*</font> ReturnFlag<font color="#990000">,</font>
	<font color="#009900">int</font> STEPn<font color="#990000">,</font>
	<font color="#009900">int</font> STATEi<font color="#990000">,</font>
	<font color="#009900">double</font> S<font color="#990000">,</font>
	<font color="#009900">double</font> X<font color="#990000">,</font>
	<font color="#009900">double</font> T<font color="#990000">,</font>
	<font color="#009900">double</font> r<font color="#990000">,</font>
	<font color="#009900">double</font> b<font color="#990000">,</font>
	<font color="#009900">double</font> v<font color="#990000">,</font>
	<font color="#009900">double</font> Skew<font color="#990000">,</font>
	<font color="#009900">int</font> nSteps<font color="#990000">);</font>

<b><font color="#000080">#endif</font></b>


</tt></pre>
