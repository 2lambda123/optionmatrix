<!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><i><font color="#9A1900">/* optionmatrix:                                                            */</font></i>
<i><font color="#9A1900">/*                                                                          */</font></i>
<i><font color="#9A1900">/* Options &amp; Futures Matrix Modeler                                         */</font></i>
<i><font color="#9A1900">/* View and Control Theoretical Option Chains                               */</font></i>
<i><font color="#9A1900">/*                                                                          */</font></i>
<i><font color="#9A1900">/* File: options_puts.cpp of optionmatrix                                   */</font></i>
<i><font color="#9A1900">/*                                                                          */</font></i>
<i><font color="#9A1900">/* Copyright (c) Anthony Bradford. 2012.                                    */</font></i>
<i><font color="#9A1900">/* </font></i><u><font color="#0000FF">http://anthonybradford.com</font></u><i><font color="#9A1900">                                               */</font></i>
<i><font color="#9A1900">/* </font></i><u><font color="#0000FF">info@anthonybradford.com</font></u><i><font color="#9A1900">                                                 */</font></i>
<i><font color="#9A1900">/*                                                                          */</font></i>
<i><font color="#9A1900">/* optionmatrix may be freely redistributed.                                */</font></i>
<i><font color="#9A1900">/* See file COPYING included with this distribution for license information */</font></i>

<i><font color="#9A1900">/* </font></i>
<i><font color="#9A1900">   optionmatrix program is free software; you can redistribute it and/or modify</font></i>
<i><font color="#9A1900">   it under the terms of the GNU General Public License as published by</font></i>
<i><font color="#9A1900">   the Free Software Foundation; either version 3 of the License, or</font></i>
<i><font color="#9A1900">   (at your option) any later version.</font></i>

<i><font color="#9A1900">   optionmatrix program is distributed in the hope that it will be useful,</font></i>
<i><font color="#9A1900">   but WITHOUT ANY WARRANTY; without even the implied warranty of</font></i>
<i><font color="#9A1900">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</font></i>
<i><font color="#9A1900">   GNU General Public License for more details.</font></i>

<i><font color="#9A1900">   You should have received a copy of the GNU General Public License</font></i>
<i><font color="#9A1900">   along with this program.  If not, see </font></i><u><font color="#0000FF">&lt;http://www.gnu.org/licenses/&gt;</font></u><i><font color="#9A1900">.</font></i>
<i><font color="#9A1900">*/</font></i>

<b><font color="#000080">#include</font></b> <font color="#FF0000">"defs.h"</font>
<b><font color="#000080">#include</font></b> <font color="#FF0000">"extern.h"</font>
<b><font color="#000080">#include</font></b> <font color="#FF0000">"prototypes.h"</font>

<b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <b><font color="#000000">option_put</font></b><font color="#990000">(</font><b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <font color="#990000">*</font>dat<font color="#990000">)</font>
<font color="#FF0000">{</font>
  <font color="#009900">double</font> putprice<font color="#990000">;</font>

  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> price <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>price<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> strike <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>strike<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> rate <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>rate<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> t  <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>t<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]</font> <font color="#990000">-</font> dat<font color="#990000">-&gt;</font>te<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> t2 <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>t<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">-</font> dat<font color="#990000">-&gt;</font>te2<font color="#990000">;</font>
  <i><font color="#9A1900">// no model using t3 for puts yet...</font></i>
  <i><font color="#9A1900">//const double t3 = dat-&gt;t[2] - dat-&gt;te3;</font></i>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> volatility <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>volatility<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> dividend <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>dividend<font color="#990000">;</font>

  <font color="#009900">double</font> putdelta<font color="#990000">;</font> <i><font color="#9A1900">/* this is a dummy variable */</font></i>
  putdelta <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

  <b><font color="#0000FF">if</font></b><font color="#990000">(</font>t <font color="#990000">&lt;=</font> <font color="#993399">0.0</font><font color="#990000">)</font>
  <font color="#FF0000">{</font>
    dat<font color="#990000">-&gt;</font>put <font color="#990000">=</font> <font color="#993399">0.0</font><font color="#990000">;</font>

    <b><font color="#0000FF">return</font></b> <font color="#990000">*</font>dat<font color="#990000">;</font>
  <font color="#FF0000">}</font>

  <b><font color="#0000FF">try</font></b> <font color="#FF0000">{</font>

  <b><font color="#0000FF">switch</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>modeltype<font color="#990000">)</font>
  <font color="#FF0000">{</font>

<b><font color="#000080">#ifdef</font></b> ABRADFORD

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">black_scholes_put</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>t<font color="#990000">,</font>volatility<font color="#990000">,&amp;</font>putdelta<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> MERTON73<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">merton73_put</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>t<font color="#990000">,</font>volatility<font color="#990000">,</font>dividend<font color="#990000">,&amp;</font>putdelta<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BLACK76<font color="#990000">:</font>
      
      putprice <font color="#990000">=</font> <b><font color="#000000">black76put</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>t<font color="#990000">,</font>volatility<font color="#990000">,&amp;</font>putdelta<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

  <b><font color="#0000FF">case</font></b> BACHELIER<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">bachelier_put</font></b><font color="#990000">(</font>price<font color="#990000">,</font> strike<font color="#990000">,</font> t<font color="#990000">,</font> volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

  <b><font color="#0000FF">case</font></b> BACHELIERMODIFIED<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">bachelier_modified_put</font></b><font color="#990000">(</font>price<font color="#990000">,</font> strike<font color="#990000">,</font> rate<font color="#990000">,</font> t<font color="#990000">,</font> volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

  <b><font color="#0000FF">case</font></b> SPRENKLE<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

  <b><font color="#0000FF">case</font></b> BONESS<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

  <b><font color="#0000FF">case</font></b> SAMUELSON<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> SPINSKY

    <b><font color="#0000FF">case</font></b> AMERICAN_CRR<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#008080">Ivar</font> data<font color="#990000">;</font>
        data<font color="#990000">.</font>S <font color="#990000">=</font> data<font color="#990000">.</font>X <font color="#990000">=</font> data<font color="#990000">.</font>T <font color="#990000">=</font> data<font color="#990000">.</font>sigma <font color="#990000">=</font> data<font color="#990000">.</font>mu <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
        
        data<font color="#990000">.</font>S <font color="#990000">=</font> price<font color="#990000">;</font>
        data<font color="#990000">.</font>X <font color="#990000">=</font> strike<font color="#990000">;</font>
        data<font color="#990000">.</font>T <font color="#990000">=</font> t<font color="#990000">;</font>
        data<font color="#990000">.</font>sigma <font color="#990000">=</font> volatility<font color="#990000">;</font>
        data<font color="#990000">.</font>mu <font color="#990000">=</font> rate<font color="#990000">;</font>

        putprice <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <b><font color="#000000">option_price</font></b><font color="#990000">(</font>data<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>AMERPUT<font color="#990000">,</font>CRR<font color="#990000">);</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERICAN_EQUIPROB<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#008080">Ivar</font> data<font color="#990000">;</font>
        data<font color="#990000">.</font>S <font color="#990000">=</font> data<font color="#990000">.</font>X <font color="#990000">=</font> data<font color="#990000">.</font>T <font color="#990000">=</font> data<font color="#990000">.</font>sigma <font color="#990000">=</font> data<font color="#990000">.</font>mu <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
        
        data<font color="#990000">.</font>S <font color="#990000">=</font> price<font color="#990000">;</font>
        data<font color="#990000">.</font>X <font color="#990000">=</font> strike<font color="#990000">;</font>
        data<font color="#990000">.</font>T <font color="#990000">=</font> t<font color="#990000">;</font>
        data<font color="#990000">.</font>sigma <font color="#990000">=</font> volatility<font color="#990000">;</font>
        data<font color="#990000">.</font>mu <font color="#990000">=</font> rate<font color="#990000">;</font>

        putprice <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <b><font color="#000000">option_price</font></b><font color="#990000">(</font>data<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>AMERPUT<font color="#990000">,</font>EQUIPROB<font color="#990000">);</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EURO_CRR<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#008080">Ivar</font> data<font color="#990000">;</font>
        data<font color="#990000">.</font>S <font color="#990000">=</font> data<font color="#990000">.</font>X <font color="#990000">=</font> data<font color="#990000">.</font>T <font color="#990000">=</font> data<font color="#990000">.</font>sigma <font color="#990000">=</font> data<font color="#990000">.</font>mu <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

        data<font color="#990000">.</font>S <font color="#990000">=</font> price<font color="#990000">;</font>
        data<font color="#990000">.</font>X <font color="#990000">=</font> strike<font color="#990000">;</font>
        data<font color="#990000">.</font>T <font color="#990000">=</font> t<font color="#990000">;</font>
        data<font color="#990000">.</font>sigma <font color="#990000">=</font> volatility<font color="#990000">;</font>
        data<font color="#990000">.</font>mu <font color="#990000">=</font> rate<font color="#990000">;</font>

        putprice <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <b><font color="#000000">option_price</font></b><font color="#990000">(</font>data<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>EUROPUT<font color="#990000">,</font>CRR<font color="#990000">);</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EURO_EQUIPROB <font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#008080">Ivar</font> data<font color="#990000">;</font>
        data<font color="#990000">.</font>S <font color="#990000">=</font> data<font color="#990000">.</font>X <font color="#990000">=</font> data<font color="#990000">.</font>T <font color="#990000">=</font> data<font color="#990000">.</font>sigma <font color="#990000">=</font> data<font color="#990000">.</font>mu <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
      
        data<font color="#990000">.</font>S <font color="#990000">=</font> price<font color="#990000">;</font>
        data<font color="#990000">.</font>X <font color="#990000">=</font> strike<font color="#990000">;</font>
        data<font color="#990000">.</font>T <font color="#990000">=</font> t<font color="#990000">;</font>
        data<font color="#990000">.</font>sigma <font color="#990000">=</font> volatility<font color="#990000">;</font>
        data<font color="#990000">.</font>mu <font color="#990000">=</font> rate<font color="#990000">;</font>

        putprice <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <b><font color="#000000">option_price</font></b><font color="#990000">(</font>data<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>EUROPUT<font color="#990000">,</font>EQUIPROB<font color="#990000">);</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> METAOPTIONS

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES2<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">blackscholes</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> GBS<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">gbs</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> MERTON73B<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">merton73</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> GFRENCH<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">french</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t2<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> GCARRY<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">carry</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BAWAMERICAN<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">BAWAmericanApprox</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BSAMERICAN<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">BSAmericanApprox</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BLACK76B<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">black76</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> ASSETORNOTHING<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">AssetOrNothing</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> CASHORNOTHING<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">CashOrNothing</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EXTENDIBLEWRITER<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> t2 <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
      <font color="#FF0000">}</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">ExtendibleWriter</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>t2<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>
      
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> CALLSONOPTIONS<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> t2 <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
      <font color="#FF0000">}</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">OptionsOnOptions</font></b><font color="#990000">(</font>OOO_CALL_ON_PUT<font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>t2<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font><font color="#993399">0</font><font color="#990000">,</font>volatility<font color="#990000">);</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> PUTSONOPTIONS<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">OptionsOnOptions</font></b><font color="#990000">(</font>OOO_PUT_ON_PUT<font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>t2<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> ROLLGESKEWHALEY<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EXTREMESPREADOPTION<font color="#990000">:</font>

      putprice <font color="#990000">=</font>  <b><font color="#000000">ExtremeSpreadOption</font></b><font color="#990000">(</font>transextremeoptionput<font color="#990000">[</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">],</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> t2<font color="#990000">),</font>t<font color="#990000">,</font>rate<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> dividend<font color="#990000">),</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EXTREMESPREADOPTION2<font color="#990000">:</font>

      putprice <font color="#990000">=</font>  <b><font color="#000000">ExtremeSpreadOption</font></b><font color="#990000">(</font>transextremeoptionput<font color="#990000">[</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">],</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>strike<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> t2<font color="#990000">),</font>t<font color="#990000">,</font>rate<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> dividend<font color="#990000">),</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SIMPLECHOOSER<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> PARTIALFIXEDLB<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> t2 <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
      <font color="#FF0000">}</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">PartialFixedLB</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> t2<font color="#990000">),</font>t<font color="#990000">,</font>rate<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> dividend<font color="#990000">),</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

      <font color="#FF0000">}</font>

    <b><font color="#0000FF">case</font></b> PARTIALTIMEBARRIER<font color="#990000">:</font>

        <i><font color="#9A1900">//putprice = PartialTimeBarrier("pdoA",price,strike,dat-&gt;UseZ,t2,t,rate,dividend,volatility);</font></i>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EXECUTIVE<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">Executive</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> GARMANKOHLHAGEN<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">GarmanKohlhagen</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> LOOKBARRIER<font color="#990000">:</font>
     <font color="#FF0000">{</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> t2 <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
      <font color="#FF0000">}</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">LookBarrier</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">+</font><font color="#993399">4</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> t2<font color="#990000">),</font>t<font color="#990000">,</font>rate<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> dividend<font color="#990000">),</font>volatility<font color="#990000">);</font>

     <font color="#FF0000">}</font>

     <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> GAPOPTION<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">GapOption</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> JUMPDIFFUSION<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">JumpDiffusion</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BISECTION<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <font color="#009900">double</font> pprice<font color="#990000">;</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> <b><font color="#000000">bisection</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,&amp;</font>pprice<font color="#990000">)</font> <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
        putprice <font color="#990000">=</font> pprice<font color="#990000">;</font>
      <b><font color="#0000FF">else</font></b>
        putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> NEWTONRAPHSON<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <font color="#009900">double</font> pprice<font color="#990000">;</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> <b><font color="#000000">NewtonRaphson</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,&amp;</font>pprice<font color="#990000">)</font> <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
        putprice <font color="#990000">=</font> pprice<font color="#990000">;</font>
      <b><font color="#0000FF">else</font></b>
        putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BAWBISECTION<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">BAWbisection</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BSBISECTION<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">BSbisection</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SWAPOPTION<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">Swapoption</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t2<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> TURNBULLWAKEMANASIAN<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> t2 <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
      <font color="#FF0000">}</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">TurnbullWakemanAsian</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>t2<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

      <font color="#FF0000">}</font>

    <b><font color="#0000FF">case</font></b> COMPLEXCHOOSER<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SUPERSHARE<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SUPERSHARE2<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> VASICEKBONDOPTION<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">VasicekBondOption</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> TIMESWITCHOPTION<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">TimeSwitchOption</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>t<font color="#990000">,(</font><font color="#009900">int</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>t2<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> FOREQUOPTINDOMCUR<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">ForEquOptInDomCur</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> QUANTO<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">Quanto</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EQUITYLINKEDFXO<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">EquityLinkedFXO</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SPREADAPPROXIMATION<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">SpreadApproximation</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BINARYBARRIER<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> TAKEOVERFXOPTION<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERICANEXCHANGEOPTION<font color="#990000">:</font>

        putprice <font color="#990000">=</font> <b><font color="#000000">AmericanExchangeOption</font></b><font color="#990000">(</font>
                                           <font color="#993399">0</font><font color="#990000">,</font>
                                           price<font color="#990000">,</font>      <i><font color="#9A1900">// price</font></i>
                                           strike<font color="#990000">,</font>     <i><font color="#9A1900">// strike</font></i>
                                           dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>  <i><font color="#9A1900">// B</font></i>
                                           dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>  <i><font color="#9A1900">// J</font></i>
                                           t<font color="#990000">,</font>          <i><font color="#9A1900">// time</font></i>
                                           rate<font color="#990000">,</font>       <i><font color="#9A1900">// rate</font></i>
                                           dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>  <i><font color="#9A1900">// P</font></i>
                                           dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>  <i><font color="#9A1900">// Q</font></i>
                                           volatility<font color="#990000">,</font> <i><font color="#9A1900">// standard deviation</font></i>
                                           dat<font color="#990000">-&gt;</font>UseR<font color="#990000">,</font>  <i><font color="#9A1900">// R</font></i>
                                           dat<font color="#990000">-&gt;</font>UseS   <i><font color="#9A1900">// S</font></i>
                                           <font color="#990000">);</font>
    
      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> DISCRETEADJUSTEDBARRIER<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900">    case BARRIERBINOMINAL:</font></i>
<i><font color="#9A1900">      {</font></i>
<i><font color="#9A1900">        int state;</font></i>
<i><font color="#9A1900">        </font></i>
<i><font color="#9A1900">        if ( dat-&gt;UsePound == 1 )</font></i>
<i><font color="#9A1900">        {</font></i>
<i><font color="#9A1900">          state = SB_PUT_UP_OUT;</font></i>

<i><font color="#9A1900">        } else if( dat-&gt;UsePound == 2 )</font></i>
<i><font color="#9A1900">        {</font></i>
<i><font color="#9A1900">          state = SB_PUT_DOWN_OUT;</font></i>
<i><font color="#9A1900">        } else</font></i>
<i><font color="#9A1900">        {</font></i>
<i><font color="#9A1900">          printf("Error unknown state UsePound = %d\n", dat-&gt;UsePound);</font></i>
<i><font color="#9A1900">        }</font></i>

<i><font color="#9A1900">        int optionType = (int) dat-&gt;UseZ;</font></i>

<i><font color="#9A1900">        if( optionType != 0 &amp;&amp; optionType != 1 )</font></i>
<i><font color="#9A1900">        {</font></i>
<i><font color="#9A1900">          printf("Error optionType = %d\n", optionType);</font></i>
<i><font color="#9A1900">        }</font></i>

<i><font color="#9A1900">        putprice = BarrierBinomial(</font></i>
<i><font color="#9A1900">                                  optionType,         // Z     -&gt; EuropeanOption</font></i>
<i><font color="#9A1900">                                  state,              // #     -&gt; type</font></i>
<i><font color="#9A1900">                                  price,</font></i>
<i><font color="#9A1900">                                  strike,</font></i>
<i><font color="#9A1900">                                  dat-&gt;UseB,          // B     -&gt; H</font></i>
<i><font color="#9A1900">                                  t,</font></i>
<i><font color="#9A1900">                                  rate,</font></i>
<i><font color="#9A1900">                                  dividend,           //</font></i>
<i><font color="#9A1900">                                  volatility,</font></i>
<i><font color="#9A1900">                                  dat-&gt;steps);        // steps -&gt; n</font></i>
<i><font color="#9A1900">      }</font></i>

<i><font color="#9A1900">      break;</font></i>
<i><font color="#9A1900">*/</font></i>

    <b><font color="#0000FF">case</font></b> CONVERTIBLEBOND<font color="#990000">:</font>            <i><font color="#9A1900">// ConvertibleBond.c</font></i>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> CRRBINOMINAL<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">CRRBinomial</font></b><font color="#990000">(</font>
                              dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">,</font>
                              <font color="#993399">0</font><font color="#990000">,</font>
                              price<font color="#990000">,</font>
                              strike<font color="#990000">,</font>
                              t<font color="#990000">,</font>
                              rate<font color="#990000">,</font>
                              dividend<font color="#990000">,</font>
                              volatility<font color="#990000">,</font>
                              dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>
      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900">    case IMPLIEDTRINOMINALTREE:</font></i>

<i><font color="#9A1900">      putprice = 0;</font></i>

<i><font color="#9A1900">      break;</font></i>
<i><font color="#9A1900">*/</font></i>

    <b><font color="#0000FF">case</font></b> THREEDIMENSIONALBINOMINAL<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">ThreeDimensionalBinomial</font></b><font color="#990000">(</font>
                                          dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,</font>          <i><font color="#9A1900">// #             -&gt; type</font></i>
                                          dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>              <i><font color="#9A1900">// Z             -&gt; EuropeanOption</font></i>
                                          <font color="#993399">0</font><font color="#990000">,</font>                      <i><font color="#9A1900">// 0 for Put</font></i>
                                          price<font color="#990000">,</font>                  <i><font color="#9A1900">// P             -&gt; S1</font></i>
                                          dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>              <i><font color="#9A1900">// B             -&gt; S2</font></i>
                                          dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>              <i><font color="#9A1900">// Q             -&gt; X2</font></i>
                                          dat<font color="#990000">-&gt;</font>UseS<font color="#990000">,</font>              <i><font color="#9A1900">// S             -&gt; Q2</font></i>
                                          strike<font color="#990000">,</font>                 <i><font color="#9A1900">// strike</font></i>
                                          dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>              <i><font color="#9A1900">// R             -&gt; X2</font></i>
                                          t<font color="#990000">,</font>                      <i><font color="#9A1900">// t     </font></i>
                                          rate<font color="#990000">,</font>                   <i><font color="#9A1900">// rate </font></i>
                                          dividend<font color="#990000">,</font>               <i><font color="#9A1900">// dividend      -&gt; b1     </font></i>
                                          dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>              <i><font color="#9A1900">// P             -&gt; b2</font></i>
                                          volatility<font color="#990000">,</font>             <i><font color="#9A1900">// volatility</font></i>
                                          dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>              <i><font color="#9A1900">// J             -&gt; v2</font></i>
                                          dat<font color="#990000">-&gt;</font>UseT<font color="#990000">,</font>              <i><font color="#9A1900">// T             -&gt; rho</font></i>
                                          dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>            <i><font color="#9A1900">// steps</font></i>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> TRINOMINALTREE<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">TrinomialTree</font></b><font color="#990000">(</font>
                                dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">,</font>
                                <font color="#993399">0</font><font color="#990000">,</font>
                                price<font color="#990000">,</font>
                                strike<font color="#990000">,</font>
                                t<font color="#990000">,</font>
                                rate<font color="#990000">,</font>
                                dividend<font color="#990000">,</font>
                                volatility<font color="#990000">,</font>
                                dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>


      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EUROPEANEXCHANGEOPTION<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> MILTERSENSWARTZ<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">MiltersenSchwartz</font></b><font color="#990000">(</font>
                <font color="#993399">0</font><font color="#990000">,</font>
                dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>     <i><font color="#9A1900">// Z </font></i>
                price<font color="#990000">,</font>         <i><font color="#9A1900">// price</font></i>
                strike<font color="#990000">,</font>
                t<font color="#990000">,</font>
                t2<font color="#990000">,</font>
                volatility<font color="#990000">,</font>    <i><font color="#9A1900">// volatility</font></i>
                dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>     <i><font color="#9A1900">// B</font></i>
                dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>     <i><font color="#9A1900">// J</font></i>
                dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>     <i><font color="#9A1900">// P</font></i>
                dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>     <i><font color="#9A1900">// Q</font></i>
                dat<font color="#990000">-&gt;</font>UseR<font color="#990000">,</font>     <i><font color="#9A1900">// R</font></i>
                dat<font color="#990000">-&gt;</font>UseS<font color="#990000">,</font>     <i><font color="#9A1900">// S</font></i>
                dat<font color="#990000">-&gt;</font>UseT<font color="#990000">);</font>    <i><font color="#9A1900">// T </font></i>

        <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> PARTIALTIMETWOASSETBARRIER<font color="#990000">:</font>
      <font color="#FF0000">{</font>
       <b><font color="#0000FF">if</font></b><font color="#990000">(</font> t2 <font color="#990000">&lt;=</font> <font color="#993399">0.0</font> <font color="#990000">)</font>
       <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
       <font color="#FF0000">}</font>

      <font color="#009900">int</font> state<font color="#990000">;</font>
      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
        state <font color="#990000">=</font> SB_PUT_UP_IN<font color="#990000">;</font>

      <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b> <font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
        state <font color="#990000">=</font> SB_PUT_UP_OUT<font color="#990000">;</font>
      <font color="#FF0000">}</font>
      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">3</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
        state <font color="#990000">=</font> SB_PUT_DOWN_OUT<font color="#990000">;</font>

      <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b> <font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">4</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
        state <font color="#990000">=</font> SB_PUT_DOWN_IN<font color="#990000">;</font>
      <font color="#FF0000">}</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">PartialTimeTwoAssetBarrier</font></b><font color="#990000">(</font>
                state<font color="#990000">,</font>
                price<font color="#990000">,</font>      <i><font color="#9A1900">// price</font></i>
                dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>  <i><font color="#9A1900">// Z</font></i>
                strike<font color="#990000">,</font>     <i><font color="#9A1900">// strike</font></i>
                dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>  <i><font color="#9A1900">// B</font></i>
                t<font color="#990000">,</font>          <i><font color="#9A1900">// t</font></i>
                t2<font color="#990000">,</font>         <i><font color="#9A1900">// t2</font></i>
                rate<font color="#990000">,</font>       <i><font color="#9A1900">// rate</font></i>
                dividend<font color="#990000">,</font>   <i><font color="#9A1900">// J</font></i>
                dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>  <i><font color="#9A1900">// P</font></i>
                dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>  <i><font color="#9A1900">// Q</font></i>
                dat<font color="#990000">-&gt;</font>UseR<font color="#990000">,</font>  <i><font color="#9A1900">// R</font></i>
                dat<font color="#990000">-&gt;</font>UseS<font color="#990000">);</font> <i><font color="#9A1900">// S</font></i>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> TWOASSETBARRIER<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#009900">int</font> state<font color="#990000">;</font>
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          state <font color="#990000">=</font> SB_PUT_UP_IN<font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b> <font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          state <font color="#990000">=</font> SB_PUT_UP_OUT<font color="#990000">;</font>
        <font color="#FF0000">}</font>
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">3</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          state <font color="#990000">=</font> SB_PUT_DOWN_OUT<font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b> <font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">4</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          state <font color="#990000">=</font> SB_PUT_DOWN_IN<font color="#990000">;</font>
        <font color="#FF0000">}</font>

        putprice <font color="#990000">=</font> <b><font color="#000000">TwoAssetBarrier</font></b><font color="#990000">(</font>
                                    state<font color="#990000">,</font>
                                    price<font color="#990000">,</font>         <i><font color="#9A1900">// price</font></i>
                                    dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>     <i><font color="#9A1900">// S2                        1</font></i>
                                    strike<font color="#990000">,</font>        <i><font color="#9A1900">// strike</font></i>
                                    dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>     <i><font color="#9A1900">// H                         2</font></i>
                                    t<font color="#990000">,</font>             <i><font color="#9A1900">// t1</font></i>
                                    rate<font color="#990000">,</font>          <i><font color="#9A1900">// rate</font></i>
                                    dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>     <i><font color="#9A1900">// dividend</font></i>
                                    dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>     <i><font color="#9A1900">// b2                        3</font></i>
                                    volatility<font color="#990000">,</font>    <i><font color="#9A1900">// standard deviation</font></i>
                                    dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>     <i><font color="#9A1900">// v2                        4</font></i>
                                    dat<font color="#990000">-&gt;</font>UseR<font color="#990000">);</font>    <i><font color="#9A1900">// rho                       5</font></i>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> TWOASSETCASHORNOTHING<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> TWOASSETCORRELATION<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">TwoAssetCorrelation</font></b><font color="#990000">(</font>
                                    <font color="#993399">0</font><font color="#990000">,</font>
                                    price<font color="#990000">,</font>         <i><font color="#9A1900">// price</font></i>
                                    dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>     <i><font color="#9A1900">// S2                        1</font></i>
                                    strike<font color="#990000">,</font>        <i><font color="#9A1900">// X1 strike</font></i>
                                    dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>     <i><font color="#9A1900">// X2</font></i>
                                    t<font color="#990000">,</font>             <i><font color="#9A1900">// t1</font></i>
                                    rate<font color="#990000">,</font>          <i><font color="#9A1900">// rate</font></i>
                                    dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>     <i><font color="#9A1900">// dividend</font></i>
                                    dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>     <i><font color="#9A1900">// b2                        3</font></i>
                                    volatility<font color="#990000">,</font>    <i><font color="#9A1900">// standard deviation</font></i>
                                    dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>     <i><font color="#9A1900">// v2                        4</font></i>
                                    dat<font color="#990000">-&gt;</font>UseR<font color="#990000">);</font>    <i><font color="#9A1900">// rho                       5</font></i>
      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> VASICEKBONDPRICE<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EXCHANGEEXCHANGEOPTION<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> FLOATINGSTRIKELOOKBACK<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">FloatingStrikeLookback</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> FLOATINGSTRIKELOOKBACK2<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">FloatingStrikeLookback</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> OPTIONSONTHEMAXMIN<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">OptionsOnTheMaxMin</font></b><font color="#990000">((</font><font color="#009900">char</font> <font color="#990000">*)&amp;</font>namelistoptionsontheminmax2<font color="#990000">[</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">+</font><font color="#993399">1</font><font color="#990000">],</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">);</font>

     <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> PARTIALFLOATLB<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> t2 <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
      <font color="#FF0000">}</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">PartialFloatLB</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>strike<font color="#990000">,</font>t2<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">);</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> PARTIALFLOATLB2<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> t2 <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
      <font color="#FF0000">}</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">PartialFloatLB</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>t2<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">);</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> FIXEDSTRIKELOOKBACK<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">FixedStrikeLookback</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> DOUBLEBARRIER<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">DoubleBarrier</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> STANDARDBARRIER<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">StandardBarrier</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">+</font><font color="#993399">4</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SOFTBARRIER<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">SoftBarrier</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">+</font><font color="#993399">6</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> LEVYASIAN<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">LevyAsian</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>strike<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> t2<font color="#990000">),</font>t<font color="#990000">,</font>rate<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> dividend<font color="#990000">),</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> GEOMETRICAVERAGERATEOPTION<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">GeometricAverageRateOption</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> t2<font color="#990000">),</font>rate<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> dividend<font color="#990000">),</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> FORWARDSTARTOPTION<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">ForwardStartOption</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> t2<font color="#990000">),</font>t<font color="#990000">,</font>rate<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> dividend<font color="#990000">),</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> FINRECIPES

    <b><font color="#0000FF">case</font></b> PERPETUAL<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">option_price_american_perpetual_put</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERICANTRINOMIAL<font color="#990000">:</font>

       putprice <font color="#990000">=</font> <b><font color="#000000">option_price_put_american_trinomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> FUTOPTEURBLACK<font color="#990000">:</font>

      putprice  <font color="#990000">=</font> <b><font color="#000000">futures_option_price_put_european_black</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> FUTOPTAMBINOMIAL<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">futures_option_price_put_american_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EUROSIM<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">option_price_put_european_simulated</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

      <i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900">    case AMERBJERKSUNDSTENSLAND:</font></i>

<i><font color="#9A1900">      putprice = 0;</font></i>

<i><font color="#9A1900">      break;</font></i>
<i><font color="#9A1900">      */</font></i>

    <b><font color="#0000FF">case</font></b> AMERBINOMIAL<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">option_price_put_american_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERBAW<font color="#990000">:</font>

      putprice <font color="#990000">=</font>  <b><font color="#000000">option_price_american_put_approximated_baw</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BONDZEROBLACK<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">bond_option_price_put_zero_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERPUTAPPROXJOHNSON<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_american_put_approximated_johnson"</font><font color="#990000">,</font> <font color="#993399">5</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">);</font> 

      putprice <font color="#990000">=</font> <b><font color="#000000">option_price_american_put_approximated_johnson</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#ifdef</font></b> HAVE_LIBGSL

    <b><font color="#0000FF">case</font></b> AMERPUTAPPROXGESKEJOHNSON<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_american_put_approximated_geske_johnson"</font><font color="#990000">,</font> <font color="#993399">5</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)(</font>rate <font color="#990000">&gt;</font> <font color="#993399">0</font> <font color="#990000">?</font> rate <font color="#990000">:</font> <font color="#993399">0</font> <font color="#990000">)</font> <font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">);</font> 

      <i><font color="#9A1900">// freezes on rate &lt; 0...</font></i>
      putprice <font color="#990000">=</font> <b><font color="#000000">option_price_american_put_approximated_geske_johnson</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,(</font>rate <font color="#990000">&gt;</font> <font color="#993399">0</font> <font color="#990000">?</font> rate <font color="#990000">:</font> <font color="#993399">0</font> <font color="#990000">),</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> HESTON<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

    <b><font color="#0000FF">case</font></b> BONDAMERBINOMIAL<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">bond_option_price_put_american_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES3<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">option_price_put_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BSPAYOUT<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">option_price_european_put_payout</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERBINOMIALDIV<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">option_price_put_american_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EUROBIONMIAL<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">option_price_put_european_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> ASIANGEOMETRICAVG<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EUROLOOKBACK<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">option_price_european_lookback_put</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EUROLOOKBACK2<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">option_price_european_lookback_put</font></b><font color="#990000">(</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> MERTONJUMPDIFF<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> CURRAMBINOMIAL<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">currency_option_price_put_american_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> CURREURO<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">currency_option_price_put_european</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> ROLLGESKEWHALEY2<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EUROBINOMIAL1P<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EUROBINOMIALMP<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SIMEUROGENERIC<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#009900">double</font> <font color="#990000">(*</font>fun<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;,</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;);</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">1</font><font color="#990000">)</font>
        <font color="#FF0000">{</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_put<font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">3</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">4</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_binary_put<font color="#990000">;</font>
        <font color="#FF0000">}</font>

        putprice <font color="#990000">=</font> <b><font color="#000000">derivative_price_simulate_european_option_generic</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>fun<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SIMEUROGENERICCV<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#009900">double</font> <font color="#990000">(*</font>fun<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;,</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;);</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_put<font color="#990000">;</font>
          
        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">3</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">4</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_binary_put<font color="#990000">;</font>
        <font color="#FF0000">}</font>

        putprice <font color="#990000">=</font> <b><font color="#000000">derivative_price_simulate_european_option_generic_with_control_variate</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>fun<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SIMEUROGENERICAV<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#009900">double</font> <font color="#990000">(*</font>fun<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;,</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;);</font>
      
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_put<font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">3</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">4</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_binary_put<font color="#990000">;</font>
        <font color="#FF0000">}</font>

        putprice <font color="#990000">=</font> <b><font color="#000000">derivative_price_simulate_european_option_generic_with_antithetic_variate</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>fun<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SIMPRICEPATH<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#009900">double</font> <font color="#990000">(*</font>fun2<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> vector<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">&gt;&amp;,</font> <b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;);</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">3</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          fun2 <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_lookback_put<font color="#990000">;</font>
        <font color="#FF0000">}</font>

        putprice <font color="#990000">=</font> <b><font color="#000000">derivative_price_simulate_european_option_generic</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>fun2<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,(</font><font color="#009900">int</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SIMPRICEPATHCONTROLVARIATE<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#009900">double</font> <font color="#990000">(*</font>fun2<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> vector<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">&gt;&amp;,</font> <b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;);</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">3</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          fun2 <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_lookback_put<font color="#990000">;</font>
        <font color="#FF0000">}</font>

        putprice <font color="#990000">=</font> <b><font color="#000000">derivative_price_simulate_european_option_generic_with_control_variate</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>fun2<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,(</font><font color="#009900">int</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> DISTLOGRAND<font color="#990000">:</font>
      
      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> IMPLIEDNEWTON<font color="#990000">:</font>

      <i><font color="#9A1900">// option_price_implied_volatility_put_black_scholes_newton() doesn't seem to</font></i>
      <i><font color="#9A1900">// resolve in the library? but its prototyped in fin_recipes.h????</font></i>
      <i><font color="#9A1900">// nm librecipes.a | fgrep newton </font></i>
      <i><font color="#9A1900">// yields no reference to puts</font></i>

      <i><font color="#9A1900">//putprice = option_price_implied_volatility_put_black_scholes_newton(price,strike,rate,t,volatility);</font></i>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> IMPLIEDBISECTIONS<font color="#990000">:</font>

      <i><font color="#9A1900">// option_price_implied_volatility_put_black_scholes_bisections() doesn't seem to</font></i>
      <i><font color="#9A1900">// resolve in the library? but its prototyped in fin_recipes.h????</font></i>
      <i><font color="#9A1900">// nm librecipes.a | fgrep bisections</font></i>
      <i><font color="#9A1900">// yields no reference to puts</font></i>

      <i><font color="#9A1900">//putprice  = option_price_implied_volatility_put_black_scholes_bisections(price,strike,rate,t,volatility);</font></i>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BONDZEROVASICEK<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">bond_option_price_put_zero_vasicek</font></b><font color="#990000">(</font>strike<font color="#990000">,</font>  <i><font color="#9A1900">// exercise price</font></i>
                                           rate<font color="#990000">,</font> <i><font color="#9A1900">// current interest rate</font></i>
                                           t2<font color="#990000">,</font>
                                           t<font color="#990000">,</font>
                                           dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>  <i><font color="#9A1900">// a</font></i>
                                           dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>  <i><font color="#9A1900">// b, </font></i>
                                           dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">);</font> <i><font color="#9A1900">// sigma</font></i>
 
      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EURODIVIDENDS<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <b><font color="#000000">pthread_mutex_lock</font></b><font color="#990000">(&amp;</font>dat<font color="#990000">-&gt;</font>mutexCashflow<font color="#990000">);</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">option_price_european_put_dividends</font></b><font color="#990000">(</font> price<font color="#990000">,</font>               
                                            strike<font color="#990000">,</font>
                                            rate<font color="#990000">,</font>
                                            volatility<font color="#990000">,</font>           
                                            t<font color="#990000">,</font>
                                            dat<font color="#990000">-&gt;</font>times<font color="#990000">,</font>
                                            dat<font color="#990000">-&gt;</font>amounts<font color="#990000">);</font>

      <b><font color="#000000">pthread_mutex_unlock</font></b><font color="#990000">(&amp;</font>dat<font color="#990000">-&gt;</font>mutexCashflow<font color="#990000">);</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900">    case AMDISDIVSBINOMIAL:</font></i>
<i><font color="#9A1900">      {</font></i>

<i><font color="#9A1900">      pthread_mutex_lock(&amp;dat-&gt;mutexCashflow);</font></i>

<i><font color="#9A1900">      putprice = option_price_put_american_discrete_dividends_binomial( price,</font></i>
<i><font color="#9A1900">                                                                        strike,</font></i>
<i><font color="#9A1900">                                                                        rate,</font></i>
<i><font color="#9A1900">                                                                        volatility,</font></i>
<i><font color="#9A1900">                                                                        t,</font></i>
<i><font color="#9A1900">                                                                        dat-&gt;steps,</font></i>
<i><font color="#9A1900">                                                                        dat-&gt;times, </font></i>
<i><font color="#9A1900">                                                                        dat-&gt;amounts);</font></i>

<i><font color="#9A1900">      pthread_mutex_unlock(&amp;dat-&gt;mutexCashflow);</font></i>

<i><font color="#9A1900">      }</font></i>

<i><font color="#9A1900">      break;</font></i>
<i><font color="#9A1900">*/</font></i>

    <b><font color="#0000FF">case</font></b> AMPROPORTDIVSBINOMIAL<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <b><font color="#000000">pthread_mutex_lock</font></b><font color="#990000">(&amp;</font>dat<font color="#990000">-&gt;</font>mutexCashflow<font color="#990000">);</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">option_price_put_american_proportional_dividends_binomial</font></b><font color="#990000">(</font> price<font color="#990000">,</font>
                                                                              strike<font color="#990000">,</font>
                                                                              rate<font color="#990000">,</font>
                                                                              volatility<font color="#990000">,</font>
                                                                              t<font color="#990000">,</font>
                                                                              dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font> 
                                                                              dat<font color="#990000">-&gt;</font>times<font color="#990000">,</font> 
                                                                              <i><font color="#9A1900">//dividend_yields);</font></i>
                                                                              dat<font color="#990000">-&gt;</font>amounts<font color="#990000">);</font>

      <b><font color="#000000">pthread_mutex_unlock</font></b><font color="#990000">(&amp;</font>dat<font color="#990000">-&gt;</font>mutexCashflow<font color="#990000">);</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BERMUDIANBINOMIAL<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <b><font color="#000000">pthread_mutex_lock</font></b><font color="#990000">(&amp;</font>dat<font color="#990000">-&gt;</font>mutexCashflow<font color="#990000">);</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">option_price_put_bermudan_binomial</font></b><font color="#990000">(</font> price<font color="#990000">,</font>
                                                     strike<font color="#990000">,</font>
                                                     rate<font color="#990000">,</font>
                                                     <i><font color="#9A1900">//dividend,</font></i>
                                                     dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>
                                                     volatility<font color="#990000">,</font>
                                                     t<font color="#990000">,</font>
                                                     <i><font color="#9A1900">//potential_exercise_times,</font></i>
                                                     dat<font color="#990000">-&gt;</font>times<font color="#990000">,</font>
                                                     dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

      <b><font color="#000000">pthread_mutex_unlock</font></b><font color="#990000">(&amp;</font>dat<font color="#990000">-&gt;</font>mutexCashflow<font color="#990000">);</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BSCOUPONBOND<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <b><font color="#000000">pthread_mutex_lock</font></b><font color="#990000">(&amp;</font>dat<font color="#990000">-&gt;</font>mutexCashflow<font color="#990000">);</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">bond_option_price_put_coupon_bond_black_scholes</font></b><font color="#990000">(</font> price<font color="#990000">,</font>
                                                                 strike<font color="#990000">,</font>
                                                                   rate<font color="#990000">,</font>
                                                             volatility<font color="#990000">,</font>
                                                                      t<font color="#990000">,</font>
                                                         <i><font color="#9A1900">//coupon_times,</font></i>
                                                             <i><font color="#9A1900">//coupons);</font></i>
                                                             dat<font color="#990000">-&gt;</font>times<font color="#990000">,</font> 
                                                            dat<font color="#990000">-&gt;</font>amounts<font color="#990000">);</font>

      <b><font color="#000000">pthread_mutex_unlock</font></b><font color="#990000">(&amp;</font>dat<font color="#990000">-&gt;</font>mutexCashflow<font color="#990000">);</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMFINITEDIFFEXP<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">option_price_put_american_finite_diff_explicit</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EUROFINITEDIFFEXP<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">option_price_put_european_finite_diff_explicit</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#ifdef</font></b> HAVE_NEWMAT_NEWMAT_H

    <b><font color="#0000FF">case</font></b> AMFINDIFFIMP<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">option_price_put_american_finite_diff_implicit</font></b><font color="#990000">(</font>price<font color="#990000">,</font>
                                                               strike<font color="#990000">,</font>
                                                                 rate<font color="#990000">,</font> 
                                                           volatility<font color="#990000">,</font>
                                                                    t<font color="#990000">,</font> 
                                                           dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>
                                                            dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EURFINDDIFFIMP<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">option_price_put_european_finite_diff_implicit</font></b><font color="#990000">(</font>price<font color="#990000">,</font>
                                                               strike<font color="#990000">,</font>
                                                                 rate<font color="#990000">,</font> 
                                                           volatility<font color="#990000">,</font>
                                                                    t<font color="#990000">,</font> 
                                                           dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>
                                                            dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> HAVE_ITPP_ITBASE_H

    <b><font color="#0000FF">case</font></b> AMFINDIFFIMPPUT<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_put_american_finite_diff_implicit_itpp"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

      putprice <font color="#990000">=</font> <b><font color="#000000">option_price_put_american_finite_diff_implicit_itpp</font></b><font color="#990000">(</font>price<font color="#990000">,</font>
                                                                    strike<font color="#990000">,</font>
                                                                      rate<font color="#990000">,</font> 
                                                                volatility<font color="#990000">,</font>
                                                                         t<font color="#990000">,</font> 
                                                                dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>
                                                                 dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

    <b><font color="#0000FF">case</font></b> WARRANT_NO_DIV<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> WARRANT_DIV<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMBINOMIAL<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#009900">double</font> <font color="#990000">(*</font>fun<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;,</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;);</font>
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_put<font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">3</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">4</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_binary_put<font color="#990000">;</font>
        <font color="#FF0000">}</font>
      
        putprice <font color="#990000">=</font> <b><font color="#000000">option_price_generic_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>fun<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BOND_ZERO_AM_RENDLEMAN_BARTTER<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> DUMMYTESTMODELS

    <b><font color="#0000FF">case</font></b> TESTOPTION1<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> TESTOPTION2<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> TESTOPTION3<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> TESTOPTIONONEDIVIDEND1<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> TESTOPTIONONEDIVIDEND2<font color="#990000">:</font>

      putprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#008080">    default:</font></b>

      <b><font color="#000000">fprintf</font></b><font color="#990000">(</font>stderr<font color="#990000">,</font><font color="#FF0000">"option_put(): No implementation for case %d</font><font color="#CC33CC">\n</font><font color="#FF0000">"</font><font color="#990000">,</font>dat<font color="#990000">-&gt;</font>modeltype<font color="#990000">);</font>

     <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

  <font color="#FF0000">}</font>

  dat<font color="#990000">-&gt;</font>put <font color="#990000">=</font> putprice<font color="#990000">;</font>

  <b><font color="#0000FF">if</font></b><font color="#990000">(</font><b><font color="#000000">isnan</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>put<font color="#990000">))</font>
  <font color="#FF0000">{</font>
    dat<font color="#990000">-&gt;</font>isnan <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">;</font>
  <font color="#FF0000">}</font>

  <b><font color="#0000FF">if</font></b><font color="#990000">(</font>properties<font color="#990000">.</font>filterNegativePrices <font color="#990000">==</font> <b><font color="#0000FF">true</font></b> <font color="#990000">&amp;&amp;</font> dat<font color="#990000">-&gt;</font>put <font color="#990000">&lt;</font> <font color="#993399">0.0</font> <font color="#990000">&amp;&amp;</font>
     properties<font color="#990000">.</font>distribution_type<font color="#990000">==</font>NORMAL_DISTRIBUTION<font color="#990000">)</font>
  <font color="#FF0000">{</font>
    dat<font color="#990000">-&gt;</font>put <font color="#990000">=</font> <font color="#993399">0.0</font><font color="#990000">;</font>
  <font color="#FF0000">}</font>

  <font color="#FF0000">}</font>

  <b><font color="#0000FF">catch</font></b> <font color="#990000">(</font>exception<font color="#990000">&amp;</font> e<font color="#990000">)</font>
  <font color="#FF0000">{</font>
    <i><font color="#9A1900">//g_print("option_put(): Exception caught: %s\n", e.what() );</font></i>
    <i><font color="#9A1900">//g_print("P = %f, X = %f, R = %f, V = %f, t = %f, Div = %f\n", price,strike,rate,volatility,t,dividend);</font></i>

    <i><font color="#9A1900">// program might not be recoverable...</font></i>
    <b><font color="#000000">fflush</font></b><font color="#990000">(</font>NULL<font color="#990000">);</font>
    
    <i><font color="#9A1900">// a number implies probability...force NaN price since exception</font></i>
    dat<font color="#990000">-&gt;</font>put <font color="#990000">=</font> <b><font color="#000000">sqrt</font></b><font color="#990000">(-</font><font color="#993399">1</font><font color="#990000">);</font>
  <font color="#FF0000">}</font>

  <b><font color="#0000FF">return</font></b> <font color="#990000">*</font>dat<font color="#990000">;</font>
<font color="#FF0000">}</font>
</tt></pre>
