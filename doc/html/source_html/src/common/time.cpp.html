<!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><i><font color="#9A1900">/* optionmatrix:                                                            */</font></i>
<i><font color="#9A1900">/*                                                                          */</font></i>
<i><font color="#9A1900">/* Options &amp; Futures Matrix Modeler                                         */</font></i>
<i><font color="#9A1900">/* View and Control Theoretical Option Chains                               */</font></i>
<i><font color="#9A1900">/*                                                                          */</font></i>
<i><font color="#9A1900">/* File: time.cpp of optionmatrix                                           */</font></i>
<i><font color="#9A1900">/*                                                                          */</font></i>
<i><font color="#9A1900">/* Copyright (c) Anthony Bradford. 2012.                                    */</font></i>
<i><font color="#9A1900">/* </font></i><u><font color="#0000FF">http://anthonybradford.com</font></u><i><font color="#9A1900">                                               */</font></i>
<i><font color="#9A1900">/* </font></i><u><font color="#0000FF">info@anthonybradford.com</font></u><i><font color="#9A1900">                                                 */</font></i>
<i><font color="#9A1900">/*                                                                          */</font></i>
<i><font color="#9A1900">/* optionmatrix may be freely redistributed.                                */</font></i>
<i><font color="#9A1900">/* See file COPYING included with this distribution for license information */</font></i>

<i><font color="#9A1900">/* </font></i>
<i><font color="#9A1900">   optionmatrix is free software; you can redistribute it and/or modify</font></i>
<i><font color="#9A1900">   it under the terms of the GNU General Public License as published by</font></i>
<i><font color="#9A1900">   the Free Software Foundation; either version 3 of the License, or</font></i>
<i><font color="#9A1900">   (at your option) any later version.</font></i>

<i><font color="#9A1900">   optionmatrix program is distributed in the hope that it will be useful,</font></i>
<i><font color="#9A1900">   but WITHOUT ANY WARRANTY; without even the implied warranty of</font></i>
<i><font color="#9A1900">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</font></i>
<i><font color="#9A1900">   GNU General Public License for more details.</font></i>

<i><font color="#9A1900">   You should have received a copy of the GNU General Public License</font></i>
<i><font color="#9A1900">   along with this program.  If not, see </font></i><u><font color="#0000FF">&lt;http://www.gnu.org/licenses/&gt;</font></u><i><font color="#9A1900">.</font></i>
<i><font color="#9A1900">*/</font></i>

<b><font color="#000080">#include</font></b> <font color="#FF0000">"defs.h"</font>
<b><font color="#000080">#include</font></b> <font color="#FF0000">"extern.h"</font>

<font color="#009900">int</font> <b><font color="#000000">day_changed</font></b><font color="#990000">()</font>
<font color="#FF0000">{</font>
  <font color="#008080">time_t</font> mytime<font color="#990000">;</font>
  <b><font color="#0000FF">struct</font></b> <font color="#008080">tm</font> <font color="#990000">*</font>my_tm<font color="#990000">;</font>

  <b><font color="#000000">time</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>
  my_tm <font color="#990000">=</font> <b><font color="#000000">localtime</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>

  <b><font color="#0000FF">static</font></b> <font color="#009900">int</font> tm_mday <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

  <b><font color="#0000FF">if</font></b><font color="#990000">(</font> tm_mday <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">)</font>
  <font color="#FF0000">{</font>
    tm_mday <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_mday<font color="#990000">;</font>

  <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
  <font color="#FF0000">{</font>
    <b><font color="#0000FF">if</font></b><font color="#990000">(</font> tm_mday <font color="#990000">!=</font> my_tm<font color="#990000">-&gt;</font>tm_mday <font color="#990000">)</font>
    <font color="#FF0000">{</font>
      <b><font color="#0000FF">return</font></b> <font color="#993399">1</font><font color="#990000">;</font>
    <font color="#FF0000">}</font>
  <font color="#FF0000">}</font>

  <b><font color="#0000FF">return</font></b> <font color="#993399">0</font><font color="#990000">;</font>
<font color="#FF0000">}</font>

<font color="#009900">int</font> <b><font color="#000000">date_to_days_away</font></b><font color="#990000">(</font><b><font color="#0000FF">const</font></b> <font color="#009900">int</font> day<font color="#990000">,</font> <font color="#009900">int</font> month<font color="#990000">,</font> <font color="#009900">int</font> year<font color="#990000">)</font>
<font color="#FF0000">{</font>
    <font color="#008080">time_t</font> mytime<font color="#990000">;</font>
    <b><font color="#0000FF">struct</font></b> <font color="#008080">tm</font> <font color="#990000">*</font>my_tm<font color="#990000">;</font>

    <b><font color="#000000">time</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>
    my_tm <font color="#990000">=</font> <b><font color="#000000">localtime</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>

    <font color="#009900">int</font> curr_year  <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">;</font>
    <font color="#009900">int</font> curr_month <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_mon<font color="#990000">;</font>
    <font color="#009900">int</font> curr_day   <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_mday<font color="#990000">;</font>

    <font color="#009900">int</font> year_counter  <font color="#990000">=</font> curr_year<font color="#990000">;</font>
    <font color="#009900">int</font> month_counter <font color="#990000">=</font> curr_month<font color="#990000">;</font>
    <font color="#009900">int</font> day_counter   <font color="#990000">=</font> curr_day<font color="#990000">;</font>

    year <font color="#990000">+=</font> <font color="#993399">2000</font><font color="#990000">;</font>

    <font color="#009900">int</font> x<font color="#990000">;</font>
    <font color="#009900">int</font> timeindays <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

    <i><font color="#9A1900">/* make from 0-11 */</font></i>
    month <font color="#990000">-=</font> <font color="#993399">1</font><font color="#990000">;</font>

    <i><font color="#9A1900">/*printw("day %d %d\tmonth %d %d\tyear %d %d\n",day,day_counter,month,month_counter,year,year_counter);*/</font></i>

    <b><font color="#0000FF">if</font></b><font color="#990000">(</font> year <font color="#990000">&lt;</font> curr_year <font color="#990000">)</font>
    <font color="#FF0000">{</font>
      <b><font color="#0000FF">return</font></b> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
    <font color="#FF0000">}</font>

    <b><font color="#0000FF">if</font></b><font color="#990000">(</font> year <font color="#990000">==</font> curr_year <font color="#990000">&amp;&amp;</font> month <font color="#990000">&lt;</font> curr_month <font color="#990000">)</font>
    <font color="#FF0000">{</font>
      <b><font color="#0000FF">return</font></b> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
    <font color="#FF0000">}</font>

    <b><font color="#0000FF">if</font></b><font color="#990000">(</font> year <font color="#990000">==</font> curr_year <font color="#990000">&amp;&amp;</font> month <font color="#990000">==</font> curr_month <font color="#990000">&amp;&amp;</font> day <font color="#990000">&lt;</font> curr_day <font color="#990000">)</font>
    <font color="#FF0000">{</font>
      <b><font color="#0000FF">return</font></b> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
    <font color="#FF0000">}</font>

    <b><font color="#0000FF">if</font></b><font color="#990000">(</font> curr_year <font color="#990000">==</font> year <font color="#990000">&amp;&amp;</font> curr_month <font color="#990000">==</font> month <font color="#990000">&amp;&amp;</font> curr_day <font color="#990000">==</font> day <font color="#990000">)</font>
    <font color="#FF0000">{</font>
      <b><font color="#0000FF">return</font></b> <font color="#993399">0</font><font color="#990000">;</font>
    <font color="#FF0000">}</font>

    <b><font color="#0000FF">for</font></b><font color="#990000">(;;)</font>
    <font color="#FF0000">{</font>
        <b><font color="#0000FF">for</font></b><font color="#990000">(</font>x <font color="#990000">=</font> curr_month<font color="#990000">;</font> x <font color="#990000">&lt;</font> <font color="#993399">12</font><font color="#990000">;</font> x<font color="#990000">++)</font>
        <font color="#FF0000">{</font>
          <i><font color="#9A1900">/* figure out if it is a leap year and adjust the month feb */</font></i>
          <b><font color="#0000FF">if</font></b><font color="#990000">(</font> <font color="#990000">(</font> <font color="#990000">(</font>year_counter<font color="#990000">)%</font><font color="#993399">4</font> <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>year_counter<font color="#990000">)%</font><font color="#993399">100</font> <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">)</font> <font color="#990000">||</font> <font color="#990000">(</font>year_counter<font color="#990000">)%</font><font color="#993399">400</font> <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">)</font>
            <font color="#FF0000">{</font>
              months<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">29</font><font color="#990000">;</font>
            
            <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
            <font color="#FF0000">{</font>
              months<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">28</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
        
          <i><font color="#9A1900">/* increment through the month */</font></i>
          <b><font color="#0000FF">while</font></b><font color="#990000">(</font> day_counter <font color="#990000">&lt;=</font> months<font color="#990000">[</font>x<font color="#990000">]</font> <font color="#990000">)</font>
          <font color="#FF0000">{</font>
            <b><font color="#0000FF">if</font></b><font color="#990000">(</font>day <font color="#990000">==</font> day_counter <font color="#990000">&amp;&amp;</font> month <font color="#990000">==</font> month_counter <font color="#990000">&amp;&amp;</font> 
               year <font color="#990000">==</font> year_counter<font color="#990000">)</font>
            <font color="#FF0000">{</font>
              <i><font color="#9A1900">/*printw("%s month = %d timeindays = %d\n",mon[month_counter],day_counter,timeindays);*/</font></i>

              <b><font color="#0000FF">return</font></b> timeindays<font color="#990000">;</font>
            <font color="#FF0000">}</font>

            day_counter<font color="#990000">++;</font>
            timeindays<font color="#990000">++;</font>
            <i><font color="#9A1900">/*printw("day = %d\tday_counter = %d\n",day,day_counter);*/</font></i>
          <font color="#FF0000">}</font>

          <i><font color="#9A1900">/*printw("%s month = %d timeindays = %d\n",mon[month_counter],day_counter,timeindays);*/</font></i>
          <i><font color="#9A1900">/*printw("day %d %d\tmonth %d %d\tyear %d %d\n",day,day_counter,month,month_counter,year,year_counter);*/</font></i>

          day_counter <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">;</font>

          <b><font color="#0000FF">if</font></b><font color="#990000">(</font> month_counter<font color="#990000">++</font> <font color="#990000">==</font> <font color="#993399">11</font> <font color="#990000">)</font> <i><font color="#9A1900">/* months 0-11 */</font></i>
          <font color="#FF0000">{</font>
            month_counter <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>        <i><font color="#9A1900">/* set to Jan */</font></i>
            year_counter<font color="#990000">++;</font>
          <font color="#FF0000">}</font>
        <font color="#FF0000">}</font>
        curr_month <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
    <font color="#FF0000">}</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900"> * the greatest date this allow to be entered is 99 which is</font></i>
<i><font color="#9A1900"> * the year 2099</font></i>
<i><font color="#9A1900"> */</font></i>
<font color="#009900">int</font> <b><font color="#000000">validate_date</font></b><font color="#990000">(</font><b><font color="#0000FF">const</font></b> <font color="#009900">int</font> day<font color="#990000">,</font> <b><font color="#0000FF">const</font></b> <font color="#009900">int</font> month<font color="#990000">,</font> <font color="#009900">int</font> year<font color="#990000">)</font>
<font color="#FF0000">{</font>
  <i><font color="#9A1900">/* extend feb 1 day during leap year */</font></i>
  <font color="#009900">int</font> validate_months<font color="#990000">[]</font> <font color="#990000">=</font> <font color="#FF0000">{</font> <font color="#993399">31</font><font color="#990000">,</font> <font color="#993399">28</font><font color="#990000">,</font> <font color="#993399">31</font><font color="#990000">,</font> <font color="#993399">30</font><font color="#990000">,</font> <font color="#993399">31</font><font color="#990000">,</font> <font color="#993399">30</font><font color="#990000">,</font> <font color="#993399">31</font><font color="#990000">,</font> <font color="#993399">31</font><font color="#990000">,</font> <font color="#993399">30</font><font color="#990000">,</font> <font color="#993399">31</font><font color="#990000">,</font> <font color="#993399">30</font><font color="#990000">,</font> <font color="#993399">31</font> <font color="#FF0000">}</font><font color="#990000">;</font>

  <font color="#008080">time_t</font> mytime<font color="#990000">;</font>
  <b><font color="#0000FF">struct</font></b> <font color="#008080">tm</font> <font color="#990000">*</font>my_tm<font color="#990000">;</font>

  <b><font color="#000000">time</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>
  my_tm <font color="#990000">=</font> <b><font color="#000000">localtime</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>

  <b><font color="#0000FF">if</font></b><font color="#990000">(</font> day <font color="#990000">&lt;</font> <font color="#993399">1</font> <font color="#990000">)</font>
  <font color="#FF0000">{</font>
    <b><font color="#0000FF">return</font></b> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
  <font color="#FF0000">}</font>

  <b><font color="#0000FF">if</font></b><font color="#990000">(</font> month <font color="#990000">&gt;</font> <font color="#993399">12</font> <font color="#990000">||</font> month <font color="#990000">&lt;</font> <font color="#993399">1</font> <font color="#990000">)</font>
  <font color="#FF0000">{</font>
      <b><font color="#0000FF">return</font></b> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
  <font color="#FF0000">}</font>

  <b><font color="#0000FF">if</font></b><font color="#990000">(</font> year <font color="#990000">&lt;</font> <font color="#993399">0</font> <font color="#990000">)</font>
  <font color="#FF0000">{</font>
      <b><font color="#0000FF">return</font></b> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
  <font color="#FF0000">}</font> 

  <b><font color="#0000FF">if</font></b><font color="#990000">(</font> year <font color="#990000">&gt;</font> <font color="#993399">99</font> <font color="#990000">||</font> year <font color="#990000">&lt;</font> <font color="#993399">7</font> <font color="#990000">)</font>
  <font color="#FF0000">{</font>
      <b><font color="#0000FF">return</font></b> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
  <font color="#FF0000">}</font> 

  year <font color="#990000">+=</font> <font color="#993399">2000</font><font color="#990000">;</font>

  <b><font color="#0000FF">if</font></b><font color="#990000">(</font> <font color="#990000">(</font>my_tm<font color="#990000">-&gt;</font>tm_year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)</font> <font color="#990000">&gt;</font> year <font color="#990000">)</font>
  <font color="#FF0000">{</font>
    <b><font color="#0000FF">return</font></b> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
  <font color="#FF0000">}</font>

  <b><font color="#0000FF">if</font></b><font color="#990000">(</font> year <font color="#990000">==</font> <font color="#990000">(</font>my_tm<font color="#990000">-&gt;</font>tm_year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)</font> <font color="#990000">)</font>
  <font color="#FF0000">{</font>
    <b><font color="#0000FF">if</font></b><font color="#990000">(</font>month <font color="#990000">&lt;</font> <font color="#990000">(</font>my_tm<font color="#990000">-&gt;</font>tm_mon<font color="#990000">+</font><font color="#993399">1</font><font color="#990000">))</font>
    <font color="#FF0000">{</font>
      <b><font color="#0000FF">return</font></b> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
    <font color="#FF0000">}</font>

    <b><font color="#0000FF">if</font></b><font color="#990000">(</font> month <font color="#990000">==</font> <font color="#990000">(</font>my_tm<font color="#990000">-&gt;</font>tm_mon<font color="#990000">+</font><font color="#993399">1</font><font color="#990000">)</font> <font color="#990000">)</font>
    <font color="#FF0000">{</font>
      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> day <font color="#990000">&lt;</font> my_tm<font color="#990000">-&gt;</font>tm_mday <font color="#990000">)</font>
      <font color="#FF0000">{</font>
        <b><font color="#0000FF">return</font></b> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
      <font color="#FF0000">}</font>
    <font color="#FF0000">}</font>
  <font color="#FF0000">}</font>

  <i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900">   * figure out if it is a leap year and adjust the month feb</font></i>
<i><font color="#9A1900">   */</font></i>
  <b><font color="#0000FF">if</font></b><font color="#990000">(</font> <font color="#990000">(</font> <font color="#990000">(</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">4</font> <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">100</font> <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">)</font> <font color="#990000">||</font> <font color="#990000">(</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">400</font> <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">)</font>
  <font color="#FF0000">{</font>
    validate_months<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">29</font><font color="#990000">;</font>

  <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
  <font color="#FF0000">{</font>
    validate_months<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">28</font><font color="#990000">;</font>
  <font color="#FF0000">}</font>
  
  <b><font color="#0000FF">if</font></b><font color="#990000">(</font> day <font color="#990000">&gt;</font> validate_months<font color="#990000">[</font>month<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">)</font>
  <font color="#FF0000">{</font>
    <b><font color="#0000FF">return</font></b> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
  <font color="#FF0000">}</font>

  <b><font color="#0000FF">return</font></b> <font color="#993399">0</font><font color="#990000">;</font>
<font color="#FF0000">}</font>

<font color="#009900">int</font> <b><font color="#000000">validate_time</font></b><font color="#990000">(</font><b><font color="#0000FF">const</font></b> <font color="#009900">int</font> hours<font color="#990000">,</font> <b><font color="#0000FF">const</font></b> <font color="#009900">int</font> minutes<font color="#990000">,</font> <b><font color="#0000FF">const</font></b> <font color="#009900">int</font> seconds<font color="#990000">)</font>
<font color="#FF0000">{</font>
  <b><font color="#0000FF">if</font></b><font color="#990000">(</font> hours <font color="#990000">&lt;</font> <font color="#993399">0</font> <font color="#990000">||</font> hours <font color="#990000">&gt;</font> <font color="#993399">23</font> <font color="#990000">)</font>
  <font color="#FF0000">{</font>
    <b><font color="#0000FF">return</font></b> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
  <font color="#FF0000">}</font>

  <b><font color="#0000FF">if</font></b><font color="#990000">(</font> minutes <font color="#990000">&lt;</font> <font color="#993399">0</font> <font color="#990000">||</font> minutes <font color="#990000">&gt;</font> <font color="#993399">59</font> <font color="#990000">)</font>
  <font color="#FF0000">{</font>
    <b><font color="#0000FF">return</font></b> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
  <font color="#FF0000">}</font>

  <b><font color="#0000FF">if</font></b><font color="#990000">(</font> seconds <font color="#990000">&lt;</font> <font color="#993399">0</font> <font color="#990000">||</font> seconds <font color="#990000">&gt;</font> <font color="#993399">59</font> <font color="#990000">)</font>
  <font color="#FF0000">{</font>
    <b><font color="#0000FF">return</font></b> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
  <font color="#FF0000">}</font>

  <b><font color="#0000FF">return</font></b> <font color="#993399">0</font><font color="#990000">;</font>
<font color="#FF0000">}</font>

<font color="#009900">char</font> <font color="#990000">*</font><b><font color="#000000">decimal_date_to_real_date</font></b><font color="#990000">(</font><font color="#009900">double</font> decimaltime<font color="#990000">)</font>
<font color="#FF0000">{</font>
    <b><font color="#0000FF">static</font></b> <font color="#009900">char</font> string<font color="#990000">[</font><font color="#993399">400</font><font color="#990000">];</font>
    <font color="#009900">int</font> daysahead<font color="#990000">;</font>
    <font color="#009900">int</font> counter1 <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">,</font> counter2 <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
    <font color="#009900">int</font> yy<font color="#990000">,</font> mm<font color="#990000">;</font>

    <font color="#008080">time_t</font> mytime<font color="#990000">;</font>
    <b><font color="#0000FF">struct</font></b> <font color="#008080">tm</font> <font color="#990000">*</font>my_tm<font color="#990000">;</font>

    <b><font color="#000000">time</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>
    my_tm <font color="#990000">=</font> <b><font color="#000000">localtime</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>

    <i><font color="#9A1900">// add 1 decimal second..</font></i>
    decimaltime <font color="#990000">+=</font> <font color="#993399">0.000000032</font><font color="#990000">;</font>

    <font color="#009900">double</font> secondsintotoday <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#990000">(</font> <font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)(</font>my_tm<font color="#990000">-&gt;</font>tm_hour<font color="#990000">)*</font>
                                           <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">60</font><font color="#990000">*(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">60</font><font color="#990000">)</font> <font color="#990000">+</font>
                                           <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)(</font>my_tm<font color="#990000">-&gt;</font>tm_min<font color="#990000">*</font><font color="#993399">60</font><font color="#990000">)</font> <font color="#990000">+</font>
                                           <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> my_tm<font color="#990000">-&gt;</font>tm_sec<font color="#990000">);</font>
    <i><font color="#9A1900">/* </font></i>
<i><font color="#9A1900">     * 86400 seconds in 24 hours</font></i>
<i><font color="#9A1900">     * add to the decimal time how much decimal time we are already</font></i>
<i><font color="#9A1900">     * into today</font></i>
<i><font color="#9A1900">     */</font></i>
     decimaltime <font color="#990000">=</font> decimaltime <font color="#990000">+</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#990000">(</font>
                    <font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>secondsintotoday<font color="#990000">/(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">86400</font><font color="#990000">)/</font> <font color="#993399">365</font>
                                         <font color="#990000">);</font>
    <i><font color="#9A1900">/* if the decimal date indicates today just return */</font></i>
    <b><font color="#0000FF">if</font></b><font color="#990000">(</font> decimaltime <font color="#990000">&lt;</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#990000">((</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#993399">1</font> <font color="#990000">/</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#993399">365</font><font color="#990000">)</font> <font color="#990000">)</font>
    <font color="#FF0000">{</font>

        <font color="#009900">double</font> hoursoftoday <font color="#990000">=</font> <font color="#990000">((</font><font color="#009900">double</font><font color="#990000">)</font> decimaltime <font color="#990000">*</font> <font color="#993399">365</font><font color="#990000">)</font> <font color="#990000">*</font> <font color="#993399">24</font><font color="#990000">;</font>
        <font color="#009900">double</font> dummy<font color="#990000">;</font>
        <font color="#009900">double</font> percentminutesofhour <font color="#990000">=</font> <b><font color="#000000">modf</font></b><font color="#990000">(</font>hoursoftoday<font color="#990000">,&amp;</font>dummy<font color="#990000">);</font>

        <font color="#009900">int</font> minutes <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">int</font><font color="#990000">)</font> <font color="#990000">(</font>percentminutesofhour <font color="#990000">*</font> <font color="#993399">60</font><font color="#990000">);</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> minutes <font color="#990000">&gt;=</font> <font color="#993399">30</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          hoursoftoday <font color="#990000">-=</font> <font color="#993399">1</font><font color="#990000">;</font>

          <b><font color="#0000FF">if</font></b><font color="#990000">(</font> hoursoftoday <font color="#990000">&lt;</font> <font color="#993399">0</font> <font color="#990000">)</font>
            hoursoftoday <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
        <font color="#FF0000">}</font>

        <b><font color="#000000">sprintf</font></b><font color="#990000">(</font>string<font color="#990000">,</font><font color="#FF0000">"%s %02d %02d %02.0f:%02d"</font><font color="#990000">,</font>mon<font color="#990000">[</font>my_tm<font color="#990000">-&gt;</font>tm_mon<font color="#990000">],</font>my_tm<font color="#990000">-&gt;</font>tm_mday<font color="#990000">,</font>my_tm<font color="#990000">-&gt;</font>tm_year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">,</font>hoursoftoday<font color="#990000">,(</font>minutes <font color="#990000">==</font> <font color="#993399">60</font> <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> minutes<font color="#990000">));</font>

        <b><font color="#0000FF">return</font></b> <font color="#990000">&amp;</font>string<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">];</font>
    <font color="#FF0000">}</font>

    counter1 <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_mday<font color="#990000">;</font>
    counter2 <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">;</font>

    daysahead <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">int</font><font color="#990000">)</font> <font color="#990000">(</font><font color="#993399">365</font><font color="#990000">*</font>decimaltime<font color="#990000">);</font>

    <font color="#009900">double</font> daysaheaddouble <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#993399">365</font> <font color="#990000">*</font> decimaltime<font color="#990000">;</font>
    <font color="#009900">double</font> dummy<font color="#990000">;</font>
    <font color="#009900">double</font> decimallasthours <font color="#990000">=</font> <b><font color="#000000">modf</font></b><font color="#990000">(</font>daysaheaddouble<font color="#990000">,&amp;</font>dummy<font color="#990000">);</font>
    <font color="#009900">double</font> lasthours <font color="#990000">=</font> <font color="#990000">((</font><font color="#009900">double</font><font color="#990000">)</font>decimallasthours <font color="#990000">*</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#993399">24</font><font color="#990000">);</font>
    <font color="#009900">double</font> lastminutes <font color="#990000">=</font> <b><font color="#000000">modf</font></b><font color="#990000">(</font>lasthours<font color="#990000">,&amp;</font>dummy<font color="#990000">);</font>
    <font color="#009900">int</font> minutes <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">int</font><font color="#990000">)</font> <font color="#990000">(</font>lastminutes <font color="#990000">*</font> <font color="#993399">60</font><font color="#990000">);</font>
       
    <font color="#009900">int</font> year  <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_year<font color="#990000">;</font>
    <font color="#009900">int</font> month <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_mon<font color="#990000">;</font>
    <font color="#009900">int</font> found <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
    
    <b><font color="#0000FF">while</font></b><font color="#990000">(</font> <font color="#990000">!</font>found <font color="#990000">)</font>
    <font color="#FF0000">{</font>
        <i><font color="#9A1900">/* figure out if it is a leap year and adjust the month feb */</font></i>
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> <font color="#990000">(</font> <font color="#990000">(</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">4</font> <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">100</font> <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">)</font> <font color="#990000">||</font> <font color="#990000">(</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">400</font> <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
            months<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">29</font><font color="#990000">;</font>
            
        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
        <font color="#FF0000">{</font>
            months<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">28</font><font color="#990000">;</font>
        <font color="#FF0000">}</font>
        
        <i><font color="#9A1900">/* increment through the month */</font></i>
        <b><font color="#0000FF">while</font></b><font color="#990000">(</font> counter1 <font color="#990000">&lt;</font> months<font color="#990000">[</font>month<font color="#990000">]</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
            <b><font color="#0000FF">if</font></b><font color="#990000">(</font> counter2<font color="#990000">++</font> <font color="#990000">&gt;=</font> daysahead <font color="#990000">)</font>
            <font color="#FF0000">{</font>
                yy <font color="#990000">=</font> year<font color="#990000">-</font><font color="#993399">100</font><font color="#990000">;</font>
                mm <font color="#990000">=</font> month<font color="#990000">;</font>
                found <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">;</font>

                <b><font color="#0000FF">if</font></b><font color="#990000">(</font> minutes <font color="#990000">&gt;=</font> <font color="#993399">30</font> <font color="#990000">)</font>
                <font color="#FF0000">{</font>
                  lasthours <font color="#990000">-=</font> <font color="#993399">1</font><font color="#990000">;</font>

                  <b><font color="#0000FF">if</font></b><font color="#990000">(</font> lasthours <font color="#990000">&lt;</font> <font color="#993399">0</font> <font color="#990000">)</font>
                    lasthours <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
                <font color="#FF0000">}</font>
                
                <i><font color="#9A1900">/*sprintf(string,"%s %02d %02d %02.0f:%02d",mon[mm],counter1+1,yy,lasthours,(minutes == 60 ? 0: minutes));*/</font></i>
                <b><font color="#000000">sprintf</font></b><font color="#990000">(</font>string<font color="#990000">,</font><font color="#FF0000">"%s %02d %d %02.0f:%02d"</font><font color="#990000">,</font>mon<font color="#990000">[</font>mm<font color="#990000">],</font>counter1<font color="#990000">+</font><font color="#993399">1</font><font color="#990000">,</font>yy<font color="#990000">+</font><font color="#993399">2000</font><font color="#990000">,</font>lasthours<font color="#990000">,(</font>minutes <font color="#990000">==</font> <font color="#993399">60</font> <font color="#990000">?</font> <font color="#993399">0</font><font color="#990000">:</font> minutes<font color="#990000">));</font>

                <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            counter1<font color="#990000">++;</font>
            
        <font color="#FF0000">}</font> <i><font color="#9A1900">/* while(counter1&lt;months[month]) */</font></i>
        counter1 <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> month<font color="#990000">++</font> <font color="#990000">==</font> <font color="#993399">11</font> <font color="#990000">)</font> <i><font color="#9A1900">/* months 0-11 */</font></i>
        <font color="#FF0000">{</font>
            month <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>        <i><font color="#9A1900">/* set to Jan */</font></i>
            year<font color="#990000">++;</font>
        <font color="#FF0000">}</font>
        
    <font color="#FF0000">}</font> <i><font color="#9A1900">/* while(!found) */</font></i>
    
    <b><font color="#0000FF">return</font></b> <font color="#990000">&amp;</font>string<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">];</font>
<font color="#FF0000">}</font>

<font color="#009900">void</font> <b><font color="#000000">decimal_date_to_real_dates</font></b><font color="#990000">(</font><font color="#009900">double</font> decimaltime<font color="#990000">,</font> <font color="#009900">int</font> <font color="#990000">*</font>y<font color="#990000">,</font> <font color="#009900">int</font> <font color="#990000">*</font>m<font color="#990000">,</font> <font color="#009900">int</font> <font color="#990000">*</font>d<font color="#990000">,</font> <font color="#009900">int</font> <font color="#990000">*</font>h<font color="#990000">,</font> <font color="#009900">int</font> <font color="#990000">*</font>min<font color="#990000">,</font> <font color="#009900">int</font> <font color="#990000">*</font>sec<font color="#990000">)</font>
<font color="#FF0000">{</font>
    <font color="#009900">int</font> daysahead<font color="#990000">;</font>
    <font color="#009900">int</font> counter1 <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">,</font> counter2 <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
    <font color="#009900">int</font> yy<font color="#990000">,</font> mm<font color="#990000">;</font>

    <font color="#008080">time_t</font> mytime<font color="#990000">;</font>
    <b><font color="#0000FF">struct</font></b> <font color="#008080">tm</font> <font color="#990000">*</font>my_tm<font color="#990000">;</font>

    <b><font color="#000000">time</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>
    my_tm <font color="#990000">=</font> <b><font color="#000000">localtime</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>

    <i><font color="#9A1900">// add 1 decimal second..</font></i>
    decimaltime <font color="#990000">+=</font> <font color="#993399">0.000000032</font><font color="#990000">;</font>

    <font color="#009900">double</font> secondsintotoday <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#990000">(</font> <font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)(</font>my_tm<font color="#990000">-&gt;</font>tm_hour<font color="#990000">)*</font>
                                           <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">60</font><font color="#990000">*(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">60</font><font color="#990000">)</font> <font color="#990000">+</font>
                                           <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)(</font>my_tm<font color="#990000">-&gt;</font>tm_min<font color="#990000">*</font><font color="#993399">60</font><font color="#990000">)</font> <font color="#990000">+</font>
                                           <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> my_tm<font color="#990000">-&gt;</font>tm_sec<font color="#990000">);</font>
    <i><font color="#9A1900">/* </font></i>
<i><font color="#9A1900">     * 86400 seconds in 24 hours</font></i>
<i><font color="#9A1900">     * add to the decimal time how much decimal time we are already</font></i>
<i><font color="#9A1900">     * into today</font></i>
<i><font color="#9A1900">     */</font></i>
     decimaltime <font color="#990000">=</font> decimaltime <font color="#990000">+</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#990000">(</font>
                    <font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>secondsintotoday<font color="#990000">/(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">86400</font><font color="#990000">)/</font> <font color="#993399">365</font>
                                         <font color="#990000">);</font>
    <i><font color="#9A1900">/* if the decimal date indicates today just return */</font></i>
    <b><font color="#0000FF">if</font></b><font color="#990000">(</font> decimaltime <font color="#990000">&lt;</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#990000">((</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#993399">1</font> <font color="#990000">/</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#993399">365</font><font color="#990000">)</font> <font color="#990000">)</font>
    <font color="#FF0000">{</font>
        <font color="#009900">double</font> hoursoftoday <font color="#990000">=</font> <font color="#990000">((</font><font color="#009900">double</font><font color="#990000">)</font> decimaltime <font color="#990000">*</font> <font color="#993399">365</font><font color="#990000">)</font> <font color="#990000">*</font> <font color="#993399">24</font><font color="#990000">;</font>
        <font color="#009900">double</font> dummy<font color="#990000">;</font>
        <font color="#009900">double</font> percentminutesofhour <font color="#990000">=</font> <b><font color="#000000">modf</font></b><font color="#990000">(</font>hoursoftoday<font color="#990000">,&amp;</font>dummy<font color="#990000">);</font>

        <font color="#009900">int</font> minutes <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">int</font><font color="#990000">)</font> <font color="#990000">(</font>percentminutesofhour <font color="#990000">*</font> <font color="#993399">60</font><font color="#990000">);</font>
        <font color="#009900">double</font> percentminutes <font color="#990000">=</font> <font color="#990000">(</font>percentminutesofhour <font color="#990000">*</font> <font color="#993399">60</font><font color="#990000">);</font>
        <font color="#009900">double</font> seconds <font color="#990000">=</font> <b><font color="#000000">modf</font></b><font color="#990000">(</font>percentminutes<font color="#990000">,</font> <font color="#990000">&amp;</font>dummy<font color="#990000">);</font>
        seconds <font color="#990000">*=</font> <font color="#993399">60</font><font color="#990000">;</font>
        <font color="#009900">int</font> int_seconds <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">int</font><font color="#990000">)</font> seconds<font color="#990000">;</font>
        int_seconds<font color="#990000">--;</font>
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> int_seconds <font color="#990000">==</font> <font color="#990000">-</font><font color="#993399">1</font> <font color="#990000">)</font>
          int_seconds <font color="#990000">=</font> <font color="#993399">59</font><font color="#990000">;</font>

        <i><font color="#9A1900">//printf("Current     %d:%d:%d\n",my_tm-&gt;tm_hour,my_tm-&gt;tm_min,my_tm-&gt;tm_sec);</font></i>
        <i><font color="#9A1900">//printf("%s %02d %02d %02.0f:%02d:%02d\n",mon[my_tm-&gt;tm_mon],my_tm-&gt;tm_mday,my_tm-&gt;tm_year+1900,hoursoftoday,(minutes == 60 ? 0 : minutes),int_seconds);</font></i>
        <font color="#990000">*</font>y <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">;</font>
        <font color="#990000">*</font>m <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_mon<font color="#990000">;</font>
        <font color="#990000">*</font>d <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_mday<font color="#990000">;</font>
        <font color="#990000">*</font>h <font color="#990000">=</font> hoursoftoday<font color="#990000">;</font>
        <font color="#990000">*</font>min <font color="#990000">=</font> <font color="#990000">(</font>minutes <font color="#990000">==</font> <font color="#993399">60</font> <font color="#990000">?</font> <font color="#993399">0</font><font color="#990000">:</font> minutes<font color="#990000">);</font>
        <font color="#990000">*</font>sec <font color="#990000">=</font> int_seconds<font color="#990000">;</font>
        <b><font color="#0000FF">return</font></b><font color="#990000">;</font>
    <font color="#FF0000">}</font>

    counter1 <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_mday<font color="#990000">;</font>
    counter2 <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">;</font>

    daysahead <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">int</font><font color="#990000">)</font> <font color="#990000">(</font><font color="#993399">365</font><font color="#990000">*</font>decimaltime<font color="#990000">);</font>

    <font color="#009900">double</font> daysaheaddouble <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#993399">365</font> <font color="#990000">*</font> decimaltime<font color="#990000">;</font>
    <font color="#009900">double</font> dummy<font color="#990000">;</font>
    <font color="#009900">double</font> decimallasthours <font color="#990000">=</font> <b><font color="#000000">modf</font></b><font color="#990000">(</font>daysaheaddouble<font color="#990000">,&amp;</font>dummy<font color="#990000">);</font>
    <font color="#009900">double</font> lasthours <font color="#990000">=</font> <font color="#990000">((</font><font color="#009900">double</font><font color="#990000">)</font>decimallasthours <font color="#990000">*</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#993399">24</font><font color="#990000">);</font>
    <font color="#009900">double</font> lastminutes <font color="#990000">=</font> <b><font color="#000000">modf</font></b><font color="#990000">(</font>lasthours<font color="#990000">,&amp;</font>dummy<font color="#990000">);</font>
    <font color="#009900">int</font> minutes <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">int</font><font color="#990000">)</font> <font color="#990000">(</font>lastminutes <font color="#990000">*</font> <font color="#993399">60</font><font color="#990000">);</font>

    <font color="#009900">double</font> seconds <font color="#990000">=</font> <b><font color="#000000">modf</font></b><font color="#990000">(</font>lastminutes <font color="#990000">*</font> <font color="#993399">60</font><font color="#990000">,</font> <font color="#990000">&amp;</font>dummy<font color="#990000">);</font>
    seconds <font color="#990000">*=</font> <font color="#993399">60</font><font color="#990000">;</font>
    <font color="#009900">int</font> int_seconds <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">int</font><font color="#990000">)</font> seconds<font color="#990000">;</font>
    int_seconds<font color="#990000">--;</font>
    <b><font color="#0000FF">if</font></b><font color="#990000">(</font> int_seconds <font color="#990000">==</font> <font color="#990000">-</font><font color="#993399">1</font> <font color="#990000">)</font>
      int_seconds <font color="#990000">=</font> <font color="#993399">59</font><font color="#990000">;</font>
       
    <font color="#009900">int</font> year  <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_year<font color="#990000">;</font>
    <font color="#009900">int</font> month <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_mon<font color="#990000">;</font>
    <font color="#009900">int</font> found <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
    
    <b><font color="#0000FF">while</font></b><font color="#990000">(</font> <font color="#990000">!</font>found <font color="#990000">)</font>
    <font color="#FF0000">{</font>
        <i><font color="#9A1900">/* figure out if it is a leap year and adjust the month feb */</font></i>
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> <font color="#990000">(</font> <font color="#990000">(</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">4</font> <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">100</font> <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">)</font> <font color="#990000">||</font> <font color="#990000">(</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">400</font> <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
            months<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">29</font><font color="#990000">;</font>
            
        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
        <font color="#FF0000">{</font>
            months<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">28</font><font color="#990000">;</font>
        <font color="#FF0000">}</font>
        
        <i><font color="#9A1900">/* increment through the month */</font></i>
        <b><font color="#0000FF">while</font></b><font color="#990000">(</font> counter1 <font color="#990000">&lt;</font> months<font color="#990000">[</font>month<font color="#990000">]</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
            <b><font color="#0000FF">if</font></b><font color="#990000">(</font> counter2<font color="#990000">++</font> <font color="#990000">&gt;=</font> daysahead <font color="#990000">)</font>
            <font color="#FF0000">{</font>
                yy <font color="#990000">=</font> year<font color="#990000">-</font><font color="#993399">100</font><font color="#990000">;</font>
                mm <font color="#990000">=</font> month<font color="#990000">;</font>
                found <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">;</font>

                <i><font color="#9A1900">//sprintf(string,"%s %02d %d %02.0f:%02d",mon[mm],counter1+1,yy+2000,lasthours,(minutes == 60 ? 0: minutes));</font></i>

                <font color="#990000">*</font>y <font color="#990000">=</font> yy <font color="#990000">+</font> <font color="#993399">2000</font><font color="#990000">;</font>
                <font color="#990000">*</font>m <font color="#990000">=</font> mm<font color="#990000">;</font>
                <font color="#990000">*</font>d <font color="#990000">=</font> counter1<font color="#990000">+</font><font color="#993399">1</font><font color="#990000">;</font>
                <font color="#990000">*</font>h <font color="#990000">=</font> lasthours<font color="#990000">;</font>
                <font color="#990000">*</font>min <font color="#990000">=</font> <font color="#990000">(</font>minutes <font color="#990000">==</font> <font color="#993399">60</font> <font color="#990000">?</font> <font color="#993399">0</font><font color="#990000">:</font> minutes<font color="#990000">);</font>
                <font color="#990000">*</font>sec <font color="#990000">=</font> int_seconds<font color="#990000">;</font>
                <i><font color="#9A1900">//printf("Current     %d:%d:%d\n",my_tm-&gt;tm_hour,my_tm-&gt;tm_min,my_tm-&gt;tm_sec);</font></i>
                <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            counter1<font color="#990000">++;</font>
            
        <font color="#FF0000">}</font> <i><font color="#9A1900">/* while(counter1&lt;months[month]) */</font></i>
        counter1 <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> month<font color="#990000">++</font> <font color="#990000">==</font> <font color="#993399">11</font> <font color="#990000">)</font> <i><font color="#9A1900">/* months 0-11 */</font></i>
        <font color="#FF0000">{</font>
            month <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>        <i><font color="#9A1900">/* set to Jan */</font></i>
            year<font color="#990000">++;</font>
        <font color="#FF0000">}</font>
        
    <font color="#FF0000">}</font> <i><font color="#9A1900">/* while(!found) */</font></i>
    
    <b><font color="#0000FF">return</font></b><font color="#990000">;</font>
<font color="#FF0000">}</font>

<font color="#009900">int</font> <b><font color="#000000">decimal_date_to_int_month</font></b><font color="#990000">(</font><font color="#009900">double</font> decimaltime<font color="#990000">)</font>
<font color="#FF0000">{</font>
    <font color="#009900">int</font> daysahead<font color="#990000">;</font>
    <font color="#009900">int</font> counter1 <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
    <font color="#009900">int</font> counter2 <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
    <font color="#009900">int</font> mm<font color="#990000">;</font>

    <font color="#008080">time_t</font> mytime<font color="#990000">;</font>
    <b><font color="#0000FF">struct</font></b> <font color="#008080">tm</font> <font color="#990000">*</font>my_tm<font color="#990000">;</font>

    <b><font color="#000000">time</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>
    my_tm <font color="#990000">=</font> <b><font color="#000000">localtime</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>

    daysahead <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">int</font><font color="#990000">)</font> <font color="#990000">(</font><font color="#993399">365</font><font color="#990000">*</font>decimaltime<font color="#990000">);</font>

    counter1 <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_mday<font color="#990000">;</font>
    counter2 <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
    
    <font color="#009900">int</font> year  <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_year<font color="#990000">;</font>
    <font color="#009900">int</font> month <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_mon<font color="#990000">;</font>

    <font color="#009900">int</font> found <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
    
    <b><font color="#0000FF">while</font></b><font color="#990000">(</font> <font color="#990000">!</font>found <font color="#990000">)</font>
    <font color="#FF0000">{</font>
        <i><font color="#9A1900">/* figure out if it is a leap year and adjust the month feb */</font></i>
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> <font color="#990000">(</font> <font color="#990000">(</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">4</font> <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">100</font> <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">)</font> <font color="#990000">||</font> <font color="#990000">(</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">400</font> <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
            months<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">29</font><font color="#990000">;</font>
            
        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
        <font color="#FF0000">{</font>
            months<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">28</font><font color="#990000">;</font>
        <font color="#FF0000">}</font>
        
        <i><font color="#9A1900">/* increment through the month */</font></i>
        <b><font color="#0000FF">while</font></b><font color="#990000">(</font> counter1 <font color="#990000">&lt;</font> months<font color="#990000">[</font>month<font color="#990000">]</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
            <b><font color="#0000FF">if</font></b><font color="#990000">(</font> counter2<font color="#990000">++</font> <font color="#990000">==</font> daysahead <font color="#990000">)</font>
            <font color="#FF0000">{</font>
                mm <font color="#990000">=</font> month<font color="#990000">;</font>
                <i><font color="#9A1900">/* dd = day;*/</font></i>
                found <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">;</font>
                
                <i><font color="#9A1900">/*sprintf(string,"%s %02d %02d",mon[mm],counter1+1,yy);*/</font></i>
                <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            counter1<font color="#990000">++;</font>
            
        <font color="#FF0000">}</font> <i><font color="#9A1900">/* while(counter1&lt;months[month]) */</font></i>
        counter1 <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> month<font color="#990000">++</font> <font color="#990000">==</font> <font color="#993399">11</font> <font color="#990000">)</font> <i><font color="#9A1900">/* months 0-11 */</font></i>
        <font color="#FF0000">{</font>
            month <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>        <i><font color="#9A1900">/* set to Jan */</font></i>
            year<font color="#990000">++;</font>
        <font color="#FF0000">}</font>
        
    <font color="#FF0000">}</font> <i><font color="#9A1900">/* while(!found) */</font></i>
    
    <b><font color="#0000FF">return</font></b> mm<font color="#990000">;</font>
<font color="#FF0000">}</font>

<font color="#009900">int</font> <b><font color="#000000">decimal_date_to_int_year</font></b><font color="#990000">(</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font> decimaltime<font color="#990000">)</font>
<font color="#FF0000">{</font>
    <font color="#009900">int</font> daysahead<font color="#990000">;</font>
    <font color="#009900">int</font> counter1 <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
    <font color="#009900">int</font> counter2 <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
    <font color="#009900">int</font> yy<font color="#990000">;</font>

    <font color="#008080">time_t</font> mytime<font color="#990000">;</font>
    <b><font color="#0000FF">struct</font></b> <font color="#008080">tm</font> <font color="#990000">*</font>my_tm<font color="#990000">;</font>

    <b><font color="#000000">time</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>
    my_tm <font color="#990000">=</font> <b><font color="#000000">localtime</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>

    daysahead <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">int</font><font color="#990000">)</font> <font color="#990000">(</font><font color="#993399">365</font><font color="#990000">*</font>decimaltime<font color="#990000">);</font>

    counter1 <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_mday<font color="#990000">;</font>
    counter2 <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
    
    <font color="#009900">int</font> year  <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_year<font color="#990000">;</font>
    <font color="#009900">int</font> month <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_mon<font color="#990000">;</font>

    <font color="#009900">int</font> found <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
    
    <b><font color="#0000FF">while</font></b><font color="#990000">(</font> <font color="#990000">!</font>found <font color="#990000">)</font>
    <font color="#FF0000">{</font>
        <i><font color="#9A1900">/* figure out if it is a leap year and adjust the month feb */</font></i>
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> <font color="#990000">(</font> <font color="#990000">(</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">4</font> <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">100</font> <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">)</font> <font color="#990000">||</font> <font color="#990000">(</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">400</font> <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
            months<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">29</font><font color="#990000">;</font>
            
        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
        <font color="#FF0000">{</font>
            months<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">28</font><font color="#990000">;</font>
        <font color="#FF0000">}</font>
        
        <i><font color="#9A1900">/* increment through the month */</font></i>
        <b><font color="#0000FF">while</font></b><font color="#990000">(</font> counter1 <font color="#990000">&lt;</font> months<font color="#990000">[</font>month<font color="#990000">]</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
            <b><font color="#0000FF">if</font></b><font color="#990000">(</font> counter2<font color="#990000">++</font> <font color="#990000">==</font> daysahead <font color="#990000">)</font>
            <font color="#FF0000">{</font>
                yy <font color="#990000">=</font> year<font color="#990000">-</font><font color="#993399">100</font><font color="#990000">;</font>
                <i><font color="#9A1900">/* dd = day;*/</font></i>
                found <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">;</font>
                
                <i><font color="#9A1900">/*sprintf(string,"%s %02d %02d",mon[mm],counter1+1,yy);*/</font></i>
                <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            counter1<font color="#990000">++;</font>
            
        <font color="#FF0000">}</font> <i><font color="#9A1900">/* while(counter1&lt;months[month]) */</font></i>
        counter1 <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> month<font color="#990000">++</font> <font color="#990000">==</font> <font color="#993399">11</font> <font color="#990000">)</font> <i><font color="#9A1900">/* months 0-11 */</font></i>
        <font color="#FF0000">{</font>
            month <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>        <i><font color="#9A1900">/* set to Jan */</font></i>
            year<font color="#990000">++;</font>
        <font color="#FF0000">}</font>
        
    <font color="#FF0000">}</font> <i><font color="#9A1900">/* while(!found) */</font></i>
    
    <b><font color="#0000FF">return</font></b> yy<font color="#990000">;</font>
<font color="#FF0000">}</font>

<font color="#009900">double</font> <b><font color="#000000">adjust_to_current_time</font></b><font color="#990000">(</font><font color="#009900">double</font> t<font color="#990000">,</font> <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> day_offset<font color="#990000">)</font>
<font color="#FF0000">{</font>
  <font color="#008080">time_t</font> mytime<font color="#990000">;</font>
  <b><font color="#0000FF">struct</font></b> <font color="#008080">tm</font> <font color="#990000">*</font>my_tm<font color="#990000">;</font>

  <b><font color="#000000">time</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>
  my_tm <font color="#990000">=</font> <b><font color="#000000">localtime</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>

  <font color="#009900">double</font> expiration_time <font color="#990000">=</font> <font color="#993399">86400</font><font color="#990000">;</font> <i><font color="#9A1900">/* 23 * 60 * 60 + 59 * 60 + 60 */</font></i>

  t <font color="#990000">=</font> t <font color="#990000">+</font> day_offset<font color="#990000">;</font>

  <i><font color="#9A1900">/* 86400 seconds in 24 hours */</font></i>
  <font color="#009900">double</font> k <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#990000">(</font>
                 <font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)(</font>my_tm<font color="#990000">-&gt;</font>tm_hour<font color="#990000">)*(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">60</font><font color="#990000">*(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">60</font><font color="#990000">)</font> <font color="#990000">+</font>
                   <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)(</font>my_tm<font color="#990000">-&gt;</font>tm_min<font color="#990000">*</font><font color="#993399">60</font><font color="#990000">)</font> <font color="#990000">+</font>
                   <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> my_tm<font color="#990000">-&gt;</font>tm_sec<font color="#990000">);</font>

  t <font color="#990000">=</font> t <font color="#990000">-</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#990000">(</font> <font color="#990000">(</font>expiration_time<font color="#990000">-</font>k<font color="#990000">)</font> <font color="#990000">/(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">86400</font><font color="#990000">)/(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">365</font><font color="#990000">;</font>
  
  <b><font color="#0000FF">return</font></b> t<font color="#990000">;</font>
<font color="#FF0000">}</font>

<font color="#009900">double</font> <b><font color="#000000">adjust_to_current_time_forward</font></b><font color="#990000">(</font><font color="#009900">double</font> t<font color="#990000">,</font> <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> day_offset<font color="#990000">)</font>
<font color="#FF0000">{</font>
  <font color="#008080">time_t</font> mytime<font color="#990000">;</font>
  <b><font color="#0000FF">struct</font></b> <font color="#008080">tm</font> <font color="#990000">*</font>my_tm<font color="#990000">;</font>

  <b><font color="#000000">time</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>
  my_tm <font color="#990000">=</font> <b><font color="#000000">localtime</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>

  <font color="#009900">double</font> expiration_time <font color="#990000">=</font> <font color="#993399">86400</font><font color="#990000">;</font> <i><font color="#9A1900">/* 23 * 60 * 60 + 59 * 60 + 60 */</font></i>

  t <font color="#990000">=</font> t <font color="#990000">+</font> day_offset<font color="#990000">;</font>

  <i><font color="#9A1900">/* 86400 seconds in 24 hours */</font></i>
  <font color="#009900">double</font> k <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#990000">(</font>
                 <font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)(</font>my_tm<font color="#990000">-&gt;</font>tm_hour<font color="#990000">)*(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">60</font><font color="#990000">*(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">60</font><font color="#990000">)</font> <font color="#990000">+</font>
                   <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)(</font>my_tm<font color="#990000">-&gt;</font>tm_min<font color="#990000">*</font><font color="#993399">60</font><font color="#990000">)</font> <font color="#990000">+</font>
                   <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> my_tm<font color="#990000">-&gt;</font>tm_sec<font color="#990000">);</font>

  t <font color="#990000">=</font> t <font color="#990000">+</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#990000">(</font> <font color="#990000">(</font>expiration_time<font color="#990000">-</font>k<font color="#990000">)</font> <font color="#990000">/(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">86400</font><font color="#990000">)/(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">365</font><font color="#990000">;</font>
  
  <b><font color="#0000FF">return</font></b> t<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900"> * add user adjustable expiration time HH:MM:SS</font></i>
<i><font color="#9A1900"> * minus out time into the current day</font></i>
<i><font color="#9A1900"> */</font></i>
<font color="#009900">double</font> <b><font color="#000000">adjust_to_current_time_and_expr</font></b><font color="#990000">(</font><font color="#009900">int</font> <font color="#990000">*</font>tte<font color="#990000">,</font> <font color="#009900">unsigned</font> <font color="#009900">int</font> expiration_time<font color="#990000">,</font> <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> day_offset<font color="#990000">)</font>
<font color="#FF0000">{</font>
  <font color="#009900">double</font> temp<font color="#990000">;</font>

  <font color="#008080">time_t</font> mytime<font color="#990000">;</font>
  <b><font color="#0000FF">struct</font></b> <font color="#008080">tm</font> <font color="#990000">*</font>my_tm<font color="#990000">;</font>

  <b><font color="#000000">time</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>
  my_tm <font color="#990000">=</font> <b><font color="#000000">localtime</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>

  temp <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#990000">(*</font>tte<font color="#990000">)/</font><font color="#993399">365</font><font color="#990000">;</font>
  temp <font color="#990000">=</font> temp <font color="#990000">+</font> day_offset<font color="#990000">;</font>

  <i><font color="#9A1900">/*   86400 seconds in 24 hours */</font></i>
  <font color="#009900">double</font> k <font color="#990000">=</font> expiration_time <font color="#990000">-</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#990000">(</font>
                 <font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)(</font>my_tm<font color="#990000">-&gt;</font>tm_hour<font color="#990000">)*(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">60</font><font color="#990000">*(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">60</font><font color="#990000">)</font> <font color="#990000">+</font>
                   <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)(</font>my_tm<font color="#990000">-&gt;</font>tm_min<font color="#990000">*</font><font color="#993399">60</font><font color="#990000">)</font> <font color="#990000">+</font>
                   <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> my_tm<font color="#990000">-&gt;</font>tm_sec<font color="#990000">);</font>

  temp <font color="#990000">=</font> temp <font color="#990000">+(</font><font color="#009900">double</font><font color="#990000">)</font> <font color="#990000">(</font>k <font color="#990000">/(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">86400</font><font color="#990000">)/(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">365</font><font color="#990000">;</font>
  
  <b><font color="#0000FF">return</font></b> temp<font color="#990000">;</font>
<font color="#FF0000">}</font>

<font color="#009900">int</font> <b><font color="#000000">expires</font></b><font color="#990000">(</font><b><font color="#0000FF">const</font></b> <font color="#009900">int</font> leg<font color="#990000">,</font> <b><font color="#0000FF">const</font></b> <font color="#009900">int</font> monthsahead<font color="#990000">,</font> <b><font color="#0000FF">const</font></b> <font color="#009900">int</font> skip_<font color="#990000">,</font> <b><font color="#0000FF">struct</font></b> <font color="#008080">_properties</font> <font color="#990000">*</font>properties<font color="#990000">)</font>
<font color="#FF0000">{</font>
    <i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900">     * avoid using difftime() due to having a </font></i>
<i><font color="#9A1900">     * 2038 Jan 19 03:14:07 bug on 32 bit systems</font></i>
<i><font color="#9A1900">     */</font></i>

    <font color="#009900">int</font> <font color="#990000">**</font>tte<font color="#990000">,</font> <font color="#990000">**</font>d<font color="#990000">,</font> <font color="#990000">**</font>em<font color="#990000">,</font> <font color="#990000">**</font>ey<font color="#990000">;</font>

    <b><font color="#0000FF">if</font></b><font color="#990000">(</font> leg <font color="#990000">==</font> LEG1 <font color="#990000">)</font>
    <font color="#FF0000">{</font>

      tte <font color="#990000">=</font> <font color="#990000">&amp;</font>properties<font color="#990000">-&gt;</font>time_to_expiration<font color="#990000">;</font>
      d   <font color="#990000">=</font> <font color="#990000">&amp;</font>properties<font color="#990000">-&gt;</font>days_to_expiration<font color="#990000">;</font>
      em  <font color="#990000">=</font> <font color="#990000">&amp;</font>properties<font color="#990000">-&gt;</font>expiration_month<font color="#990000">;</font>
      ey  <font color="#990000">=</font> <font color="#990000">&amp;</font>properties<font color="#990000">-&gt;</font>expiration_year<font color="#990000">;</font>

    <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> leg <font color="#990000">==</font> LEG2 <font color="#990000">)</font>
    <font color="#FF0000">{</font>

      tte <font color="#990000">=</font> <font color="#990000">&amp;</font>properties<font color="#990000">-&gt;</font>time_to_expiration2<font color="#990000">;</font>
      d   <font color="#990000">=</font> <font color="#990000">&amp;</font>properties<font color="#990000">-&gt;</font>days_to_expiration2<font color="#990000">;</font>
      em  <font color="#990000">=</font> <font color="#990000">&amp;</font>properties<font color="#990000">-&gt;</font>expiration_month2<font color="#990000">;</font>
      ey  <font color="#990000">=</font> <font color="#990000">&amp;</font>properties<font color="#990000">-&gt;</font>expiration_year2<font color="#990000">;</font>

    <font color="#FF0000">}</font>

    <font color="#009900">int</font> skip <font color="#990000">=</font> skip_<font color="#990000">;</font>
    <font color="#009900">int</font> monthcounter <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
    <font color="#009900">int</font> x <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">,</font> y<font color="#990000">,</font> nextmonth <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">,</font> friday<font color="#990000">,</font> monthsout<font color="#990000">,</font> temp<font color="#990000">;</font>
    <font color="#009900">int</font> counter1<font color="#990000">,</font> counter2<font color="#990000">,</font> day<font color="#990000">,</font> overflow<font color="#990000">,</font> year<font color="#990000">;</font>
    <font color="#009900">int</font> <font color="#990000">*</font>timetoexpire<font color="#990000">,</font> <font color="#990000">*</font>dates<font color="#990000">,</font> <font color="#990000">*</font>emonths<font color="#990000">,</font> <font color="#990000">*</font>exyear<font color="#990000">;</font>
    <font color="#009900">int</font> retvalue<font color="#990000">;</font>

    <font color="#008080">time_t</font> mytime<font color="#990000">;</font>
    <b><font color="#0000FF">struct</font></b> <font color="#008080">tm</font> <font color="#990000">*</font>my_tm<font color="#990000">;</font>

    <b><font color="#000000">time</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>
    my_tm <font color="#990000">=</font> <b><font color="#000000">localtime</font></b><font color="#990000">(&amp;</font>mytime<font color="#990000">);</font>

    <b><font color="#0000FF">if</font></b><font color="#990000">(</font> my_tm<font color="#990000">-&gt;</font>tm_wday <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">)</font>
    <font color="#FF0000">{</font>
        x <font color="#990000">=</font> <font color="#993399">7</font><font color="#990000">;</font>
    <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
    <font color="#FF0000">{</font>
        x <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_wday<font color="#990000">;</font>
    <font color="#FF0000">}</font>

    <b><font color="#0000FF">if</font></b><font color="#990000">(</font> monthsahead <font color="#990000">)</font>
    <font color="#FF0000">{</font>
        monthsout <font color="#990000">=</font> monthsahead<font color="#990000">;</font>
        retvalue <font color="#990000">=</font> monthsahead<font color="#990000">;</font>
    <font color="#FF0000">}</font>

    year <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_year<font color="#990000">;</font>

    <b><font color="#0000FF">if</font></b><font color="#990000">(*</font>tte<font color="#990000">)</font>
        <b><font color="#000000">free</font></b><font color="#990000">(*</font>tte<font color="#990000">);</font>

    <b><font color="#0000FF">if</font></b><font color="#990000">(*</font>d<font color="#990000">)</font>
        <b><font color="#000000">free</font></b><font color="#990000">(*</font>d<font color="#990000">);</font>

    <b><font color="#0000FF">if</font></b><font color="#990000">(*</font>em<font color="#990000">)</font>
        <b><font color="#000000">free</font></b><font color="#990000">(*</font>em<font color="#990000">);</font>

    <b><font color="#0000FF">if</font></b><font color="#990000">(*</font>ey<font color="#990000">)</font>
        <b><font color="#000000">free</font></b><font color="#990000">(*</font>ey<font color="#990000">);</font>

    <font color="#990000">*</font>tte <font color="#990000">=</font> timetoexpire <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">int</font> <font color="#990000">*)</font> <b><font color="#000000">calloc</font></b><font color="#990000">(</font>monthsout<font color="#990000">+</font><font color="#993399">1</font><font color="#990000">,</font><b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font><font color="#009900">int</font> <font color="#990000">*));</font>
    <font color="#990000">*</font>d   <font color="#990000">=</font> dates <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">int</font> <font color="#990000">*)</font> <b><font color="#000000">calloc</font></b><font color="#990000">(</font>monthsout<font color="#990000">+</font><font color="#993399">1</font><font color="#990000">,</font><b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font><font color="#009900">int</font> <font color="#990000">*));</font>
    <font color="#990000">*</font>em  <font color="#990000">=</font> emonths <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">int</font> <font color="#990000">*)</font> <b><font color="#000000">calloc</font></b><font color="#990000">(</font>monthsout<font color="#990000">+</font><font color="#993399">1</font><font color="#990000">,</font><b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font><font color="#009900">int</font> <font color="#990000">*));</font>
    <font color="#990000">*</font>ey  <font color="#990000">=</font> exyear <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">int</font> <font color="#990000">*)</font> <b><font color="#000000">calloc</font></b><font color="#990000">(</font>monthsout<font color="#990000">+</font><font color="#993399">1</font><font color="#990000">,</font><b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font><font color="#009900">int</font> <font color="#990000">*));</font>

    monthsout <font color="#990000">+=</font> skip<font color="#990000">;</font>

    <i><font color="#9A1900">/* count back to the first of the month and keep</font></i>
<i><font color="#9A1900">       day names in sync */</font></i>
    counter1 <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_mday<font color="#990000">;</font>
    counter2 <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
    day <font color="#990000">=</font> x<font color="#990000">;</font>
    <b><font color="#0000FF">while</font></b><font color="#990000">(</font> counter1 <font color="#990000">!=</font> <font color="#993399">1</font> <font color="#990000">)</font>
    <font color="#FF0000">{</font>
        counter1<font color="#990000">--;</font>
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> day<font color="#990000">--</font> <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
            day <font color="#990000">=</font> <font color="#993399">7</font><font color="#990000">;</font>
    <font color="#FF0000">}</font>

    <i><font color="#9A1900">/* figure out if it is a leap year and adjust the month feb */</font></i>
    <b><font color="#0000FF">if</font></b><font color="#990000">(</font> <font color="#990000">((</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">4</font> <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">100</font> <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">)</font> <font color="#990000">||</font> <font color="#990000">(</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">400</font> <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">)</font>
        months<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">29</font><font color="#990000">;</font>
    <b><font color="#0000FF">else</font></b>
        months<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">28</font><font color="#990000">;</font>

    <i><font color="#9A1900">/* increment to the end of the month take option expiration</font></i>
<i><font color="#9A1900">       date only it is greater than current date  */</font></i>
    friday <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">;</font>

    <font color="#990000">*</font>timetoexpire <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>  <font color="#990000">*</font>dates <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>  <font color="#990000">*</font>emonths <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>  <font color="#990000">*</font>exyear <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

    <b><font color="#0000FF">while</font></b><font color="#990000">(</font> counter1 <font color="#990000">&lt;=</font> months<font color="#990000">[</font>my_tm<font color="#990000">-&gt;</font>tm_mon<font color="#990000">]</font> <font color="#990000">)</font>
    <font color="#FF0000">{</font>
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> day <font color="#990000">==</font> properties<font color="#990000">-&gt;</font>occurence_day <font color="#990000">)</font> <i><font color="#9A1900">/* this is a friday or user specified day */</font></i>
        <font color="#FF0000">{</font>        
            <i><font color="#9A1900">/* this is the 3rd firday of the month or user specified */</font></i>
            <b><font color="#0000FF">if</font></b><font color="#990000">(</font> friday<font color="#990000">++</font> <font color="#990000">==</font> properties<font color="#990000">-&gt;</font>occurence_in_month <font color="#990000">)</font>
            <font color="#FF0000">{</font>
                <b><font color="#0000FF">if</font></b><font color="#990000">(</font> counter1 <font color="#990000">&gt;=</font> my_tm<font color="#990000">-&gt;</font>tm_mday <font color="#990000">)</font>
                <font color="#FF0000">{</font>
                    <b><font color="#0000FF">if</font></b><font color="#990000">(</font> skip <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">&amp;&amp;</font> properties<font color="#990000">-&gt;</font>optionscycle <font color="#990000">!=</font> <font color="#993399">4</font> <font color="#990000">)</font>
                    <font color="#FF0000">{</font>
                        <font color="#990000">*</font>emonths <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_mon<font color="#990000">;</font>
                        emonths<font color="#990000">++;</font>
                        <font color="#990000">*</font>timetoexpire <font color="#990000">=</font> counter1<font color="#990000">-</font>my_tm<font color="#990000">-&gt;</font>tm_mday<font color="#990000">+</font>properties<font color="#990000">-&gt;</font>occurence_plus_offset<font color="#990000">;</font>
                        timetoexpire<font color="#990000">++;</font>
                        <font color="#990000">*</font>dates <font color="#990000">=</font> counter1<font color="#990000">+</font>properties<font color="#990000">-&gt;</font>occurence_plus_offset<font color="#990000">;</font>
                        dates<font color="#990000">++;</font>
                        <font color="#990000">*</font>exyear <font color="#990000">=</font> <font color="#990000">((</font>year<font color="#990000">&gt;=</font><font color="#993399">100</font><font color="#990000">)?(</font>year<font color="#990000">-</font><font color="#993399">100</font><font color="#990000">):</font>year<font color="#990000">);</font>
                        exyear<font color="#990000">++;</font>
                    <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
                    <font color="#FF0000">{</font>
                        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> properties<font color="#990000">-&gt;</font>optionscycle <font color="#990000">==</font> <font color="#993399">4</font> <font color="#990000">)</font>
                        <font color="#FF0000">{</font>

                            <b><font color="#0000FF">if</font></b><font color="#990000">(</font> <font color="#990000">(</font> skip<font color="#990000">&gt;</font><font color="#993399">0</font> <font color="#990000">)</font> <font color="#990000">&amp;&amp;</font>
                                nextmonth <font color="#990000">==</font> <font color="#993399">0</font> <i><font color="#9A1900">/*&amp;&amp; year&gt;=my_tm-&gt;tm_year+2*/</font></i><font color="#990000">)</font>
                            <font color="#FF0000">{</font>
                              <font color="#990000">--</font>skip<font color="#990000">;</font>

                            <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
                            <font color="#FF0000">{</font>
                              monthsout<font color="#990000">++;</font>
                            <font color="#FF0000">}</font>
                        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
                        <font color="#FF0000">{</font>
                          <b><font color="#0000FF">if</font></b><font color="#990000">(</font> skip <font color="#990000">&gt;</font> <font color="#993399">0</font> <font color="#990000">)</font>
                            <font color="#990000">--</font>skip<font color="#990000">;</font>
                        <font color="#FF0000">}</font>

                    <font color="#FF0000">}</font>
                    
                    monthsout<font color="#990000">--;</font>
                <font color="#FF0000">}</font>
            <font color="#FF0000">}</font>
        <font color="#FF0000">}</font>
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> day<font color="#990000">++</font> <font color="#990000">==</font> <font color="#993399">7</font> <font color="#990000">)</font>
            day <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">;</font>

        counter1<font color="#990000">++;</font>
    <font color="#FF0000">}</font>
    monthcounter<font color="#990000">++;</font>
    counter1 <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_mday<font color="#990000">;</font>
    counter2 <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
    day <font color="#990000">=</font> x<font color="#990000">;</font>

    <i><font color="#9A1900">/* increment to the end of the month */</font></i>
    <b><font color="#0000FF">while</font></b><font color="#990000">(</font> counter1<font color="#990000">++</font> <font color="#990000">&lt;</font> months<font color="#990000">[</font>my_tm<font color="#990000">-&gt;</font>tm_mon<font color="#990000">]</font> <font color="#990000">)</font>
    <font color="#FF0000">{</font>
        counter2<font color="#990000">++;</font>
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> day<font color="#990000">++</font> <font color="#990000">==</font> <font color="#993399">7</font> <font color="#990000">)</font>
            day <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">;</font>
    <font color="#FF0000">}</font>
    nextmonth <font color="#990000">=</font> my_tm<font color="#990000">-&gt;</font>tm_mon<font color="#990000">;</font>

    <b><font color="#0000FF">if</font></b><font color="#990000">(</font> day<font color="#990000">++</font> <font color="#990000">==</font> <font color="#993399">7</font> <font color="#990000">)</font>
        day <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">;</font>

    <font color="#990000">*</font>timetoexpire <font color="#990000">=</font> counter2 <font color="#990000">+</font> <font color="#993399">2</font><font color="#990000">;</font>
    
    <i><font color="#9A1900">/* overflow is the distance in days between expirations */</font></i>
    overflow <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

    <b><font color="#0000FF">while</font></b><font color="#990000">(</font> monthsout<font color="#990000">--</font> <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">)</font>
    <font color="#FF0000">{</font>
        monthcounter<font color="#990000">++;</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> nextmonth<font color="#990000">++</font> <font color="#990000">==</font> <font color="#993399">11</font> <font color="#990000">)</font> <i><font color="#9A1900">/* months 0-11 */</font></i>
        <font color="#FF0000">{</font>        
            nextmonth <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>        <i><font color="#9A1900">/* set to Jan */</font></i>
            year<font color="#990000">++;</font>
        <font color="#FF0000">}</font>

        <i><font color="#9A1900">/* figure out if it is a leap year and adjust the month feb */</font></i>
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> <font color="#990000">((</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">4</font> <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">100</font> <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">)</font> <font color="#990000">||</font> <font color="#990000">(</font>year<font color="#990000">+</font><font color="#993399">1900</font><font color="#990000">)%</font><font color="#993399">400</font> <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">)</font>
            months<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">29</font><font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b>
            months<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">28</font><font color="#990000">;</font>
        
        friday <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">;</font>        <i><font color="#9A1900">/* reset friday counter */</font></i>
        <b><font color="#0000FF">for</font></b><font color="#990000">(</font> y <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">;</font> y <font color="#990000">&lt;=</font> months<font color="#990000">[</font>nextmonth<font color="#990000">];</font> y<font color="#990000">++</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
            <b><font color="#0000FF">if</font></b><font color="#990000">(</font> day <font color="#990000">==</font> properties<font color="#990000">-&gt;</font>occurence_day <font color="#990000">)</font>        <i><font color="#9A1900">/* this is a friday or user specified day */</font></i>
            <font color="#FF0000">{</font>
                <i><font color="#9A1900">/* this is the 3rd firday of the month or user specified */</font></i>
                <b><font color="#0000FF">if</font></b><font color="#990000">(</font> friday<font color="#990000">++</font> <font color="#990000">==</font> properties<font color="#990000">-&gt;</font>occurence_in_month <font color="#990000">)</font>
                <font color="#FF0000">{</font>
                    <b><font color="#0000FF">if</font></b><font color="#990000">(</font> <font color="#990000">(</font> skip <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">&amp;&amp;</font> properties<font color="#990000">-&gt;</font>optionscycle <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">)</font> <font color="#990000">||</font>

                        <i><font color="#9A1900">/*   0,   1,   2,   3,   4,   5,   6,    7,   8,   9,  10,  11 */</font></i>
                        <i><font color="#9A1900">/* Jan, Feb, Mar, Apr, May, Jun, Jul,  Aug, Sep, Oct, Nov, Dec */</font></i>

                        <i><font color="#9A1900">/* January cycle */</font></i>
                        <font color="#990000">(</font> skip <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">&amp;&amp;</font> properties<font color="#990000">-&gt;</font>optionscycle <font color="#990000">==</font> <font color="#993399">1</font>       <font color="#990000">&amp;&amp;</font>
                            <i><font color="#9A1900">/*       Jan             Apr */</font></i>  
                         <font color="#990000">(</font> <font color="#990000">(</font> nextmonth <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">||</font> nextmonth <font color="#990000">==</font> <font color="#993399">3</font>       <font color="#990000">||</font>
                            <i><font color="#9A1900">/*       Jul             Oct */</font></i>
                            nextmonth <font color="#990000">==</font> <font color="#993399">6</font> <font color="#990000">||</font> nextmonth <font color="#990000">==</font> <font color="#993399">9</font>       <font color="#990000">||</font>
                            <font color="#990000">(</font> my_tm<font color="#990000">-&gt;</font>tm_mon<font color="#990000">+</font><font color="#993399">1</font> <font color="#990000">==</font> nextmonth <font color="#990000">&amp;&amp;</font> year <font color="#990000">==</font> my_tm<font color="#990000">-&gt;</font>tm_year<font color="#990000">)</font>
                           <font color="#990000">)</font> 
                           <font color="#990000">)</font>
                        <font color="#990000">)</font> <font color="#990000">||</font>

                        <i><font color="#9A1900">/* Febuary cycle */</font></i>
                        <font color="#990000">(</font> skip <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">&amp;&amp;</font> properties<font color="#990000">-&gt;</font>optionscycle <font color="#990000">==</font> <font color="#993399">2</font>       <font color="#990000">&amp;&amp;</font>
                            <i><font color="#9A1900">/*       Feb             May */</font></i>   
                         <font color="#990000">(</font> <font color="#990000">(</font> nextmonth <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">||</font> nextmonth <font color="#990000">==</font> <font color="#993399">4</font>      <font color="#990000">||</font>
                            <i><font color="#9A1900">/*       Aug             Nov */</font></i>
                            nextmonth <font color="#990000">==</font> <font color="#993399">7</font> <font color="#990000">||</font> nextmonth <font color="#990000">==</font> <font color="#993399">10</font>     <font color="#990000">||</font>
                                <font color="#990000">(</font> my_tm<font color="#990000">-&gt;</font>tm_mon<font color="#990000">+</font><font color="#993399">1</font> <font color="#990000">==</font> nextmonth <font color="#990000">&amp;&amp;</font> year <font color="#990000">==</font> my_tm<font color="#990000">-&gt;</font>tm_year<font color="#990000">)</font>
                           <font color="#990000">)</font> 
                         <font color="#990000">)</font>
                        <font color="#990000">)</font> <font color="#990000">||</font>

                        <i><font color="#9A1900">/* March cycle */</font></i>
                        <font color="#990000">(</font> skip <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">&amp;&amp;</font> properties<font color="#990000">-&gt;</font>optionscycle <font color="#990000">==</font> <font color="#993399">3</font>       <font color="#990000">&amp;&amp;</font>
                            <i><font color="#9A1900">/*       Mar             Jun */</font></i>
                         <font color="#990000">(</font> <font color="#990000">(</font> nextmonth <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">||</font> nextmonth <font color="#990000">==</font> <font color="#993399">5</font>      <font color="#990000">||</font>
                            <i><font color="#9A1900">/*       Sep             Dec */</font></i>
                            nextmonth <font color="#990000">==</font> <font color="#993399">8</font> <font color="#990000">||</font> nextmonth <font color="#990000">==</font> <font color="#993399">11</font>     <font color="#990000">||</font>
                                  <font color="#990000">(</font> my_tm<font color="#990000">-&gt;</font>tm_mon<font color="#990000">+</font><font color="#993399">1</font> <font color="#990000">==</font> nextmonth <font color="#990000">&amp;&amp;</font> year <font color="#990000">==</font> my_tm<font color="#990000">-&gt;</font>tm_year<font color="#990000">)</font>
                           <font color="#990000">)</font> 
                         <font color="#990000">)</font>
                        <font color="#990000">)</font> <font color="#990000">||</font>

                        <i><font color="#9A1900">/* LEAPS */</font></i>
                        <font color="#990000">(</font> skip <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">&amp;&amp;</font> properties<font color="#990000">-&gt;</font>optionscycle <font color="#990000">==</font> <font color="#993399">4</font>       <font color="#990000">&amp;&amp;</font>
                         nextmonth <font color="#990000">==</font> <font color="#993399">0</font> <i><font color="#9A1900">/*&amp;&amp; year&gt;=my_tm-&gt;tm_year+2*/</font></i><font color="#990000">)</font>
                     <font color="#990000">)</font>
                    <font color="#FF0000">{</font>
                        <font color="#990000">*</font>exyear <font color="#990000">=</font> <font color="#990000">((</font>year<font color="#990000">&gt;=</font><font color="#993399">100</font><font color="#990000">)?(</font>year<font color="#990000">-</font><font color="#993399">100</font><font color="#990000">):</font>year<font color="#990000">);</font>
                        exyear<font color="#990000">++;</font>

                        <font color="#990000">*</font>emonths <font color="#990000">=</font> nextmonth<font color="#990000">;</font>
                        emonths<font color="#990000">++;</font>
                    
                        <font color="#990000">*</font>timetoexpire <font color="#990000">=*</font> timetoexpire<font color="#990000">+</font>y<font color="#990000">+</font>overflow<font color="#990000">-</font><font color="#993399">2</font><font color="#990000">+</font>properties<font color="#990000">-&gt;</font>occurence_plus_offset<font color="#990000">;</font>

                        temp <font color="#990000">=*</font> timetoexpire<font color="#990000">;</font>
                        timetoexpire<font color="#990000">++;</font>
                        <font color="#990000">*</font>timetoexpire <font color="#990000">=</font> temp<font color="#990000">;</font>
                        <font color="#990000">*</font>timetoexpire <font color="#990000">=*</font> timetoexpire<font color="#990000">+</font><font color="#993399">1</font><font color="#990000">-</font>properties<font color="#990000">-&gt;</font>occurence_plus_offset<font color="#990000">;</font>

                        overflow <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

                        <font color="#990000">*</font>dates <font color="#990000">=</font> y <font color="#990000">+</font> properties<font color="#990000">-&gt;</font>occurence_plus_offset<font color="#990000">;</font>
                        dates<font color="#990000">++;</font>
                    <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
                    <font color="#FF0000">{</font>
                        <font color="#990000">*</font>timetoexpire <font color="#990000">=*</font> timetoexpire<font color="#990000">+</font>y<font color="#990000">+</font>overflow<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
                        overflow <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

                        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> properties<font color="#990000">-&gt;</font>optionscycle <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
                        <font color="#FF0000">{</font>
                            <b><font color="#0000FF">if</font></b><font color="#990000">(</font> <font color="#990000">(</font> skip <font color="#990000">&gt;</font> <font color="#993399">0</font> <font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <i><font color="#9A1900">/* Jan, Apr, Jul, Oct */</font></i>
                                <font color="#990000">(</font> nextmonth <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">||</font> nextmonth <font color="#990000">==</font> <font color="#993399">3</font> <font color="#990000">||</font>
                                nextmonth <font color="#990000">==</font> <font color="#993399">6</font> <font color="#990000">||</font> nextmonth <font color="#990000">==</font> <font color="#993399">9</font> <font color="#990000">||</font>
                                <font color="#990000">(</font> my_tm<font color="#990000">-&gt;</font>tm_mon<font color="#990000">+</font><font color="#993399">1</font> <font color="#990000">==</font> nextmonth <font color="#990000">&amp;&amp;</font> year <font color="#990000">==</font> my_tm<font color="#990000">-&gt;</font>tm_year<font color="#990000">)</font> <font color="#990000">)</font>
                              <font color="#990000">)</font>
                            <font color="#FF0000">{</font>
                                <font color="#990000">--</font>skip<font color="#990000">;</font>

                            <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
                            <font color="#FF0000">{</font>
                                monthsout<font color="#990000">++;</font>
                            <font color="#FF0000">}</font>
                        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> properties<font color="#990000">-&gt;</font>optionscycle <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">)</font>
                        <font color="#FF0000">{</font>
                            <b><font color="#0000FF">if</font></b><font color="#990000">(</font> <font color="#990000">(</font> skip<font color="#990000">&gt;</font><font color="#993399">0</font> <font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <i><font color="#9A1900">/* Feb, May, Aug, Nov */</font></i>
                                 <font color="#990000">(</font> nextmonth <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">||</font> nextmonth <font color="#990000">==</font> <font color="#993399">4</font>      <font color="#990000">||</font>
                                 nextmonth <font color="#990000">==</font> <font color="#993399">7</font> <font color="#990000">||</font> nextmonth <font color="#990000">==</font> <font color="#993399">10</font>     <font color="#990000">||</font>
                                 <font color="#990000">(</font> my_tm<font color="#990000">-&gt;</font>tm_mon<font color="#990000">+</font><font color="#993399">1</font> <font color="#990000">==</font> nextmonth <font color="#990000">&amp;&amp;</font> year <font color="#990000">==</font> my_tm<font color="#990000">-&gt;</font>tm_year<font color="#990000">)</font> <font color="#990000">)</font>
                              <font color="#990000">)</font>
                            <font color="#FF0000">{</font>
                              <font color="#990000">--</font>skip<font color="#990000">;</font>

                            <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
                            <font color="#FF0000">{</font>
                              monthsout<font color="#990000">++;</font>
                            <font color="#FF0000">}</font>

                        <font color="#FF0000">}</font>  <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> properties<font color="#990000">-&gt;</font>optionscycle <font color="#990000">==</font> <font color="#993399">3</font> <font color="#990000">)</font>
                        <font color="#FF0000">{</font>
                            <b><font color="#0000FF">if</font></b><font color="#990000">(</font> <font color="#990000">(</font> skip<font color="#990000">&gt;</font><font color="#993399">0</font> <font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <i><font color="#9A1900">/* Mar, Jun, Sep, Dec */</font></i>
                                 <font color="#990000">(</font> nextmonth <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">||</font> nextmonth <font color="#990000">==</font> <font color="#993399">5</font>      <font color="#990000">||</font>
                                 nextmonth <font color="#990000">==</font> <font color="#993399">8</font> <font color="#990000">||</font> nextmonth <font color="#990000">==</font> <font color="#993399">11</font>     <font color="#990000">||</font>
                                 <font color="#990000">(</font> my_tm<font color="#990000">-&gt;</font>tm_mon<font color="#990000">+</font><font color="#993399">1</font> <font color="#990000">==</font> nextmonth <font color="#990000">&amp;&amp;</font> year <font color="#990000">==</font> my_tm<font color="#990000">-&gt;</font>tm_year<font color="#990000">)</font> <font color="#990000">)</font>
                              <font color="#990000">)</font>
                            <font color="#FF0000">{</font>
                              <font color="#990000">--</font>skip<font color="#990000">;</font>

                            <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
                            <font color="#FF0000">{</font>
                              monthsout<font color="#990000">++;</font>
                            <font color="#FF0000">}</font>

                        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> properties<font color="#990000">-&gt;</font>optionscycle <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">)</font>
                        <font color="#FF0000">{</font>
                            skip<font color="#990000">--;</font>

                        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> properties<font color="#990000">-&gt;</font>optionscycle <font color="#990000">==</font> <font color="#993399">4</font> <font color="#990000">)</font>
                        <font color="#FF0000">{</font>

                            <b><font color="#0000FF">if</font></b><font color="#990000">(</font> <font color="#990000">(</font> skip <font color="#990000">&gt;</font> <font color="#993399">0</font> <font color="#990000">)</font> <font color="#990000">&amp;&amp;</font>
                                nextmonth <font color="#990000">==</font> <font color="#993399">0</font> <i><font color="#9A1900">/*&amp;&amp; year&gt;=my_tm-&gt;tm_year+2*/</font></i><font color="#990000">)</font>
                            <font color="#FF0000">{</font>
                              <font color="#990000">--</font>skip<font color="#990000">;</font>

                            <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
                            <font color="#FF0000">{</font>
                              monthsout<font color="#990000">++;</font>
                            <font color="#FF0000">}</font>
                        <font color="#FF0000">}</font>
                    <font color="#FF0000">}</font>
                <font color="#FF0000">}</font>
            <font color="#FF0000">}</font>
            
            <b><font color="#0000FF">if</font></b><font color="#990000">(</font>day<font color="#990000">++</font> <font color="#990000">==</font> <font color="#993399">7</font><font color="#990000">)</font>
                day <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">;</font>
            
            <b><font color="#0000FF">if</font></b><font color="#990000">(</font> friday <font color="#990000">&gt;</font> properties<font color="#990000">-&gt;</font>occurence_in_month <font color="#990000">)</font>
                overflow<font color="#990000">++;</font>
        <font color="#FF0000">}</font>
    <font color="#FF0000">}</font>

    <font color="#990000">*</font>timetoexpire <font color="#990000">=</font> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
    <font color="#990000">*</font>dates <font color="#990000">=</font> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
    <font color="#990000">*</font>emonths <font color="#990000">=</font> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>        <i><font color="#9A1900">/* can't use NULL because *emonths=0 equals Jan */</font></i>
    <font color="#990000">*</font>exyear <font color="#990000">=</font> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>

    <b><font color="#0000FF">if</font></b><font color="#990000">(</font> leg <font color="#990000">==</font> LEG1 <font color="#990000">)</font>
    <font color="#FF0000">{</font>
      <i><font color="#9A1900">/* preserve the head of the lists */</font></i>
      properties<font color="#990000">-&gt;</font>start_time_to_expiration <font color="#990000">=</font> properties<font color="#990000">-&gt;</font>time_to_expiration<font color="#990000">;</font>
      properties<font color="#990000">-&gt;</font>start_days_to_expiration <font color="#990000">=</font> properties<font color="#990000">-&gt;</font>days_to_expiration<font color="#990000">;</font>
      properties<font color="#990000">-&gt;</font>start_expiration_month <font color="#990000">=</font> properties<font color="#990000">-&gt;</font>expiration_month<font color="#990000">;</font>
      properties<font color="#990000">-&gt;</font>start_expiration_year <font color="#990000">=</font> properties<font color="#990000">-&gt;</font>expiration_year<font color="#990000">;</font>

    <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> leg <font color="#990000">==</font> LEG2 <font color="#990000">)</font>
    <font color="#FF0000">{</font>
      <i><font color="#9A1900">/* preserve the head of the lists */</font></i>
      properties<font color="#990000">-&gt;</font>start_time_to_expiration2 <font color="#990000">=</font> properties<font color="#990000">-&gt;</font>time_to_expiration2<font color="#990000">;</font>
      properties<font color="#990000">-&gt;</font>start_days_to_expiration2 <font color="#990000">=</font> properties<font color="#990000">-&gt;</font>days_to_expiration2<font color="#990000">;</font>
      properties<font color="#990000">-&gt;</font>start_expiration_month2 <font color="#990000">=</font> properties<font color="#990000">-&gt;</font>expiration_month2<font color="#990000">;</font>
      properties<font color="#990000">-&gt;</font>start_expiration_year2 <font color="#990000">=</font> properties<font color="#990000">-&gt;</font>expiration_year2<font color="#990000">;</font>

    <font color="#FF0000">}</font>

    <b><font color="#0000FF">return</font></b> retvalue<font color="#990000">;</font>
<font color="#FF0000">}</font>
</tt></pre>
