<!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><i><font color="#9A1900">/* optionmatrix:                                                            */</font></i>
<i><font color="#9A1900">/*                                                                          */</font></i>
<i><font color="#9A1900">/* Options &amp; Futures Matrix Modeler                                         */</font></i>
<i><font color="#9A1900">/* View and Control Theoretical Option Chains                               */</font></i>
<i><font color="#9A1900">/*                                                                          */</font></i>
<i><font color="#9A1900">/* File: greeks.cpp of optionmatrix                                         */</font></i>
<i><font color="#9A1900">/*                                                                          */</font></i>
<i><font color="#9A1900">/* Copyright (c) Anthony Bradford. 2012.                                    */</font></i>
<i><font color="#9A1900">/* </font></i><u><font color="#0000FF">http://anthonybradford.com</font></u><i><font color="#9A1900">                                               */</font></i>
<i><font color="#9A1900">/* </font></i><u><font color="#0000FF">info@anthonybradford.com</font></u><i><font color="#9A1900">                                                 */</font></i>
<i><font color="#9A1900">/*                                                                          */</font></i>
<i><font color="#9A1900">/* optionmatrix may be freely redistributed.                                */</font></i>
<i><font color="#9A1900">/* See file COPYING included with this distribution for license information */</font></i>

<i><font color="#9A1900">/* </font></i>
<i><font color="#9A1900">   optionmatrix program is free software; you can redistribute it and/or modify</font></i>
<i><font color="#9A1900">   it under the terms of the GNU General Public License as published by</font></i>
<i><font color="#9A1900">   the Free Software Foundation; either version 3 of the License, or</font></i>
<i><font color="#9A1900">   (at your option) any later version.</font></i>

<i><font color="#9A1900">   optionmatrix program is distributed in the hope that it will be useful,</font></i>
<i><font color="#9A1900">   but WITHOUT ANY WARRANTY; without even the implied warranty of</font></i>
<i><font color="#9A1900">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</font></i>
<i><font color="#9A1900">   GNU General Public License for more details.</font></i>

<i><font color="#9A1900">   You should have received a copy of the GNU General Public License</font></i>
<i><font color="#9A1900">   along with this program.  If not, see </font></i><u><font color="#0000FF">&lt;http://www.gnu.org/licenses/&gt;</font></u><i><font color="#9A1900">.</font></i>
<i><font color="#9A1900">*/</font></i>

<b><font color="#000080">#include</font></b> <font color="#FF0000">"defs.h"</font>
<b><font color="#000080">#include</font></b> <font color="#FF0000">"extern.h"</font>
<b><font color="#000080">#include</font></b> <font color="#FF0000">"prototypes.h"</font>

<b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <b><font color="#000000">option_call_delta</font></b><font color="#990000">(</font><b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <font color="#990000">*</font>dat<font color="#990000">)</font>
<font color="#FF0000">{</font>
  <font color="#009900">double</font> calldelta<font color="#990000">;</font>

  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> price <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>price<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> strike <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>strike<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> rate <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>rate<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> t <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>t<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]-</font>dat<font color="#990000">-&gt;</font>te<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> volatility <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>volatility<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> dividend <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>dividend<font color="#990000">;</font>

  <b><font color="#0000FF">switch</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>modeltype<font color="#990000">)</font>
  <font color="#FF0000">{</font>

<b><font color="#000080">#ifdef</font></b> ABRADFORD

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> MERTON73<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BLACK76<font color="#990000">:</font>

       calldelta <font color="#990000">=</font> <b><font color="#000000">call_delta</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>t<font color="#990000">,</font>volatility<font color="#990000">,</font>dividend<font color="#990000">);</font>

       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#if</font></b> <b><font color="#000000">defined</font></b><font color="#990000">(</font>ABRADFORD<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <b><font color="#000000">defined</font></b><font color="#990000">(</font>METAOPTIONS<font color="#990000">)</font>

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES2<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> MERTON73B<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BLACK76B<font color="#990000">:</font>

       calldelta <font color="#990000">=</font> <b><font color="#000000">call_delta</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>t<font color="#990000">,</font>volatility<font color="#990000">,</font>dividend<font color="#990000">);</font>

       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> METAOPTIONS

    <b><font color="#0000FF">case</font></b> GBS<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> GFRENCH<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> GCARRY<font color="#990000">:</font>

      calldelta <font color="#990000">=</font> <b><font color="#000000">delta</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> FINRECIPES

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES3<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> FUTOPTEURBLACK<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BSPAYOUT<font color="#990000">:</font>

      calldelta <font color="#990000">=</font> <b><font color="#000000">option_price_delta_call_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERBINOMIAL<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> AMERBINOMIALDIV<font color="#990000">:</font>

      calldelta <font color="#990000">=</font> <b><font color="#000000">option_price_delta_american_call_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EUROSIM<font color="#990000">:</font>

      calldelta  <font color="#990000">=</font> <b><font color="#000000">option_price_delta_call_european_simulated</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMBINOMIAL<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#009900">double</font> <font color="#990000">(*</font>fun<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;,</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;);</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_call<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_cash_or_nothing_call<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">3</font><font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_asset_or_nothing_call<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">4</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_binary_call<font color="#990000">;</font>

        calldelta <font color="#990000">=</font>  <b><font color="#000000">option_price_delta_generic_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>fun<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#008080">  default:</font></b>

    calldelta  <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

    <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
  <font color="#FF0000">}</font>

  dat<font color="#990000">-&gt;</font>calldelta <font color="#990000">=</font> calldelta<font color="#990000">;</font>

  <b><font color="#0000FF">return</font></b> <font color="#990000">*</font>dat<font color="#990000">;</font>
<font color="#FF0000">}</font>

<b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <b><font color="#000000">option_put_delta</font></b><font color="#990000">(</font><b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <font color="#990000">*</font>dat<font color="#990000">)</font>
<font color="#FF0000">{</font>
  <font color="#009900">double</font> putdelta<font color="#990000">;</font>

  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> price <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>price<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> strike <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>strike<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> rate <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>rate<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> t <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>t<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]-</font>dat<font color="#990000">-&gt;</font>te<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> volatility <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>volatility<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> dividend <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>dividend<font color="#990000">;</font>

  <b><font color="#0000FF">switch</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>modeltype<font color="#990000">)</font>
  <font color="#FF0000">{</font>

<b><font color="#000080">#ifdef</font></b> ABRADFORD

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> MERTON73<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BLACK76<font color="#990000">:</font>

       putdelta <font color="#990000">=</font> <b><font color="#000000">put_delta</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>t<font color="#990000">,</font>volatility<font color="#990000">,</font>dividend<font color="#990000">);</font>

       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#if</font></b> <b><font color="#000000">defined</font></b><font color="#990000">(</font>ABRADFORD<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <b><font color="#000000">defined</font></b><font color="#990000">(</font>METAOPTIONS<font color="#990000">)</font>

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES2<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> MERTON73B<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BLACK76B<font color="#990000">:</font>

       putdelta <font color="#990000">=</font> <b><font color="#000000">put_delta</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>t<font color="#990000">,</font>volatility<font color="#990000">,</font>dividend<font color="#990000">);</font>

       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> METAOPTIONS

    <b><font color="#0000FF">case</font></b> GBS<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> GFRENCH<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> GCARRY<font color="#990000">:</font>

       putdelta <font color="#990000">=</font> <b><font color="#000000">delta</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> FINRECIPES

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES3<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> FUTOPTEURBLACK<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BSPAYOUT<font color="#990000">:</font>

       putdelta <font color="#990000">=</font> <b><font color="#000000">option_price_delta_put_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font>

       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERBINOMIAL<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> AMERBINOMIALDIV<font color="#990000">:</font>

       putdelta <font color="#990000">=</font> <b><font color="#000000">option_price_delta_american_put_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EUROSIM<font color="#990000">:</font>

       putdelta  <font color="#990000">=</font> <b><font color="#000000">option_price_delta_put_european_simulated</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMBINOMIAL<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#009900">double</font> <font color="#990000">(*</font>fun<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;,</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;);</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_put<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          putdelta <font color="#990000">=</font>  <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
        <font color="#FF0000">}</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">3</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          putdelta <font color="#990000">=</font>  <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
        <font color="#FF0000">}</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">4</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_binary_put<font color="#990000">;</font>

        putdelta <font color="#990000">=</font>  <b><font color="#000000">option_price_delta_generic_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>fun<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#008080">    default:</font></b>

      putdelta  <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
  <font color="#FF0000">}</font>

  dat<font color="#990000">-&gt;</font>putdelta <font color="#990000">=</font> putdelta<font color="#990000">;</font>

  <b><font color="#0000FF">return</font></b> <font color="#990000">*</font>dat<font color="#990000">;</font>
<font color="#FF0000">}</font>

<b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <b><font color="#000000">option_gamma</font></b><font color="#990000">(</font><b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <font color="#990000">*</font>dat<font color="#990000">)</font>
<font color="#FF0000">{</font>
  <font color="#009900">double</font> gamma_<font color="#990000">;</font>

  <font color="#009900">double</font> price <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>price<font color="#990000">;</font>
  <font color="#009900">double</font> strike <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>strike<font color="#990000">;</font>
  <font color="#009900">double</font> rate <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>rate<font color="#990000">;</font>
  <font color="#009900">double</font> t <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>t<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]-</font>dat<font color="#990000">-&gt;</font>te<font color="#990000">;</font>
  <font color="#009900">double</font> volatility <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>volatility<font color="#990000">;</font>
  <font color="#009900">double</font> dividend <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>dividend<font color="#990000">;</font>
  <font color="#009900">double</font> dummydelta<font color="#990000">,</font>dummytheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>dummyrho<font color="#990000">;</font>

  <b><font color="#0000FF">switch</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>modeltype<font color="#990000">)</font>
  <font color="#FF0000">{</font>

<b><font color="#000080">#if</font></b> <b><font color="#000000">defined</font></b><font color="#990000">(</font>ABRADFORD<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <b><font color="#000000">defined</font></b><font color="#990000">(</font>FINRECIPES<font color="#990000">)</font>

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> MERTON73<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BLACK76<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_call_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dummydelta<font color="#990000">,</font>gamma_<font color="#990000">,</font>dummytheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>dummyrho<font color="#990000">);</font>
       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> METAOPTIONS

    <b><font color="#0000FF">case</font></b> GBS<font color="#990000">:</font>

       gamma_ <font color="#990000">=</font> <b><font color="#000000">Gamma</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>
      
       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#if</font></b> <b><font color="#000000">defined</font></b><font color="#990000">(</font>METAOPTIONS<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <b><font color="#000000">defined</font></b><font color="#990000">(</font>FINRECIPES<font color="#990000">)</font>

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES2<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> MERTON73B<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BLACK76B<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_call_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dummydelta<font color="#990000">,</font>gamma_<font color="#990000">,</font>dummytheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>dummyrho<font color="#990000">);</font>
       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> FINRECIPES

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES3<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> FUTOPTEURBLACK<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BSPAYOUT<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_call_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dummydelta<font color="#990000">,</font>gamma_<font color="#990000">,</font>dummytheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>dummyrho<font color="#990000">);</font>
       
       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERBINOMIAL<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> AMERBINOMIALDIV<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_american_call_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>dummydelta<font color="#990000">,</font>gamma_<font color="#990000">,</font>dummytheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>dummyrho<font color="#990000">);</font>

       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>
       
<b><font color="#008080">    default:</font></b>

      gamma_ <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
  <font color="#FF0000">}</font>

  dat<font color="#990000">-&gt;</font>gamma <font color="#990000">=</font> gamma_<font color="#990000">;</font>

  <b><font color="#0000FF">return</font></b> <font color="#990000">*</font>dat<font color="#990000">;</font>
<font color="#FF0000">}</font>

<b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <b><font color="#000000">option_vega</font></b><font color="#990000">(</font><b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <font color="#990000">*</font>dat<font color="#990000">)</font>
<font color="#FF0000">{</font>
  <font color="#009900">double</font> vega_<font color="#990000">;</font>

  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> price <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>price<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> strike <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>strike<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> rate <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>rate<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> t <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>t<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]-</font>dat<font color="#990000">-&gt;</font>te<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> volatility <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>volatility<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> dividend <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>dividend<font color="#990000">;</font>
  <font color="#009900">double</font> dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>dummytheta<font color="#990000">,</font>dummyrho<font color="#990000">;</font>

  <b><font color="#0000FF">switch</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>modeltype<font color="#990000">)</font>
  <font color="#FF0000">{</font>

<b><font color="#000080">#if</font></b> <b><font color="#000000">defined</font></b><font color="#990000">(</font>ABRADFORD<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <b><font color="#000000">defined</font></b><font color="#990000">(</font>FINRECIPES<font color="#990000">)</font>

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> MERTON73<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BLACK76<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_call_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>dummytheta<font color="#990000">,</font>vega_<font color="#990000">,</font>dummyrho<font color="#990000">);</font>
       
       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#if</font></b> <b><font color="#000000">defined</font></b><font color="#990000">(</font>METAOPTIONS<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <b><font color="#000000">defined</font></b><font color="#990000">(</font>FINRECIPES<font color="#990000">)</font>

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES2<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> MERTON73B<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BLACK76B<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_call_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>dummytheta<font color="#990000">,</font>vega_<font color="#990000">,</font>dummyrho<font color="#990000">);</font>
       
       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> METAOPTIONS

    <b><font color="#0000FF">case</font></b> GBS<font color="#990000">:</font>

      vega_ <font color="#990000">=</font> <b><font color="#000000">vega</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> FINRECIPES

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES3<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> FUTOPTEURBLACK<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BSPAYOUT<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_call_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>dummytheta<font color="#990000">,</font>vega_<font color="#990000">,</font>dummyrho<font color="#990000">);</font>
       
       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERBINOMIAL<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> AMERBINOMIALDIV<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_american_call_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>dummytheta<font color="#990000">,</font>vega_<font color="#990000">,</font>dummyrho<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#008080">    default:</font></b>

      vega_ <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
  <font color="#FF0000">}</font>

  dat<font color="#990000">-&gt;</font>vega <font color="#990000">=</font> vega_<font color="#990000">;</font>

  <b><font color="#0000FF">return</font></b> <font color="#990000">*</font>dat<font color="#990000">;</font>
<font color="#FF0000">}</font>

<b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <b><font color="#000000">option_call_theta</font></b><font color="#990000">(</font><b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <font color="#990000">*</font>dat<font color="#990000">)</font>
<font color="#FF0000">{</font>
  <font color="#009900">double</font> calltheta<font color="#990000">;</font>

  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> price <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>price<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> strike <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>strike<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> rate <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>rate<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> t <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>t<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]-</font>dat<font color="#990000">-&gt;</font>te<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> volatility <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>volatility<font color="#990000">;</font>
  <font color="#009900">double</font> dividend <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>dividend<font color="#990000">;</font>
  <font color="#009900">double</font> dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>dummyvega<font color="#990000">,</font>dummyrho<font color="#990000">;</font>

  <b><font color="#0000FF">switch</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>modeltype<font color="#990000">)</font>
  <font color="#FF0000">{</font>

<b><font color="#000080">#if</font></b> <b><font color="#000000">defined</font></b><font color="#990000">(</font>ABRADFORD<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <b><font color="#000000">defined</font></b><font color="#990000">(</font>FINRECIPES<font color="#990000">)</font>

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> MERTON73<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BLACK76<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_call_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>calltheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>dummyrho<font color="#990000">);</font>
       
       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#if</font></b> <b><font color="#000000">defined</font></b><font color="#990000">(</font>METAOPTIONS<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <b><font color="#000000">defined</font></b><font color="#990000">(</font>FINRECIPES<font color="#990000">)</font>

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES2<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> MERTON73B<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BLACK76B<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_call_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>calltheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>dummyrho<font color="#990000">);</font>
       
       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> METAOPTIONS

    <b><font color="#0000FF">case</font></b> GBS<font color="#990000">:</font>

       calltheta <font color="#990000">=</font> <b><font color="#000000">theta</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> FINRECIPES

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES3<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> FUTOPTEURBLACK<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BSPAYOUT<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_call_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>calltheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>dummyrho<font color="#990000">);</font>
       
       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERBINOMIAL<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> AMERBINOMIALDIV<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_american_call_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>calltheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>dummyrho<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#008080">    default:</font></b>

      calltheta <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
  <font color="#FF0000">}</font>

  dat<font color="#990000">-&gt;</font>calltheta <font color="#990000">=</font> calltheta<font color="#990000">;</font>

  <b><font color="#0000FF">return</font></b> <font color="#990000">*</font>dat<font color="#990000">;</font>
<font color="#FF0000">}</font>

<b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <b><font color="#000000">option_put_theta</font></b><font color="#990000">(</font><b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <font color="#990000">*</font>dat<font color="#990000">)</font>
<font color="#FF0000">{</font>
  <font color="#009900">double</font> puttheta<font color="#990000">;</font>

  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> price <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>price<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> strike <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>strike<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> rate <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>rate<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> t <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>t<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]-</font>dat<font color="#990000">-&gt;</font>te<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> volatility <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>volatility<font color="#990000">;</font>
  <font color="#009900">double</font> dividend <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>dividend<font color="#990000">;</font>
  <font color="#009900">double</font> dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>dummyvega<font color="#990000">,</font>dummyrho<font color="#990000">;</font>

  <b><font color="#0000FF">switch</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>modeltype<font color="#990000">)</font>
  <font color="#FF0000">{</font>

<b><font color="#000080">#if</font></b> <b><font color="#000000">defined</font></b><font color="#990000">(</font>ABRADFORD<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <b><font color="#000000">defined</font></b><font color="#990000">(</font>FINRECIPES<font color="#990000">)</font>

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> MERTON73<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BLACK76<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_put_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>puttheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>dummyrho<font color="#990000">);</font>
       
       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#if</font></b> <b><font color="#000000">defined</font></b><font color="#990000">(</font>METAOPTIONS<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <b><font color="#000000">defined</font></b><font color="#990000">(</font>FINRECIPES<font color="#990000">)</font>

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES2<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> MERTON73B<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BLACK76B<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_put_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>puttheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>dummyrho<font color="#990000">);</font>
       
       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> METAOPTIONS

    <b><font color="#0000FF">case</font></b> GBS<font color="#990000">:</font>

       puttheta <font color="#990000">=</font> <b><font color="#000000">theta</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> FINRECIPES

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES3<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> FUTOPTEURBLACK<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BSPAYOUT<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_put_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>puttheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>dummyrho<font color="#990000">);</font>
       
       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERBINOMIAL<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> AMERBINOMIALDIV<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_american_put_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>puttheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>dummyrho<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#008080">    default:</font></b>

      puttheta <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
  <font color="#FF0000">}</font>

  dat<font color="#990000">-&gt;</font>puttheta <font color="#990000">=</font> puttheta<font color="#990000">;</font>

  <b><font color="#0000FF">return</font></b> <font color="#990000">*</font>dat<font color="#990000">;</font>
<font color="#FF0000">}</font>

<b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <b><font color="#000000">option_call_rho</font></b><font color="#990000">(</font><b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <font color="#990000">*</font>dat<font color="#990000">)</font>
<font color="#FF0000">{</font>
  <font color="#009900">double</font> callrho<font color="#990000">;</font>

  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> price <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>price<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> strike <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>strike<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> rate <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>rate<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> t <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>t<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]-</font>dat<font color="#990000">-&gt;</font>te<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> volatility <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>volatility<font color="#990000">;</font>
  <font color="#009900">double</font> dividend <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>dividend<font color="#990000">;</font>
  <font color="#009900">double</font> dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>dummytheta<font color="#990000">,</font>dummyvega<font color="#990000">;</font>

  <b><font color="#0000FF">switch</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>modeltype<font color="#990000">)</font>
  <font color="#FF0000">{</font>

<b><font color="#000080">#if</font></b> <b><font color="#000000">defined</font></b><font color="#990000">(</font>ABRADFORD<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <b><font color="#000000">defined</font></b><font color="#990000">(</font>FINRECIPES<font color="#990000">)</font>

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> MERTON73<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BLACK76<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_call_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>dummytheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>callrho<font color="#990000">);</font>
       
       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#if</font></b> <b><font color="#000000">defined</font></b><font color="#990000">(</font>METAOPTIONS<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <b><font color="#000000">defined</font></b><font color="#990000">(</font>FINRECIPES<font color="#990000">)</font>

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES2<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> MERTON73B<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BLACK76B<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_call_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>dummytheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>callrho<font color="#990000">);</font>
       
       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> METAOPTIONS

    <b><font color="#0000FF">case</font></b> GBS<font color="#990000">:</font>

       callrho <font color="#990000">=</font> <b><font color="#000000">rho</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> FINRECIPES

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES3<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> FUTOPTEURBLACK<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BSPAYOUT<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_call_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>dummytheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>callrho<font color="#990000">);</font>
       
       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERBINOMIAL<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> AMERBINOMIALDIV<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_american_call_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>dummytheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>callrho<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#008080">     default:</font></b>

      callrho <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
  <font color="#FF0000">}</font>

  dat<font color="#990000">-&gt;</font>callrho <font color="#990000">=</font> callrho<font color="#990000">;</font>

  <b><font color="#0000FF">return</font></b> <font color="#990000">*</font>dat<font color="#990000">;</font>
<font color="#FF0000">}</font>

<b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <b><font color="#000000">option_put_rho</font></b><font color="#990000">(</font><b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <font color="#990000">*</font>dat<font color="#990000">)</font>
<font color="#FF0000">{</font>
  <font color="#009900">double</font> putrho<font color="#990000">;</font>

  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> price <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>price<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> strike <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>strike<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> rate <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>rate<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> t <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>t<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]-</font>dat<font color="#990000">-&gt;</font>te<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> volatility <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>volatility<font color="#990000">;</font>
  <font color="#009900">double</font> dividend <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>dividend<font color="#990000">;</font>
  <font color="#009900">double</font> dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>dummytheta<font color="#990000">,</font>dummyvega<font color="#990000">;</font>

  <b><font color="#0000FF">switch</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>modeltype<font color="#990000">)</font>
  <font color="#FF0000">{</font>

<b><font color="#000080">#if</font></b> <b><font color="#000000">defined</font></b><font color="#990000">(</font>ABRADFORD<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <b><font color="#000000">defined</font></b><font color="#990000">(</font>FINRECIPES<font color="#990000">)</font>

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> MERTON73<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BLACK76<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_put_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>dummytheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>putrho<font color="#990000">);</font>
       
       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#if</font></b> <b><font color="#000000">defined</font></b><font color="#990000">(</font>METAOPTIONS<font color="#990000">)</font> <font color="#990000">&amp;&amp;</font> <b><font color="#000000">defined</font></b><font color="#990000">(</font>FINRECIPES<font color="#990000">)</font>

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES2<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> MERTON73B<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BLACK76B<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_put_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>dummytheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>putrho<font color="#990000">);</font>
       
       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> METAOPTIONS

    <b><font color="#0000FF">case</font></b> GBS<font color="#990000">:</font>

       putrho <font color="#990000">=</font> <b><font color="#000000">rho</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> FINRECIPES

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES3<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> FUTOPTEURBLACK<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> BSPAYOUT<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_put_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>dummytheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>putrho<font color="#990000">);</font>
       
       <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERBINOMIAL<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> AMERBINOMIALDIV<font color="#990000">:</font>

       <b><font color="#000000">option_price_partials_american_call_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>dummydelta<font color="#990000">,</font>dummygamma<font color="#990000">,</font>dummytheta<font color="#990000">,</font>dummyvega<font color="#990000">,</font>putrho<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#008080">    default:</font></b>

      putrho <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
  <font color="#FF0000">}</font>

  dat<font color="#990000">-&gt;</font>putrho <font color="#990000">=</font> putrho<font color="#990000">;</font>

  <b><font color="#0000FF">return</font></b> <font color="#990000">*</font>dat<font color="#990000">;</font>
<font color="#FF0000">}</font>
</tt></pre>
