<!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><i><font color="#9A1900">/* optionmatrix:                                                            */</font></i>
<i><font color="#9A1900">/*                                                                          */</font></i>
<i><font color="#9A1900">/* Options &amp; Futures Matrix Modeler                                         */</font></i>
<i><font color="#9A1900">/* View and Control Theoretical Option Chains                               */</font></i>
<i><font color="#9A1900">/*                                                                          */</font></i>
<i><font color="#9A1900">/* File: options_calls.cpp of optionmatrix                                  */</font></i>
<i><font color="#9A1900">/*                                                                          */</font></i>
<i><font color="#9A1900">/* Copyright (c) Anthony Bradford. 2012.                                    */</font></i>
<i><font color="#9A1900">/* </font></i><u><font color="#0000FF">http://anthonybradford.com</font></u><i><font color="#9A1900">                                               */</font></i>
<i><font color="#9A1900">/* </font></i><u><font color="#0000FF">info@anthonybradford.com</font></u><i><font color="#9A1900">                                                 */</font></i>
<i><font color="#9A1900">/*                                                                          */</font></i>
<i><font color="#9A1900">/* optionmatrix may be freely redistributed.                                */</font></i>
<i><font color="#9A1900">/* See file COPYING included with this distribution for license information */</font></i>

<i><font color="#9A1900">/* </font></i>
<i><font color="#9A1900">   optionmatrix program is free software; you can redistribute it and/or modify</font></i>
<i><font color="#9A1900">   it under the terms of the GNU General Public License as published by</font></i>
<i><font color="#9A1900">   the Free Software Foundation; either version 3 of the License, or</font></i>
<i><font color="#9A1900">   (at your option) any later version.</font></i>

<i><font color="#9A1900">   optionmatrix program is distributed in the hope that it will be useful,</font></i>
<i><font color="#9A1900">   but WITHOUT ANY WARRANTY; without even the implied warranty of</font></i>
<i><font color="#9A1900">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</font></i>
<i><font color="#9A1900">   GNU General Public License for more details.</font></i>

<i><font color="#9A1900">   You should have received a copy of the GNU General Public License</font></i>
<i><font color="#9A1900">   along with this program.  If not, see </font></i><u><font color="#0000FF">&lt;http://www.gnu.org/licenses/&gt;</font></u><i><font color="#9A1900">.</font></i>
<i><font color="#9A1900">*/</font></i>

<b><font color="#000080">#include</font></b> <font color="#FF0000">"defs.h"</font>
<b><font color="#000080">#include</font></b> <font color="#FF0000">"extern.h"</font>
<b><font color="#000080">#include</font></b> <font color="#FF0000">"prototypes.h"</font>

<b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <b><font color="#000000">option_call</font></b><font color="#990000">(</font><b><font color="#0000FF">struct</font></b> <font color="#008080">_data</font> <font color="#990000">*</font>dat<font color="#990000">)</font>
<font color="#FF0000">{</font>
  <font color="#009900">double</font> callprice<font color="#990000">;</font>

  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> price <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>price<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> strike <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>strike<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> rate <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>rate<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> t  <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>t<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]</font> <font color="#990000">-</font> dat<font color="#990000">-&gt;</font>te<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> t2 <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>t<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">-</font> dat<font color="#990000">-&gt;</font>te2<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> t3 <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>t<font color="#990000">[</font><font color="#993399">2</font><font color="#990000">]</font> <font color="#990000">-</font> dat<font color="#990000">-&gt;</font>te3<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> volatility <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>volatility<font color="#990000">;</font>
  <b><font color="#0000FF">const</font></b> <font color="#009900">double</font> dividend <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>dividend<font color="#990000">;</font>

  <font color="#009900">double</font> calldelta <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>  <i><font color="#9A1900">/* this is a dummy variable */</font></i>

  <i><font color="#9A1900">//g_print("t3 = %f\n", t3);</font></i>

  <b><font color="#0000FF">if</font></b><font color="#990000">(</font>t <font color="#990000">&lt;=</font> <font color="#993399">0.0</font><font color="#990000">)</font>
  <font color="#FF0000">{</font>
    dat<font color="#990000">-&gt;</font>call <font color="#990000">=</font> <font color="#993399">0.0</font><font color="#990000">;</font>

    <b><font color="#0000FF">return</font></b> <font color="#990000">*</font>dat<font color="#990000">;</font>
  <font color="#FF0000">}</font>

  <b><font color="#0000FF">try</font></b> <font color="#FF0000">{</font>

  <b><font color="#0000FF">switch</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>modeltype<font color="#990000">)</font>
  <font color="#FF0000">{</font>

<b><font color="#000080">#ifdef</font></b> ABRADFORD

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"black_scholes_call"</font><font color="#990000">,</font> <font color="#993399">5</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">black_scholes_call</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>t<font color="#990000">,</font>volatility<font color="#990000">,&amp;</font>calldelta<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> MERTON73<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"merton73_call"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,&amp;</font>calldelta<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">merton73_call</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>t<font color="#990000">,</font>volatility<font color="#990000">,</font>dividend<font color="#990000">,&amp;</font>calldelta<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BLACK76<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"black76call"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>
      
      callprice <font color="#990000">=</font> <b><font color="#000000">black76call</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>t<font color="#990000">,</font>volatility<font color="#990000">,&amp;</font>calldelta<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

  <b><font color="#0000FF">case</font></b> BACHELIER<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"bachelier_call"</font><font color="#990000">,</font> <font color="#993399">4</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">bachelier_call</font></b><font color="#990000">(</font>price<font color="#990000">,</font> strike<font color="#990000">,</font> t<font color="#990000">,</font> volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

  <b><font color="#0000FF">case</font></b> BACHELIERMODIFIED<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"bachelier_modified_call"</font><font color="#990000">,</font> <font color="#993399">5</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">bachelier_modified_call</font></b><font color="#990000">(</font>price<font color="#990000">,</font> strike<font color="#990000">,</font> rate<font color="#990000">,</font> t<font color="#990000">,</font> volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

  <b><font color="#0000FF">case</font></b> SPRENKLE<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"sprenkle_call"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">sprenkle_call</font></b><font color="#990000">(</font>price<font color="#990000">,</font> strike<font color="#990000">,</font> t<font color="#990000">,</font> volatility<font color="#990000">,</font> dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font> dat<font color="#990000">-&gt;</font>UseB<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

  <b><font color="#0000FF">case</font></b> BONESS<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"boness_call"</font><font color="#990000">,</font> <font color="#993399">5</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">boness_call</font></b><font color="#990000">(</font>price<font color="#990000">,</font> strike<font color="#990000">,</font> t<font color="#990000">,</font> volatility<font color="#990000">,</font> dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

  <b><font color="#0000FF">case</font></b> SAMUELSON<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"samuelson_call"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">samuelson_call</font></b><font color="#990000">(</font>price<font color="#990000">,</font> strike<font color="#990000">,</font> t<font color="#990000">,</font> volatility<font color="#990000">,</font> dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font> dat<font color="#990000">-&gt;</font>UseB<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> SPINSKY

    <b><font color="#0000FF">case</font></b> AMERICAN_CRR<font color="#990000">:</font>
      <font color="#FF0000">{</font>

        <font color="#008080">Ivar</font> data<font color="#990000">;</font>
        data<font color="#990000">.</font>S <font color="#990000">=</font> data<font color="#990000">.</font>X <font color="#990000">=</font> data<font color="#990000">.</font>T <font color="#990000">=</font> data<font color="#990000">.</font>sigma <font color="#990000">=</font> data<font color="#990000">.</font>mu <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

        data<font color="#990000">.</font>S <font color="#990000">=</font> price<font color="#990000">;</font>
        data<font color="#990000">.</font>X <font color="#990000">=</font> strike<font color="#990000">;</font>
        data<font color="#990000">.</font>T <font color="#990000">=</font> t<font color="#990000">;</font>
        data<font color="#990000">.</font>sigma <font color="#990000">=</font> volatility<font color="#990000">;</font>
        data<font color="#990000">.</font>mu <font color="#990000">=</font> rate<font color="#990000">;</font>

        callprice <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <b><font color="#000000">option_price</font></b><font color="#990000">(</font>data<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>AMERCALL<font color="#990000">,</font>CRR<font color="#990000">);</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERICAN_EQUIPROB<font color="#990000">:</font>
      <font color="#FF0000">{</font>

        <font color="#008080">Ivar</font> data<font color="#990000">;</font>
        data<font color="#990000">.</font>S <font color="#990000">=</font> data<font color="#990000">.</font>X <font color="#990000">=</font> data<font color="#990000">.</font>T <font color="#990000">=</font> data<font color="#990000">.</font>sigma <font color="#990000">=</font> data<font color="#990000">.</font>mu <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
        
        data<font color="#990000">.</font>S <font color="#990000">=</font> price<font color="#990000">;</font>
        data<font color="#990000">.</font>X <font color="#990000">=</font> strike<font color="#990000">;</font>
        data<font color="#990000">.</font>T <font color="#990000">=</font> t<font color="#990000">;</font>
        data<font color="#990000">.</font>sigma <font color="#990000">=</font> volatility<font color="#990000">;</font>
        data<font color="#990000">.</font>mu <font color="#990000">=</font> rate<font color="#990000">;</font>
        
        callprice <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <b><font color="#000000">option_price</font></b><font color="#990000">(</font>data<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>AMERCALL<font color="#990000">,</font>EQUIPROB<font color="#990000">);</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EURO_CRR<font color="#990000">:</font>
      <font color="#FF0000">{</font>

        <font color="#008080">Ivar</font> data<font color="#990000">;</font>
        data<font color="#990000">.</font>S <font color="#990000">=</font> data<font color="#990000">.</font>X <font color="#990000">=</font> data<font color="#990000">.</font>T <font color="#990000">=</font> data<font color="#990000">.</font>sigma <font color="#990000">=</font> data<font color="#990000">.</font>mu <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
        
        data<font color="#990000">.</font>S <font color="#990000">=</font> price<font color="#990000">;</font>
        data<font color="#990000">.</font>X <font color="#990000">=</font> strike<font color="#990000">;</font>
        data<font color="#990000">.</font>T <font color="#990000">=</font> t<font color="#990000">;</font>
        data<font color="#990000">.</font>sigma <font color="#990000">=</font> volatility<font color="#990000">;</font>
        data<font color="#990000">.</font>mu <font color="#990000">=</font> rate<font color="#990000">;</font>

        callprice <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <b><font color="#000000">option_price</font></b><font color="#990000">(</font>data<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>EUROCALL<font color="#990000">,</font>CRR<font color="#990000">);</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EURO_EQUIPROB<font color="#990000">:</font>
      <font color="#FF0000">{</font>

        <font color="#008080">Ivar</font> data<font color="#990000">;</font>
        data<font color="#990000">.</font>S <font color="#990000">=</font> data<font color="#990000">.</font>X <font color="#990000">=</font> data<font color="#990000">.</font>T <font color="#990000">=</font> data<font color="#990000">.</font>sigma <font color="#990000">=</font> data<font color="#990000">.</font>mu <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

        data<font color="#990000">.</font>S <font color="#990000">=</font> price<font color="#990000">;</font>
        data<font color="#990000">.</font>X <font color="#990000">=</font> strike<font color="#990000">;</font>
        data<font color="#990000">.</font>T <font color="#990000">=</font> t<font color="#990000">;</font>
        data<font color="#990000">.</font>sigma <font color="#990000">=</font> volatility<font color="#990000">;</font>
        data<font color="#990000">.</font>mu <font color="#990000">=</font> rate<font color="#990000">;</font>

        callprice <font color="#990000">=</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font> <b><font color="#000000">option_price</font></b><font color="#990000">(</font>data<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>EUROCALL<font color="#990000">,</font>EQUIPROB<font color="#990000">);</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> METAOPTIONS

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES2<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"blackscholes"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

       callprice <font color="#990000">=</font> <b><font color="#000000">blackscholes</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> GBS<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"gbs"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">gbs</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> MERTON73B<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"merton73"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">merton73</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> GFRENCH<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"french"</font><font color="#990000">,</font> <font color="#993399">8</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">french</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t2<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> GCARRY<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"carry"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">carry</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BAWAMERICAN<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"BAWAmericanApprox"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>
      
      callprice <font color="#990000">=</font> <b><font color="#000000">BAWAmericanApprox</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BSAMERICAN<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"BSAmericanApprox"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">BSAmericanApprox</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>
 
      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BLACK76B<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"black76"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">black76</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> ASSETORNOTHING<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"AssetOrNothing"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">AssetOrNothing</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> CASHORNOTHING<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"CashOrNothing"</font><font color="#990000">,</font> <font color="#993399">8</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">CashOrNothing</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EXTENDIBLEWRITER<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> t2 <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
          callprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"ExtendibleWriter"</font><font color="#990000">,</font> <font color="#993399">9</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">ExtendibleWriter</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>t2<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> CALLSONOPTIONS<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> t2 <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
          callprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"OptionsOnOptions"</font><font color="#990000">,</font> <font color="#993399">9</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>OOO_CALL_ON_CALL<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">OptionsOnOptions</font></b><font color="#990000">(</font>OOO_CALL_ON_CALL<font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>t2<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> PUTSONOPTIONS<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"OptionsOnOptions"</font><font color="#990000">,</font> <font color="#993399">9</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>OOO_PUT_ON_CALL<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">OptionsOnOptions</font></b><font color="#990000">(</font>OOO_PUT_ON_CALL<font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>t2<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> ROLLGESKEWHALEY<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"RollGeskeWhaley"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                price<font color="#990000">,</font>strike<font color="#990000">,(</font>t2<font color="#990000">&gt;</font>t<font color="#990000">?(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font><font color="#990000">:(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">),</font>t<font color="#990000">,</font>rate<font color="#990000">,(</font>t2<font color="#990000">&gt;</font>t<font color="#990000">?(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font><font color="#990000">:(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">),</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">RollGeskeWhaley</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> t2 <font color="#990000">),</font>t<font color="#990000">,</font>rate<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> dividend <font color="#990000">),</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EXTREMESPREADOPTION<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"ExtremeSpreadOption"</font><font color="#990000">,</font> <font color="#993399">9</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>transextremeoptioncall<font color="#990000">[</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">],(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font> <font color="#990000">:</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t2 <font color="#990000">),(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font> <font color="#990000">:</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dividend <font color="#990000">),(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>
      
      callprice <font color="#990000">=</font>  <b><font color="#000000">ExtremeSpreadOption</font></b><font color="#990000">(</font>transextremeoptioncall<font color="#990000">[</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">],</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> t2 <font color="#990000">),</font>t<font color="#990000">,</font>rate<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> dividend <font color="#990000">),</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EXTREMESPREADOPTION2<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"ExtremeSpreadOption"</font><font color="#990000">,</font> <font color="#993399">9</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>transextremeoptioncall<font color="#990000">[</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">],(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font> <font color="#990000">:</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t2 <font color="#990000">),(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font> <font color="#990000">:</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dividend <font color="#990000">),(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font>  <b><font color="#000000">ExtremeSpreadOption</font></b><font color="#990000">(</font>transextremeoptioncall<font color="#990000">[</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">],</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>strike<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> t2 <font color="#990000">),</font>t<font color="#990000">,</font>rate<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> dividend <font color="#990000">),</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SIMPLECHOOSER<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"SimpleChooser"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">SimpleChooser</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t2<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> PARTIALFIXEDLB<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> t2 <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
          callprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"PartialFixedLB"</font><font color="#990000">,</font> <font color="#993399">8</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font> <font color="#990000">:</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">),(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font> <font color="#990000">:</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">),(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">PartialFixedLB</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> t2<font color="#990000">),</font>t<font color="#990000">,</font>rate<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> dividend<font color="#990000">),</font>volatility<font color="#990000">);</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EXECUTIVE<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"Executive"</font><font color="#990000">,</font> <font color="#993399">8</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">Executive</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> GARMANKOHLHAGEN<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"GarmanKohlhagen"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">GarmanKohlhagen</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> LOOKBARRIER<font color="#990000">:</font>
     <font color="#FF0000">{</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> t2 <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
          callprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"LookBarrier"</font><font color="#990000">,</font> <font color="#993399">9</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">+</font><font color="#993399">2</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font> <font color="#990000">:</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">),(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font> <font color="#990000">:</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">),(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">LookBarrier</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">+</font><font color="#993399">2</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> t2<font color="#990000">),</font>t<font color="#990000">,</font>rate<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> dividend<font color="#990000">),</font>volatility<font color="#990000">);</font>

     <font color="#FF0000">}</font>

     <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> PARTIALTIMEBARRIER<font color="#990000">:</font>
     <font color="#FF0000">{</font>
      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> t2 <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
          callprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"PartialTimeBarrier"</font><font color="#990000">,</font> <font color="#993399">9</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)(</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">),</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>
                <font color="#990000">(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font> <font color="#990000">:</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">),</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>
                <font color="#990000">(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font> <font color="#990000">:</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">),</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">PartialTimeBarrier</font></b><font color="#990000">((</font><b><font color="#0000FF">const</font></b> <font color="#009900">char</font><font color="#990000">*)&amp;</font>namelistpartialtimebarrier<font color="#990000">[</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">],</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> t2<font color="#990000">),</font>t<font color="#990000">,</font>rate<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> dividend<font color="#990000">),</font>volatility<font color="#990000">);</font>

     <font color="#FF0000">}</font>

     <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> GAPOPTION<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"GapOption"</font><font color="#990000">,</font> <font color="#993399">8</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>
 
      callprice <font color="#990000">=</font> <b><font color="#000000">GapOption</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> JUMPDIFFUSION<font color="#990000">:</font>
      
      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"JumpDiffusion"</font><font color="#990000">,</font> <font color="#993399">8</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">JumpDiffusion</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BISECTION<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <font color="#009900">double</font> cprice<font color="#990000">;</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"bisection"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> <b><font color="#000000">bisection</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,&amp;</font>cprice<font color="#990000">)</font> <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
        callprice <font color="#990000">=</font> cprice<font color="#990000">;</font>
      <b><font color="#0000FF">else</font></b>
        callprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>


    <b><font color="#0000FF">case</font></b> NEWTONRAPHSON<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <font color="#009900">double</font> cprice<font color="#990000">;</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"NewtonRaphson"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> <b><font color="#000000">NewtonRaphson</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,&amp;</font>cprice<font color="#990000">)</font> <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
        callprice <font color="#990000">=</font> cprice<font color="#990000">;</font>
      <b><font color="#0000FF">else</font></b>
        callprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BAWBISECTION<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"BAWbisection"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">BAWbisection</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BSBISECTION<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"BSbisection"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>
      
      callprice <font color="#990000">=</font> <b><font color="#000000">BSbisection</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SWAPOPTION<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"Swapoption"</font><font color="#990000">,</font> <font color="#993399">8</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>
      
      callprice <font color="#990000">=</font> <b><font color="#000000">Swapoption</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t2<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> TURNBULLWAKEMANASIAN<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> t2 <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
          callprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"TurnbullWakemanAsian"</font><font color="#990000">,</font> <font color="#993399">10</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">TurnbullWakemanAsian</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>t2<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> COMPLEXCHOOSER<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> t2 <font color="#990000">&lt;</font> <font color="#993399">0</font> <font color="#990000">||</font> t3 <font color="#990000">&lt;</font> <font color="#993399">0</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
        callprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
        <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
           <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"ComplexChooser"</font><font color="#990000">,</font> <font color="#993399">9</font><font color="#990000">,</font>
                                 <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font>
                                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>    <i><font color="#9A1900">// Strike Call</font></i>
                             <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>    <i><font color="#9A1900">// Strike Put</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">,</font>    <i><font color="#9A1900">// Time</font></i>
                                     <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font>    <i><font color="#9A1900">// Time to Call</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t3<font color="#990000">,</font>    <i><font color="#9A1900">// Time to Put</font></i>
                                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>    <i><font color="#9A1900">// Rate</font></i>
                             <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>    <i><font color="#9A1900">// Cost of carry</font></i>
                            <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

       callprice <font color="#990000">=</font> <b><font color="#000000">ComplexChooser</font></b><font color="#990000">(</font>   price<font color="#990000">,</font>
                                     strike<font color="#990000">,</font>    <i><font color="#9A1900">// Strike Call</font></i>
                                  dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>    <i><font color="#9A1900">// Strike Put</font></i>
                                         t2<font color="#990000">,</font>    <i><font color="#9A1900">// Time</font></i>
                                          t<font color="#990000">,</font>    <i><font color="#9A1900">// Time to Call</font></i>
                                         t3<font color="#990000">,</font>    <i><font color="#9A1900">// Time to Put</font></i>
                                      rate<font color="#990000">,</font>     <i><font color="#9A1900">// Rate</font></i>
                                  dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>    <i><font color="#9A1900">// Cost of carry</font></i>
                                  volatility<font color="#990000">);</font>
       <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SUPERSHARE<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"SuperShare"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>
      
      callprice <font color="#990000">=</font> <b><font color="#000000">SuperShare</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SUPERSHARE2<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"SuperShare"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>
      
      callprice <font color="#990000">=</font> <b><font color="#000000">SuperShare</font></b><font color="#990000">(</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> VASICEKBONDOPTION<font color="#990000">:</font>
      
      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"VasicekBondOption"</font><font color="#990000">,</font> <font color="#993399">9</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">VasicekBondOption</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> TIMESWITCHOPTION<font color="#990000">:</font>
      
      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"TimeSwitchOption"</font><font color="#990000">,</font> <font color="#993399">10</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">TimeSwitchOption</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>t<font color="#990000">,(</font><font color="#009900">int</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>t2<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> FOREQUOPTINDOMCUR<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"ForEquOptInDomCur"</font><font color="#990000">,</font> <font color="#993399">10</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">);</font>
 
      callprice <font color="#990000">=</font> <b><font color="#000000">ForEquOptInDomCur</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> QUANTO<font color="#990000">:</font>
        
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
          <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"Quanto"</font><font color="#990000">,</font> <font color="#993399">11</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>dividend<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">);</font>

        callprice <font color="#990000">=</font> <b><font color="#000000">Quanto</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EQUITYLINKEDFXO<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"EquityLinkedFXO"</font><font color="#990000">,</font> <font color="#993399">11</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">EquityLinkedFXO</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SPREADAPPROXIMATION<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"SpreadApproximation"</font><font color="#990000">,</font> <font color="#993399">9</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">SpreadApproximation</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BINARYBARRIER<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">&gt;=</font> <font color="#993399">13</font><font color="#990000">)</font>
      <font color="#FF0000">{</font>
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>UseZ <font color="#990000">==</font> strike<font color="#990000">)</font>
        <font color="#FF0000">{</font>
          <i><font color="#9A1900">// force NaN price</font></i>
          callprice <font color="#990000">=</font> <b><font color="#000000">sqrt</font></b><font color="#990000">(-</font><font color="#993399">1</font><font color="#990000">);</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
        <font color="#FF0000">}</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"BinaryBarrier"</font><font color="#990000">,</font> <font color="#993399">11</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">BinaryBarrier</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,(</font><font color="#009900">int</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,(</font><font color="#009900">int</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> TAKEOVERFXOPTION<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"TakeoverFXoption"</font><font color="#990000">,</font> <font color="#993399">10</font><font color="#990000">,</font>
                                   <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font>
                                   <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>
                                   <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>
                                   <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>
                                   <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font>
                                   <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>
                                   <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>
                                   <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,</font>
                                   <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>
                                   <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseR<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">TakeoverFXoption</font></b><font color="#990000">(</font>
                                   price<font color="#990000">,</font>
                                   dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>
                                   dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>
                                   strike<font color="#990000">,</font>
                                   t<font color="#990000">,</font>
                                   rate<font color="#990000">,</font>
                                   dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>
                                   volatility<font color="#990000">,</font>
                                   dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>
                                   dat<font color="#990000">-&gt;</font>UseR<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERICANEXCHANGEOPTION<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"AmericanExchangeOption"</font><font color="#990000">,</font> <font color="#993399">12</font><font color="#990000">,</font>
                                           <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,</font>
                                           <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font>      <i><font color="#9A1900">// price</font></i>
                                           <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>     <i><font color="#9A1900">// strike</font></i>
                                           <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>  <i><font color="#9A1900">// B</font></i>
                                           <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>  <i><font color="#9A1900">// J</font></i>
                                           <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font>          <i><font color="#9A1900">// time</font></i>
                                           <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>       <i><font color="#9A1900">// rate</font></i>
                                           <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>  <i><font color="#9A1900">// P</font></i>
                                           <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>  <i><font color="#9A1900">// Q</font></i>
                                           <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,</font> <i><font color="#9A1900">// standard deviation</font></i>
                                           <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseR<font color="#990000">,</font>  <i><font color="#9A1900">// R</font></i>
                                           <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseS   <i><font color="#9A1900">// S</font></i>
                                           <font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">AmericanExchangeOption</font></b><font color="#990000">(</font>
                                           <font color="#993399">1</font><font color="#990000">,</font>
                                           price<font color="#990000">,</font>      <i><font color="#9A1900">// price</font></i>
                                           strike<font color="#990000">,</font>     <i><font color="#9A1900">// strike</font></i>
                                           dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>  <i><font color="#9A1900">// B</font></i>
                                           dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>  <i><font color="#9A1900">// J</font></i>
                                           t<font color="#990000">,</font>          <i><font color="#9A1900">// time</font></i>
                                           rate<font color="#990000">,</font>       <i><font color="#9A1900">// rate</font></i>
                                           dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>  <i><font color="#9A1900">// P</font></i>
                                           dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>  <i><font color="#9A1900">// Q</font></i>
                                           volatility<font color="#990000">,</font> <i><font color="#9A1900">// standard deviation</font></i>
                                           dat<font color="#990000">-&gt;</font>UseR<font color="#990000">,</font>  <i><font color="#9A1900">// R</font></i>
                                           dat<font color="#990000">-&gt;</font>UseS   <i><font color="#9A1900">// T</font></i>
                                           <font color="#990000">);</font>

        <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> DISCRETEADJUSTEDBARRIER<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"DiscreteAdjustedBarrier"</font><font color="#990000">,</font> <font color="#993399">4</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t <font color="#990000">);</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>price <font color="#990000">==</font> strike<font color="#990000">)</font>
      <font color="#FF0000">{</font>
        <i><font color="#9A1900">// force NaN price</font></i>
        callprice <font color="#990000">=</font> <b><font color="#000000">sqrt</font></b><font color="#990000">(-</font><font color="#993399">1</font><font color="#990000">);</font>
      <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
      <font color="#FF0000">{</font>
        callprice <font color="#990000">=</font> <b><font color="#000000">DiscreteAdjustedBarrier</font></b><font color="#990000">(</font>price<font color="#990000">,</font> strike<font color="#990000">,</font> volatility<font color="#990000">,</font> t<font color="#990000">);</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900">    case BARRIERBINOMINAL:</font></i>
<i><font color="#9A1900">      {</font></i>
<i><font color="#9A1900">        int state;</font></i>
<i><font color="#9A1900">        </font></i>
<i><font color="#9A1900">        if ( dat-&gt;UsePound == 1 )</font></i>
<i><font color="#9A1900">        {</font></i>
<i><font color="#9A1900">          state = SB_CALL_UP_OUT;</font></i>

<i><font color="#9A1900">        } else if( dat-&gt;UsePound == 2 )</font></i>
<i><font color="#9A1900">        {</font></i>
<i><font color="#9A1900">          state = SB_CALL_DOWN_OUT;</font></i>
<i><font color="#9A1900">        } else</font></i>
<i><font color="#9A1900">        {</font></i>
<i><font color="#9A1900">          printf("Error unknown state UsePound = %d\n", dat-&gt;UsePound);</font></i>
<i><font color="#9A1900">        }</font></i>

<i><font color="#9A1900">        int optionType = (int) dat-&gt;UseZ;</font></i>

<i><font color="#9A1900">        if( optionType != 0 &amp;&amp; optionType != 1 )</font></i>
<i><font color="#9A1900">        {</font></i>
<i><font color="#9A1900">          printf("Error optionType = %d\n", optionType);</font></i>
<i><font color="#9A1900">        }</font></i>

<i><font color="#9A1900">        if(dat-&gt;debug)</font></i>
<i><font color="#9A1900">          logger( (char *)"BarrierBinomial", 10,</font></i>
<i><font color="#9A1900">                                  (double)optionType,         // Z     -&gt; EuropeanOption</font></i>
<i><font color="#9A1900">                                  (double)state,              // #     -&gt; type</font></i>
<i><font color="#9A1900">                                  (double)price,</font></i>
<i><font color="#9A1900">                                  (double)strike,</font></i>
<i><font color="#9A1900">                                  (double)dat-&gt;UseB,          // B     -&gt; H</font></i>
<i><font color="#9A1900">                                  (double)t,</font></i>
<i><font color="#9A1900">                                  (double)rate,</font></i>
<i><font color="#9A1900">                                  (double)dividend,           //</font></i>
<i><font color="#9A1900">                                  (double)volatility,</font></i>
<i><font color="#9A1900">                                  (double)dat-&gt;steps);        // steps -&gt; n</font></i>

<i><font color="#9A1900">        callprice = BarrierBinomial(</font></i>
<i><font color="#9A1900">                                  optionType,         // Z     -&gt; EuropeanOption</font></i>
<i><font color="#9A1900">                                  state,              // #     -&gt; type</font></i>
<i><font color="#9A1900">                                  price,</font></i>
<i><font color="#9A1900">                                  strike,</font></i>
<i><font color="#9A1900">                                  dat-&gt;UseB,          // B     -&gt; H</font></i>
<i><font color="#9A1900">                                  t,</font></i>
<i><font color="#9A1900">                                  rate,</font></i>
<i><font color="#9A1900">                                  dividend,           //</font></i>
<i><font color="#9A1900">                                  volatility,</font></i>
<i><font color="#9A1900">                                  dat-&gt;steps);        // steps -&gt; n</font></i>
<i><font color="#9A1900">      }</font></i>

<i><font color="#9A1900">      break;</font></i>
<i><font color="#9A1900"> */</font></i>
    <b><font color="#0000FF">case</font></b> CONVERTIBLEBOND<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"ConvertibleBond"</font><font color="#990000">,</font> <font color="#993399">12</font><font color="#990000">,</font>
                                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">,</font>
                                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font>
                                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>
                                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font>
                                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">,</font>
                                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>
                                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>       <i><font color="#9A1900">// Z</font></i>
                                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,</font>
                                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,</font>
                                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>       <i><font color="#9A1900">// B</font></i>
                                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>       <i><font color="#9A1900">// J</font></i>
                                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">ConvertibleBond</font></b><font color="#990000">(</font>
                                  dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">,</font>
                                  price<font color="#990000">,</font>
                                  strike<font color="#990000">,</font>
                                  t<font color="#990000">,</font>
                                  t2<font color="#990000">,</font>
                                  rate<font color="#990000">,</font>
                                  dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>       <i><font color="#9A1900">// Z</font></i>
                                  dividend<font color="#990000">,</font>
                                  volatility<font color="#990000">,</font>
                                  dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>       <i><font color="#9A1900">// B</font></i>
                                  dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>       <i><font color="#9A1900">// J</font></i>
                                  dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> CRRBINOMINAL<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"CRRBinomial"</font><font color="#990000">,</font> <font color="#993399">9</font><font color="#990000">,</font>
                              <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">,</font>
                              <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,</font>
                              <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font>
                              <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>
                              <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font>
                              <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>
                              <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,</font>
                              <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,</font>
                              <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">CRRBinomial</font></b><font color="#990000">(</font>
                              dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">,</font>
                              <font color="#993399">1</font><font color="#990000">,</font>
                              price<font color="#990000">,</font>
                              strike<font color="#990000">,</font>
                              t<font color="#990000">,</font>
                              rate<font color="#990000">,</font>
                              dividend<font color="#990000">,</font>
                              volatility<font color="#990000">,</font>
                              dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900">    case IMPLIEDTRINOMINALTREE:</font></i>

<i><font color="#9A1900">      callprice = ImpliedTrinomialTree(</font></i>
<i><font color="#9A1900">                      const char* ReturnFlag,</font></i>
<i><font color="#9A1900">                      int STEPn,</font></i>
<i><font color="#9A1900">                      int STATEi,</font></i>
<i><font color="#9A1900">                      double S,</font></i>
<i><font color="#9A1900">                      double X,</font></i>
<i><font color="#9A1900">                      double T,</font></i>
<i><font color="#9A1900">                      double r,</font></i>
<i><font color="#9A1900">                      double b,</font></i>
<i><font color="#9A1900">                      double v,</font></i>
<i><font color="#9A1900">                      double Skew,</font></i>
<i><font color="#9A1900">                      int nSteps)</font></i>

<i><font color="#9A1900">      callprice = ImpliedTrinomialTree(</font></i>
<i><font color="#9A1900">                      (const char*)&amp;namelistimpliedtrinominaltree[dat-&gt;UsePound-1],</font></i>
<i><font color="#9A1900">                      dat-&gt;UseZ,            // int STEPn,</font></i>
<i><font color="#9A1900">                      dat-&gt;UseB,            // int STATEi,</font></i>
<i><font color="#9A1900">                      price,</font></i>
<i><font color="#9A1900">                      strike,</font></i>
<i><font color="#9A1900">                      t,</font></i>
<i><font color="#9A1900">                      rate,</font></i>
<i><font color="#9A1900">                      dividend,</font></i>
<i><font color="#9A1900">                      volatility,</font></i>
<i><font color="#9A1900">                      dat-&gt;UseJ,           // double Skew,</font></i>
<i><font color="#9A1900">                      dat-&gt;steps);</font></i>

<i><font color="#9A1900">      break;</font></i>
<i><font color="#9A1900">*/</font></i>

    <b><font color="#0000FF">case</font></b> THREEDIMENSIONALBINOMINAL<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"ThreeDimensionalBinomial"</font><font color="#990000">,</font> <font color="#993399">17</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseR<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseS<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseT<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">ThreeDimensionalBinomial</font></b><font color="#990000">(</font>
                                           dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,</font>          <i><font color="#9A1900">// #             -&gt; type</font></i>
                                           dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>              <i><font color="#9A1900">// Z             -&gt; EuropeanOption</font></i>
                                           <font color="#993399">1</font><font color="#990000">,</font>                      <i><font color="#9A1900">// 1 for Call</font></i>
                                           price<font color="#990000">,</font>                  <i><font color="#9A1900">// P             -&gt; S1</font></i>
                                           dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>              <i><font color="#9A1900">// B             -&gt; S2</font></i>
                                           dat<font color="#990000">-&gt;</font>UseR<font color="#990000">,</font>              <i><font color="#9A1900">// R             -&gt; Q1</font></i>
                                           dat<font color="#990000">-&gt;</font>UseS<font color="#990000">,</font>              <i><font color="#9A1900">// S             -&gt; Q2</font></i>
                                           strike<font color="#990000">,</font>                 <i><font color="#9A1900">// strike</font></i>
                                           dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>              <i><font color="#9A1900">// Q             -&gt; X2</font></i>
                                           t<font color="#990000">,</font>                      <i><font color="#9A1900">// t     </font></i>
                                           rate<font color="#990000">,</font>                   <i><font color="#9A1900">// rate </font></i>
                                           dividend<font color="#990000">,</font>               <i><font color="#9A1900">// dividend      -&gt; b1</font></i>
                                           dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>              <i><font color="#9A1900">// P             -&gt; b2</font></i>
                                           volatility<font color="#990000">,</font>             <i><font color="#9A1900">// volatility</font></i>
                                           dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>              <i><font color="#9A1900">// J             -&gt; v2</font></i>
                                           dat<font color="#990000">-&gt;</font>UseT<font color="#990000">,</font>              <i><font color="#9A1900">// T             -&gt; rho</font></i>
                                           dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>            <i><font color="#9A1900">// steps</font></i>
      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> TRINOMINALTREE<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"TrinomialTree"</font><font color="#990000">,</font> <font color="#993399">9</font><font color="#990000">,</font>
                                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">,</font>
                                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,</font>
                                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font>
                                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>
                                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font>
                                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>
                                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,</font>
                                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,</font>
                                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">TrinomialTree</font></b><font color="#990000">(</font>
                                dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">,</font>
                                <font color="#993399">1</font><font color="#990000">,</font>
                                price<font color="#990000">,</font>
                                strike<font color="#990000">,</font>
                                t<font color="#990000">,</font>
                                rate<font color="#990000">,</font>
                                dividend<font color="#990000">,</font>
                                volatility<font color="#990000">,</font>
                                dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>
      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EUROPEANEXCHANGEOPTION<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"EuropeanExchangeOption"</font><font color="#990000">,</font> <font color="#993399">11</font><font color="#990000">,</font>
                                         <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font>      <i><font color="#9A1900">// price</font></i>
                                         <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>     <i><font color="#9A1900">// strike</font></i>
                                         <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>  <i><font color="#9A1900">// B</font></i>
                                         <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>  <i><font color="#9A1900">// J</font></i>
                                         <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font>          <i><font color="#9A1900">// time</font></i>
                                         <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>       <i><font color="#9A1900">// rate</font></i>
                                         <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>  <i><font color="#9A1900">// P</font></i>
                                         <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>  <i><font color="#9A1900">// Q </font></i>
                                         <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseR<font color="#990000">,</font>  <i><font color="#9A1900">// R </font></i>
                                         <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseS<font color="#990000">,</font>  <i><font color="#9A1900">// S</font></i>
                                         <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseT<font color="#990000">);</font> <i><font color="#9A1900">// T</font></i>

      callprice <font color="#990000">=</font> <b><font color="#000000">EuropeanExchangeOption</font></b><font color="#990000">(</font>
                                         price<font color="#990000">,</font>      <i><font color="#9A1900">// price</font></i>
                                         strike<font color="#990000">,</font>     <i><font color="#9A1900">// strike</font></i>
                                         dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>  <i><font color="#9A1900">// B</font></i>
                                         dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>  <i><font color="#9A1900">// J</font></i>
                                         t<font color="#990000">,</font>          <i><font color="#9A1900">// time</font></i>
                                         rate<font color="#990000">,</font>       <i><font color="#9A1900">// rate</font></i>
                                         dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>  <i><font color="#9A1900">// P</font></i>
                                         dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>  <i><font color="#9A1900">// Q </font></i>
                                         dat<font color="#990000">-&gt;</font>UseR<font color="#990000">,</font>  <i><font color="#9A1900">// R </font></i>
                                         dat<font color="#990000">-&gt;</font>UseS<font color="#990000">,</font>  <i><font color="#9A1900">// S</font></i>
                                         dat<font color="#990000">-&gt;</font>UseT<font color="#990000">);</font> <i><font color="#9A1900">// T</font></i>

        <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> MILTERSENSWARTZ<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"MiltersenSchwartz"</font><font color="#990000">,</font> <font color="#993399">14</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>     <i><font color="#9A1900">// Z </font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font>         <i><font color="#9A1900">// price</font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,</font>    <i><font color="#9A1900">// volatility</font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>     <i><font color="#9A1900">// B</font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>     <i><font color="#9A1900">// J</font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>     <i><font color="#9A1900">// P</font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>     <i><font color="#9A1900">// Q</font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseR<font color="#990000">,</font>     <i><font color="#9A1900">// R</font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseS<font color="#990000">,</font>     <i><font color="#9A1900">// S</font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseT<font color="#990000">);</font>    <i><font color="#9A1900">// T </font></i>

        callprice <font color="#990000">=</font> <b><font color="#000000">MiltersenSchwartz</font></b><font color="#990000">(</font>
                <font color="#993399">1</font><font color="#990000">,</font>
                dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>     <i><font color="#9A1900">// Z </font></i>
                price<font color="#990000">,</font>         <i><font color="#9A1900">// price</font></i>
                strike<font color="#990000">,</font>
                t<font color="#990000">,</font>
                t2<font color="#990000">,</font>
                volatility<font color="#990000">,</font>    <i><font color="#9A1900">// volatility</font></i>
                dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>     <i><font color="#9A1900">// B</font></i>
                dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>     <i><font color="#9A1900">// J</font></i>
                dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>     <i><font color="#9A1900">// P</font></i>
                dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>     <i><font color="#9A1900">// Q</font></i>
                dat<font color="#990000">-&gt;</font>UseR<font color="#990000">,</font>     <i><font color="#9A1900">// R</font></i>
                dat<font color="#990000">-&gt;</font>UseS<font color="#990000">,</font>     <i><font color="#9A1900">// S</font></i>
                dat<font color="#990000">-&gt;</font>UseT<font color="#990000">);</font>    <i><font color="#9A1900">// T </font></i>

        <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> PARTIALTIMETWOASSETBARRIER<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> t2 <font color="#990000">&lt;=</font> <font color="#993399">0.0</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          callprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
        <font color="#FF0000">}</font>

        <font color="#009900">int</font> state<font color="#990000">;</font>
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          state <font color="#990000">=</font> SB_CALL_UP_IN<font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b> <font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          state <font color="#990000">=</font> SB_CALL_UP_OUT<font color="#990000">;</font>
        <font color="#FF0000">}</font>
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">3</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          state <font color="#990000">=</font> SB_CALL_DOWN_OUT<font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b> <font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">4</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          state <font color="#990000">=</font> SB_CALL_DOWN_IN<font color="#990000">;</font>
        <font color="#FF0000">}</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"PartialTimeTwoAssetBarrier"</font><font color="#990000">,</font> <font color="#993399">13</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>state<font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font>          <i><font color="#9A1900">// price</font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>      <i><font color="#9A1900">// Z</font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>         <i><font color="#9A1900">// strike</font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>      <i><font color="#9A1900">// B</font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font>              <i><font color="#9A1900">// t</font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">,</font>             <i><font color="#9A1900">// t2</font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>           <i><font color="#9A1900">// rate</font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>dividend<font color="#990000">,</font>  <i><font color="#9A1900">// J</font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>      <i><font color="#9A1900">// P</font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>      <i><font color="#9A1900">// Q</font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseR<font color="#990000">,</font>      <i><font color="#9A1900">// R</font></i>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseS<font color="#990000">);</font>     <i><font color="#9A1900">// S</font></i>

        callprice <font color="#990000">=</font> <b><font color="#000000">PartialTimeTwoAssetBarrier</font></b><font color="#990000">(</font>
                state<font color="#990000">,</font>
                price<font color="#990000">,</font>      <i><font color="#9A1900">// price</font></i>
                dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>  <i><font color="#9A1900">// Z</font></i>
                strike<font color="#990000">,</font>     <i><font color="#9A1900">// strike</font></i>
                dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>  <i><font color="#9A1900">// B</font></i>
                t<font color="#990000">,</font>          <i><font color="#9A1900">// t</font></i>
                t2<font color="#990000">,</font>         <i><font color="#9A1900">// t2</font></i>
                rate<font color="#990000">,</font>       <i><font color="#9A1900">// rate</font></i>
                dividend<font color="#990000">,</font>   <i><font color="#9A1900">// J</font></i>
                dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>  <i><font color="#9A1900">// P</font></i>
                dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>  <i><font color="#9A1900">// Q</font></i>
                dat<font color="#990000">-&gt;</font>UseR<font color="#990000">,</font>  <i><font color="#9A1900">// R</font></i>
                dat<font color="#990000">-&gt;</font>UseS<font color="#990000">);</font> <i><font color="#9A1900">// S</font></i>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> TWOASSETBARRIER<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#009900">int</font> state<font color="#990000">;</font>
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          state <font color="#990000">=</font> SB_CALL_UP_IN<font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b> <font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          state <font color="#990000">=</font> SB_CALL_UP_OUT<font color="#990000">;</font>
        <font color="#FF0000">}</font>
        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">3</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          state <font color="#990000">=</font> SB_CALL_DOWN_OUT<font color="#990000">;</font>

        <font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b> <font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">4</font> <font color="#990000">)</font>
        <font color="#FF0000">{</font>
          state <font color="#990000">=</font> SB_CALL_DOWN_IN<font color="#990000">;</font>
        <font color="#FF0000">}</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
          <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"TwoAssetBarrier"</font><font color="#990000">,</font> <font color="#993399">12</font><font color="#990000">,</font>
                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>state<font color="#990000">,</font>
                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font>         <i><font color="#9A1900">// standard deviation</font></i>
                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>     <i><font color="#9A1900">// S2                        1</font></i>
                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>        <i><font color="#9A1900">// strike</font></i>
                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>     <i><font color="#9A1900">// H                         2</font></i>
                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font>             <i><font color="#9A1900">// t1</font></i>
                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>          <i><font color="#9A1900">// rate</font></i>
                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>     <i><font color="#9A1900">// dividend</font></i>
                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>     <i><font color="#9A1900">// b2                        3</font></i>
                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,</font>    <i><font color="#9A1900">// standard deviation</font></i>
                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>     <i><font color="#9A1900">// v2                        4</font></i>
                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseR<font color="#990000">);</font>    <i><font color="#9A1900">// rho                       5</font></i>

        callprice <font color="#990000">=</font> <b><font color="#000000">TwoAssetBarrier</font></b><font color="#990000">(</font>
                                    state<font color="#990000">,</font>
                                    price<font color="#990000">,</font>         <i><font color="#9A1900">// price</font></i>
                                    dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>     <i><font color="#9A1900">// S2                        1</font></i>
                                    strike<font color="#990000">,</font>        <i><font color="#9A1900">// strike</font></i>
                                    dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>     <i><font color="#9A1900">// H                         2</font></i>
                                    t<font color="#990000">,</font>             <i><font color="#9A1900">// t1</font></i>
                                    rate<font color="#990000">,</font>          <i><font color="#9A1900">// rate</font></i>
                                    dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>     <i><font color="#9A1900">// dividend</font></i>
                                    dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>     <i><font color="#9A1900">// b2                        3</font></i>
                                    volatility<font color="#990000">,</font>    <i><font color="#9A1900">// standard deviation</font></i>
                                    dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>     <i><font color="#9A1900">// v2                        4</font></i>
                                    dat<font color="#990000">-&gt;</font>UseR<font color="#990000">);</font>    <i><font color="#9A1900">// rho                       5</font></i>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> TWOASSETCASHORNOTHING<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"TwoAssetCashOrNothing"</font><font color="#990000">,</font> <font color="#993399">13</font><font color="#990000">,</font>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,</font>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font>         <i><font color="#9A1900">// price</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>     <i><font color="#9A1900">// S2                        1</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>        <i><font color="#9A1900">// X1 strike</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>     <i><font color="#9A1900">// X2</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>     <i><font color="#9A1900">// K                         2</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font>             <i><font color="#9A1900">// t1</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>          <i><font color="#9A1900">// rate</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>     <i><font color="#9A1900">// dividend</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>     <i><font color="#9A1900">// b2                        3</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,</font>    <i><font color="#9A1900">// standard deviation</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseR<font color="#990000">,</font>     <i><font color="#9A1900">// v2                        4</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseS<font color="#990000">);</font>    <i><font color="#9A1900">// rho                       5</font></i>

        callprice <font color="#990000">=</font>  <b><font color="#000000">TwoAssetCashOrNothing</font></b><font color="#990000">(</font>
                                    dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,</font>
                                    price<font color="#990000">,</font>         <i><font color="#9A1900">// price</font></i>
                                    dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>     <i><font color="#9A1900">// S2                        1</font></i>
                                    strike<font color="#990000">,</font>        <i><font color="#9A1900">// X1 strike</font></i>
                                    dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>     <i><font color="#9A1900">// X2</font></i>
                                    dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>     <i><font color="#9A1900">// K                         2</font></i>
                                    t<font color="#990000">,</font>             <i><font color="#9A1900">// t1</font></i>
                                    rate<font color="#990000">,</font>          <i><font color="#9A1900">// rate</font></i>
                                    dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>     <i><font color="#9A1900">// dividend</font></i>
                                    dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>     <i><font color="#9A1900">// b2                        3</font></i>
                                    volatility<font color="#990000">,</font>    <i><font color="#9A1900">// standard deviation</font></i>
                                    dat<font color="#990000">-&gt;</font>UseR<font color="#990000">,</font>     <i><font color="#9A1900">// v2                        4</font></i>
                                    dat<font color="#990000">-&gt;</font>UseS<font color="#990000">);</font>    <i><font color="#9A1900">// rho                       5</font></i>
        <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> TWOASSETCORRELATION<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"TwoAssetCorrelation"</font><font color="#990000">,</font> <font color="#993399">12</font><font color="#990000">,</font>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,</font>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font>         <i><font color="#9A1900">// price</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>     <i><font color="#9A1900">// S2                        1</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>        <i><font color="#9A1900">// X1 strike</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>     <i><font color="#9A1900">// X2</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font>             <i><font color="#9A1900">// t1</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>          <i><font color="#9A1900">// rate</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>     <i><font color="#9A1900">// dividend</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>     <i><font color="#9A1900">// b2                        3</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,</font>    <i><font color="#9A1900">// standard deviation</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>     <i><font color="#9A1900">// v2                        4</font></i>
                                    <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseR<font color="#990000">);</font>    <i><font color="#9A1900">// rho                       5</font></i>

      callprice <font color="#990000">=</font> <b><font color="#000000">TwoAssetCorrelation</font></b><font color="#990000">(</font>
                                    <font color="#993399">1</font><font color="#990000">,</font>
                                    price<font color="#990000">,</font>         <i><font color="#9A1900">// price</font></i>
                                    dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>     <i><font color="#9A1900">// S2                        1</font></i>
                                    strike<font color="#990000">,</font>        <i><font color="#9A1900">// X1 strike</font></i>
                                    dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>     <i><font color="#9A1900">// X2</font></i>
                                    t<font color="#990000">,</font>             <i><font color="#9A1900">// t1</font></i>
                                    rate<font color="#990000">,</font>          <i><font color="#9A1900">// rate</font></i>
                                    dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>     <i><font color="#9A1900">// dividend</font></i>
                                    dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>     <i><font color="#9A1900">// b2                        3</font></i>
                                    volatility<font color="#990000">,</font>    <i><font color="#9A1900">// standard deviation</font></i>
                                    dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>     <i><font color="#9A1900">// v2                        4</font></i>
                                    dat<font color="#990000">-&gt;</font>UseR<font color="#990000">);</font>    <i><font color="#9A1900">// rho                       5</font></i>
        <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> VASICEKBONDPRICE<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"VasicekBondPrice"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                                     <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">,</font>
                                     <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font>
                                     <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>
                                     <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>
                                     <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>
                                     <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

        callprice <font color="#990000">=</font> <b><font color="#000000">VasicekBondPrice</font></b><font color="#990000">(</font>
                                     t2<font color="#990000">,</font>
                                     t<font color="#990000">,</font>
                                     rate<font color="#990000">,</font>
                                     dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>
                                     dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>
                                     volatility<font color="#990000">);</font>

        <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EXCHANGEEXCHANGEOPTION<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"ExchangeExchangeOption"</font><font color="#990000">,</font> <font color="#993399">12</font><font color="#990000">,</font>
                                            <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,</font>
                                            <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>
                                            <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>
                                            <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,</font>
                                            <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">,</font>
                                            <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font>
                                            <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>
                                            <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>
                                            <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>
                                            <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>
                                            <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>
                                            <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseR<font color="#990000">);</font>

      callprice <font color="#990000">=</font>  <b><font color="#000000">ExchangeExchangeOption</font></b><font color="#990000">(</font>
                                            dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,</font>
                                            strike<font color="#990000">,</font>
                                            dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>
                                            dividend<font color="#990000">,</font>
                                            t2<font color="#990000">,</font>
                                            t<font color="#990000">,</font>
                                            rate<font color="#990000">,</font>
                                            dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>
                                            dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>
                                            dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font>
                                            dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font>
                                            dat<font color="#990000">-&gt;</font>UseR<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> FLOATINGSTRIKELOOKBACK<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"FloatingStrikeLookback"</font><font color="#990000">,</font> <font color="#993399">8</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>
      
      callprice <font color="#990000">=</font> <b><font color="#000000">FloatingStrikeLookback</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> FLOATINGSTRIKELOOKBACK2<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"FloatingStrikeLookback"</font><font color="#990000">,</font> <font color="#993399">8</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>
      
      callprice <font color="#990000">=</font> <b><font color="#000000">FloatingStrikeLookback</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> OPTIONSONTHEMAXMIN<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"OptionsOnTheMaxMin"</font><font color="#990000">,</font> <font color="#993399">11</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)(</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">),(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">OptionsOnTheMaxMin</font></b><font color="#990000">((</font><font color="#009900">char</font> <font color="#990000">*)&amp;</font>namelistoptionsontheminmax2<font color="#990000">[</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">],</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> PARTIALFLOATLB<font color="#990000">:</font>
     <font color="#FF0000">{</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> t2 <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
          callprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"PartialFloatLB"</font><font color="#990000">,</font> <font color="#993399">10</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">PartialFloatLB</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>strike<font color="#990000">,</font>t2<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">);</font>

     <font color="#FF0000">}</font>

     <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> PARTIALFLOATLB2<font color="#990000">:</font>
     <font color="#FF0000">{</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font> t2 <font color="#990000">&lt;=</font> <font color="#993399">0</font> <font color="#990000">)</font>
      <font color="#FF0000">{</font>
          callprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
          <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"PartialFloatLB"</font><font color="#990000">,</font> <font color="#993399">10</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">PartialFloatLB</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>t2<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">);</font>

     <font color="#FF0000">}</font>

     <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> FIXEDSTRIKELOOKBACK<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"FixedStrikeLookback"</font><font color="#990000">,</font> <font color="#993399">9</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">FixedStrikeLookback</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> DOUBLEBARRIER<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"DoubleBarrier"</font><font color="#990000">,</font> <font color="#993399">11</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)(</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">+</font><font color="#993399">2</font><font color="#990000">),(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">DoubleBarrier</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">+</font><font color="#993399">2</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> STANDARDBARRIER<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"StandardBarrier"</font><font color="#990000">,</font> <font color="#993399">9</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">StandardBarrier</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SOFTBARRIER<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"SoftBarrier"</font><font color="#990000">,</font> <font color="#993399">9</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">SoftBarrier</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>t<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> LEVYASIAN<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"LevyAsian"</font><font color="#990000">,</font> <font color="#993399">9</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font>t2<font color="#990000">&gt;</font>t<font color="#990000">?(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font><font color="#990000">:(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">),(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font>t2<font color="#990000">&gt;</font>t<font color="#990000">?(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font><font color="#990000">:(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">),(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">LevyAsian</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>strike<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> t2<font color="#990000">),</font>t<font color="#990000">,</font>rate<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> dividend<font color="#990000">),</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> GEOMETRICAVERAGERATEOPTION<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"GeometricAverageRateOption"</font><font color="#990000">,</font> <font color="#993399">9</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font>t2<font color="#990000">&gt;</font>t<font color="#990000">?(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font><font color="#990000">:(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">),(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font>t2<font color="#990000">&gt;</font>t<font color="#990000">?(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font><font color="#990000">:(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">),(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">GeometricAverageRateOption</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>strike<font color="#990000">,</font>t<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> t2<font color="#990000">),</font>rate<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> dividend<font color="#990000">),</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> FORWARDSTARTOPTION<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"ForwardStartOption"</font><font color="#990000">,</font> <font color="#993399">8</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">1</font><font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font>t2<font color="#990000">&gt;</font>t<font color="#990000">?(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font><font color="#990000">:(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">),(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font>t2<font color="#990000">&gt;</font>t<font color="#990000">?(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font><font color="#990000">:(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">),(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">ForwardStartOption</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font>price<font color="#990000">,</font>strike<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> t2<font color="#990000">),</font>t<font color="#990000">,</font>rate<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> dividend<font color="#990000">),</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> FINRECIPES

    <b><font color="#0000FF">case</font></b> PERPETUAL<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_american_perpetual_call"</font><font color="#990000">,</font> <font color="#993399">5</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

       callprice <font color="#990000">=</font> <b><font color="#000000">option_price_american_perpetual_call</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERICANTRINOMIAL<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_call_american_trinomial"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 
       callprice <font color="#990000">=</font> <b><font color="#000000">option_price_call_american_trinomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> FUTOPTEURBLACK<font color="#990000">:</font>

     <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"futures_option_price_call_european_black"</font><font color="#990000">,</font> <font color="#993399">5</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">);</font> 

      callprice  <font color="#990000">=</font> <b><font color="#000000">futures_option_price_call_european_black</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> FUTOPTAMBINOMIAL<font color="#990000">:</font>
      
      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"futures_option_price_call_american_binomial"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

      callprice <font color="#990000">=</font> <b><font color="#000000">futures_option_price_call_american_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EUROSIM<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_call_european_simulated"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_call_european_simulated</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

     <i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900">    case AMERBJERKSUNDSTENSLAND:</font></i>

<i><font color="#9A1900">      //callprice = option_price_american_call_approximated_bjerksund_stensland( const double&amp; S, const double&amp; X, const double&amp; r, const double&amp; q, const double&amp; sigma, const double&amp; time );</font></i>

<i><font color="#9A1900">      //callprice = option_price_american_call_approximated_bjerksund_stensland(price,strike,rate,dividend,volatility,t); </font></i>

<i><font color="#9A1900">      break;</font></i>
<i><font color="#9A1900">    */</font></i>

    <b><font color="#0000FF">case</font></b> AMERBINOMIAL<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_call_american_binomial"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_call_american_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERBAW<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_american_call_approximated_baw"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">);</font> 

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_american_call_approximated_baw</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BONDZEROBLACK<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"bond_option_price_call_zero_black_scholes"</font><font color="#990000">,</font> <font color="#993399">5</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">);</font> 

      callprice <font color="#990000">=</font> <b><font color="#000000">bond_option_price_call_zero_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERPUTAPPROXJOHNSON<font color="#990000">:</font>

      callprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#ifdef</font></b> HAVE_LIBGSL

    <b><font color="#0000FF">case</font></b> AMERPUTAPPROXGESKEJOHNSON<font color="#990000">:</font>

      callprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> HESTON<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"heston_call_option_price"</font><font color="#990000">,</font> <font color="#993399">10</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseR<font color="#990000">);</font>
 
      callprice <font color="#990000">=</font> <b><font color="#000000">heston_call_option_price</font></b><font color="#990000">(</font>price<font color="#990000">,</font> strike<font color="#990000">,</font> rate<font color="#990000">,</font> volatility<font color="#990000">,</font> t<font color="#990000">,</font> dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font> dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">,</font> dat<font color="#990000">-&gt;</font>UseP<font color="#990000">,</font> dat<font color="#990000">-&gt;</font>UseQ<font color="#990000">,</font> dat<font color="#990000">-&gt;</font>UseR<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

    <b><font color="#0000FF">case</font></b> BONDAMERBINOMIAL<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"bond_option_price_call_american_binomial"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

      callprice <font color="#990000">=</font> <b><font color="#000000">bond_option_price_call_american_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BLACKSCHOLES3<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_call_black_scholes"</font><font color="#990000">,</font> <font color="#993399">5</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_call_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BSPAYOUT<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_european_call_payout"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_european_call_payout</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMERBINOMIALDIV<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_call_american_binomial"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 
      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_call_american_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EUROBIONMIAL<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_call_european_binomial"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_call_european_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> ASIANGEOMETRICAVG<font color="#990000">:</font>

     <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_asian_geometric_average_price_call"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_asian_geometric_average_price_call</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EUROLOOKBACK<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_european_lookback_call"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_european_lookback_call</font></b><font color="#990000">(</font>price<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EUROLOOKBACK2<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_european_lookback_call"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_european_lookback_call</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> MERTONJUMPDIFF<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_call_merton_jump_diffusion"</font><font color="#990000">,</font> <font color="#993399">8</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_call_merton_jump_diffusion</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> CURRAMBINOMIAL<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"currency_option_price_call_american_binomial"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">currency_option_price_call_american_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> CURREURO<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"currency_option_price_call_european"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">currency_option_price_call_european</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> ROLLGESKEWHALEY2<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_american_call_one_dividend"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font><font color="#990000">:</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">),(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font><font color="#993399">0</font><font color="#990000">:</font> <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">)</font> <font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_american_call_one_dividend</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font><font color="#990000">:</font> dividend<font color="#990000">),(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font><font color="#990000">:</font> t2<font color="#990000">));</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EUROBINOMIAL1P<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_call_european_binomial_single_period"</font><font color="#990000">,</font> <font color="#993399">5</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">);</font>

      <i><font color="#9A1900">// no time, does not support any dividend at all...</font></i>
      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_call_european_binomial_single_period</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EUROBINOMIALMP<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_call_european_binomial_multi_period_given_ud"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

      <i><font color="#9A1900">// no time, does not support any dividend at all...</font></i>
      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_call_european_binomial_multi_period_given_ud</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SIMEUROGENERIC<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#009900">double</font> <font color="#990000">(*</font>fun<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;,</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;);</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_call<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_cash_or_nothing_call<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">3</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_asset_or_nothing_call<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">4</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_binary_call<font color="#990000">;</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"derivative_price_simulate_european_option_generic"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

        callprice <font color="#990000">=</font> <b><font color="#000000">derivative_price_simulate_european_option_generic</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>fun<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SIMEUROGENERICCV<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#009900">double</font> <font color="#990000">(*</font>fun<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;,</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;);</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_call<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_cash_or_nothing_call<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">3</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_asset_or_nothing_call<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">4</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_binary_call<font color="#990000">;</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
          <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"derivative_price_simulate_european_option_generic_with_control_variate"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 

        callprice <font color="#990000">=</font> <b><font color="#000000">derivative_price_simulate_european_option_generic_with_control_variate</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>fun<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font> 
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SIMEUROGENERICAV<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#009900">double</font> <font color="#990000">(*</font>fun<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;,</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;);</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_call<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_cash_or_nothing_call<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">3</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_asset_or_nothing_call<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">4</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_binary_call<font color="#990000">;</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
          <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"derivative_price_simulate_european_option_generic_with_antithetic_variate"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

        callprice <font color="#990000">=</font> <b><font color="#000000">derivative_price_simulate_european_option_generic_with_antithetic_variate</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>fun<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SIMPRICEPATH<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#009900">double</font> <font color="#990000">(*</font>fun2<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> vector<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">&gt;&amp;,</font> <b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;);</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
          fun2 <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_arithmetric_average_call<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">)</font>
          fun2 <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_geometric_average_call<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">3</font> <font color="#990000">)</font>
          fun2 <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_lookback_call<font color="#990000">;</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
          <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"derivative_price_simulate_european_option_generic"</font><font color="#990000">,</font> <font color="#993399">8</font><font color="#990000">,</font>
                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

        callprice <font color="#990000">=</font> <b><font color="#000000">derivative_price_simulate_european_option_generic</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>fun2<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,(</font><font color="#009900">int</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> SIMPRICEPATHCONTROLVARIATE<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#009900">double</font> <font color="#990000">(*</font>fun2<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> vector<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">&gt;&amp;,</font> <b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;);</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
          fun2 <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_arithmetric_average_call<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">)</font>
          fun2 <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_geometric_average_call<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">3</font> <font color="#990000">)</font>
          fun2 <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_lookback_call<font color="#990000">;</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
          <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"derivative_price_simulate_european_option_generic_with_control_variate"</font><font color="#990000">,</font> <font color="#993399">8</font><font color="#990000">,</font>
                  <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

        callprice <font color="#990000">=</font> <b><font color="#000000">derivative_price_simulate_european_option_generic_with_control_variate</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>fun2<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,(</font><font color="#009900">int</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> DISTLOGRAND<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"simulate_lognormal_random_variable"</font><font color="#990000">,</font> <font color="#993399">4</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">simulate_lognormal_random_variable</font></b><font color="#990000">(</font>price<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> IMPLIEDNEWTON<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_implied_volatility_call_black_scholes_newton"</font><font color="#990000">,</font> <font color="#993399">5</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_implied_volatility_call_black_scholes_newton</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>t<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> IMPLIEDBISECTIONS<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_implied_volatility_call_black_scholes_bisections"</font><font color="#990000">,</font> <font color="#993399">5</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_implied_volatility_call_black_scholes_bisections</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>t<font color="#990000">,</font>volatility<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BONDZEROVASICEK<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"bond_option_price_call_zero_vasicek"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                                           <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>   <i><font color="#9A1900">// exercise price</font></i>
                                             <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>   <i><font color="#9A1900">// current interest rate</font></i>
                                               <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t2<font color="#990000">,</font>
                                                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font>
                                        <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>   <i><font color="#9A1900">// a</font></i>
                                        <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>   <i><font color="#9A1900">// b, </font></i>
                                        <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">);</font>  <i><font color="#9A1900">// sigma</font></i>

      callprice <font color="#990000">=</font> <b><font color="#000000">bond_option_price_call_zero_vasicek</font></b><font color="#990000">(</font>
                                           strike<font color="#990000">,</font>   <i><font color="#9A1900">// exercise price</font></i>
                                             rate<font color="#990000">,</font>   <i><font color="#9A1900">// current interest rate</font></i>
                                               t2<font color="#990000">,</font>
                                                t<font color="#990000">,</font>
                                        dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>   <i><font color="#9A1900">// a</font></i>
                                        dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>   <i><font color="#9A1900">// b, </font></i>
                                        dat<font color="#990000">-&gt;</font>UseJ<font color="#990000">);</font>  <i><font color="#9A1900">// sigma</font></i>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EURODIVIDENDS<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <b><font color="#000000">pthread_mutex_lock</font></b><font color="#990000">(&amp;</font>dat<font color="#990000">-&gt;</font>mutexCashflow<font color="#990000">);</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
      <font color="#FF0000">{</font>
        <i><font color="#9A1900">//g_print("dividends = ");</font></i>

        <b><font color="#0000FF">for</font></b><font color="#990000">(</font> std<font color="#990000">::</font>vector<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">&gt;::</font><font color="#008080">iterator</font> it <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>amounts<font color="#990000">.</font><b><font color="#000000">begin</font></b><font color="#990000">();</font> it <font color="#990000">!=</font> dat<font color="#990000">-&gt;</font>amounts<font color="#990000">.</font><b><font color="#000000">end</font></b><font color="#990000">();</font> <font color="#990000">++</font>it<font color="#990000">)</font>
        <font color="#FF0000">{</font>
          <i><font color="#9A1900">//g_print("%lf ", *it);</font></i>
        <font color="#FF0000">}</font>

        <i><font color="#9A1900">//g_print("\ntimes = ");</font></i>

        <b><font color="#0000FF">for</font></b><font color="#990000">(</font> std<font color="#990000">::</font>vector<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">&gt;::</font><font color="#008080">iterator</font> it <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>times<font color="#990000">.</font><b><font color="#000000">begin</font></b><font color="#990000">();</font> it <font color="#990000">!=</font> dat<font color="#990000">-&gt;</font>times<font color="#990000">.</font><b><font color="#000000">end</font></b><font color="#990000">();</font> <font color="#990000">++</font>it<font color="#990000">)</font>
        <font color="#FF0000">{</font>
          <i><font color="#9A1900">//g_print("%lf ", *it);</font></i>
        <font color="#FF0000">}</font>

        <i><font color="#9A1900">//g_print("\n");</font></i>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_european_call_dividends"</font><font color="#990000">,</font> <font color="#993399">5</font><font color="#990000">,</font>
                                            <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font>               
                                            <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>
                                            <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>
                                            <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,</font>           
                                            <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_european_call_dividends</font></b><font color="#990000">(</font> price<font color="#990000">,</font>               
                                            strike<font color="#990000">,</font>
                                            rate<font color="#990000">,</font>
                                            volatility<font color="#990000">,</font>           
                                            t<font color="#990000">,</font>
                                            dat<font color="#990000">-&gt;</font>times<font color="#990000">,</font>
                                            dat<font color="#990000">-&gt;</font>amounts<font color="#990000">);</font>

      <b><font color="#000000">pthread_mutex_unlock</font></b><font color="#990000">(&amp;</font>dat<font color="#990000">-&gt;</font>mutexCashflow<font color="#990000">);</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900">    case AMDISDIVSBINOMIAL:</font></i>
<i><font color="#9A1900">      {</font></i>

<i><font color="#9A1900">      pthread_mutex_lock(&amp;dat-&gt;mutexCashflow);</font></i>

<i><font color="#9A1900">      if(dat-&gt;debug)</font></i>
<i><font color="#9A1900">      {</font></i>
<i><font color="#9A1900">        //g_print("dividends = ");</font></i>

<i><font color="#9A1900">        for( std::vector&lt;double&gt;::iterator it = dat-&gt;amounts.begin(); it != dat-&gt;amounts.end(); ++it)</font></i>
<i><font color="#9A1900">        {</font></i>
<i><font color="#9A1900">          //g_print("%lf ", *it);</font></i>
<i><font color="#9A1900">        }</font></i>

<i><font color="#9A1900">        //g_print("\ntimes = ");</font></i>

<i><font color="#9A1900">        for( std::vector&lt;double&gt;::iterator it = dat-&gt;times.begin(); it != dat-&gt;times.end(); ++it)</font></i>
<i><font color="#9A1900">        {</font></i>
<i><font color="#9A1900">          //g_print("%lf ", *it);</font></i>
<i><font color="#9A1900">        }</font></i>

<i><font color="#9A1900">        //g_print("\n");</font></i>
<i><font color="#9A1900">      }</font></i>

<i><font color="#9A1900">      if(dat-&gt;debug)</font></i>
<i><font color="#9A1900">        logger( (char *)"option_price_call_american_discrete_dividends_binomial", 6,</font></i>
<i><font color="#9A1900">                                                                          (double)price,</font></i>
<i><font color="#9A1900">                                                                          (double)strike,</font></i>
<i><font color="#9A1900">                                                                          (double)rate,</font></i>
<i><font color="#9A1900">                                                                          (double)volatility,</font></i>
<i><font color="#9A1900">                                                                          (double)t,</font></i>
<i><font color="#9A1900">                                                                          (double)dat-&gt;steps);</font></i>

<i><font color="#9A1900">      callprice = option_price_call_american_discrete_dividends_binomial( price,</font></i>
<i><font color="#9A1900">                                                                          strike,</font></i>
<i><font color="#9A1900">                                                                          rate,</font></i>
<i><font color="#9A1900">                                                                          volatility,</font></i>
<i><font color="#9A1900">                                                                          t,</font></i>
<i><font color="#9A1900">                                                                          dat-&gt;steps,</font></i>
<i><font color="#9A1900">                                                                          dat-&gt;times, </font></i>
<i><font color="#9A1900">                                                                          dat-&gt;amounts);</font></i>

<i><font color="#9A1900">      pthread_mutex_unlock(&amp;dat-&gt;mutexCashflow);</font></i>

<i><font color="#9A1900">      }</font></i>

<i><font color="#9A1900">      break;</font></i>
<i><font color="#9A1900">*/</font></i>

    <b><font color="#0000FF">case</font></b> AMPROPORTDIVSBINOMIAL<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <b><font color="#000000">pthread_mutex_lock</font></b><font color="#990000">(&amp;</font>dat<font color="#990000">-&gt;</font>mutexCashflow<font color="#990000">);</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
      <font color="#FF0000">{</font>
        <i><font color="#9A1900">//g_print("dividends = ");</font></i>

        <b><font color="#0000FF">for</font></b><font color="#990000">(</font> std<font color="#990000">::</font>vector<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">&gt;::</font><font color="#008080">iterator</font> it <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>amounts<font color="#990000">.</font><b><font color="#000000">begin</font></b><font color="#990000">();</font> it <font color="#990000">!=</font> dat<font color="#990000">-&gt;</font>amounts<font color="#990000">.</font><b><font color="#000000">end</font></b><font color="#990000">();</font> <font color="#990000">++</font>it<font color="#990000">)</font>
        <font color="#FF0000">{</font>
          <i><font color="#9A1900">//g_print("%lf ", *it);</font></i>
        <font color="#FF0000">}</font>

        <i><font color="#9A1900">//g_print("\ntimes = ");</font></i>

        <b><font color="#0000FF">for</font></b><font color="#990000">(</font> std<font color="#990000">::</font>vector<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">&gt;::</font><font color="#008080">iterator</font> it <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>times<font color="#990000">.</font><b><font color="#000000">begin</font></b><font color="#990000">();</font> it <font color="#990000">!=</font> dat<font color="#990000">-&gt;</font>times<font color="#990000">.</font><b><font color="#000000">end</font></b><font color="#990000">();</font> <font color="#990000">++</font>it<font color="#990000">)</font>
        <font color="#FF0000">{</font>
          <i><font color="#9A1900">//g_print("%lf ", *it);</font></i>
        <font color="#FF0000">}</font>
        <i><font color="#9A1900">//g_print("\n");</font></i>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_call_american_proportional_dividends_binomial"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                                                                             <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font>
                                                                             <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>
                                                                             <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>
                                                                             <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,</font>
                                                                             <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font>
                                                                             <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_call_american_proportional_dividends_binomial</font></b><font color="#990000">(</font> price<font color="#990000">,</font>
                                                                              strike<font color="#990000">,</font>
                                                                              rate<font color="#990000">,</font>
                                                                              volatility<font color="#990000">,</font>
                                                                              t<font color="#990000">,</font>
                                                                              dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font> 
                                                                              dat<font color="#990000">-&gt;</font>times<font color="#990000">,</font> 
                                                                              <i><font color="#9A1900">//dat-&gt;dividend_yields);</font></i>
                                                                              dat<font color="#990000">-&gt;</font>amounts<font color="#990000">);</font>

      <b><font color="#000000">pthread_mutex_unlock</font></b><font color="#990000">(&amp;</font>dat<font color="#990000">-&gt;</font>mutexCashflow<font color="#990000">);</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BERMUDIANBINOMIAL<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <b><font color="#000000">pthread_mutex_lock</font></b><font color="#990000">(&amp;</font>dat<font color="#990000">-&gt;</font>mutexCashflow<font color="#990000">);</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
      <font color="#FF0000">{</font>
        <i><font color="#9A1900">//g_print("times = ");</font></i>

        <b><font color="#0000FF">for</font></b><font color="#990000">(</font> std<font color="#990000">::</font>vector<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">&gt;::</font><font color="#008080">iterator</font> it <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>times<font color="#990000">.</font><b><font color="#000000">begin</font></b><font color="#990000">();</font> it <font color="#990000">!=</font> dat<font color="#990000">-&gt;</font>times<font color="#990000">.</font><b><font color="#000000">end</font></b><font color="#990000">();</font> <font color="#990000">++</font>it<font color="#990000">)</font>
        <font color="#FF0000">{</font>
          <i><font color="#9A1900">//g_print("%lf ", *it);</font></i>
        <font color="#FF0000">}</font>

        <i><font color="#9A1900">//g_print("\n");</font></i>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_call_bermudan_binomial"</font><font color="#990000">,</font> <font color="#993399">6</font><font color="#990000">,</font>
                                                      <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font>
                                                      <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>
                                                      <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>
                                                      <i><font color="#9A1900">//dividend,</font></i>
                                                      <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>
                                                      <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,</font>
                                                      <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t <font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_call_bermudan_binomial</font></b><font color="#990000">(</font> price<font color="#990000">,</font>
                                                      strike<font color="#990000">,</font>
                                                      rate<font color="#990000">,</font>
                                                      <i><font color="#9A1900">//dividend,</font></i>
                                                      dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>
                                                      volatility<font color="#990000">,</font>
                                                      t<font color="#990000">,</font>
                                                      <i><font color="#9A1900">//potential_exercise_times,</font></i>
                                                      dat<font color="#990000">-&gt;</font>times<font color="#990000">,</font>
                                                      dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

      <b><font color="#000000">pthread_mutex_unlock</font></b><font color="#990000">(&amp;</font>dat<font color="#990000">-&gt;</font>mutexCashflow<font color="#990000">);</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BSCOUPONBOND<font color="#990000">:</font>
      <font color="#FF0000">{</font>

      <b><font color="#000000">pthread_mutex_lock</font></b><font color="#990000">(&amp;</font>dat<font color="#990000">-&gt;</font>mutexCashflow<font color="#990000">);</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
      <font color="#FF0000">{</font>
        <i><font color="#9A1900">//g_print("dividends = ");</font></i>

        <b><font color="#0000FF">for</font></b><font color="#990000">(</font> std<font color="#990000">::</font>vector<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">&gt;::</font><font color="#008080">iterator</font> it <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>amounts<font color="#990000">.</font><b><font color="#000000">begin</font></b><font color="#990000">();</font> it <font color="#990000">!=</font> dat<font color="#990000">-&gt;</font>amounts<font color="#990000">.</font><b><font color="#000000">end</font></b><font color="#990000">();</font> <font color="#990000">++</font>it<font color="#990000">)</font>
        <font color="#FF0000">{</font>
          <i><font color="#9A1900">//g_print("%lf ", *it);</font></i>
        <font color="#FF0000">}</font>

        <i><font color="#9A1900">//g_print("\ntimes = ");</font></i>

        <b><font color="#0000FF">for</font></b><font color="#990000">(</font> std<font color="#990000">::</font>vector<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">&gt;::</font><font color="#008080">iterator</font> it <font color="#990000">=</font> dat<font color="#990000">-&gt;</font>times<font color="#990000">.</font><b><font color="#000000">begin</font></b><font color="#990000">();</font> it <font color="#990000">!=</font> dat<font color="#990000">-&gt;</font>times<font color="#990000">.</font><b><font color="#000000">end</font></b><font color="#990000">();</font> <font color="#990000">++</font>it<font color="#990000">)</font>
        <font color="#FF0000">{</font>
          <i><font color="#9A1900">//g_print("%lf ", *it);</font></i>
        <font color="#FF0000">}</font>

        <i><font color="#9A1900">//g_print("\n");</font></i>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"bond_option_price_call_coupon_bond_black_scholes"</font><font color="#990000">,</font> <font color="#993399">5</font><font color="#990000">,</font>
                                                                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font>
                                                                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>
                                                                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>
                                                                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,</font>
                                                                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t <font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">bond_option_price_call_coupon_bond_black_scholes</font></b><font color="#990000">(</font> price<font color="#990000">,</font>
                                                                   strike<font color="#990000">,</font>
                                                                     rate<font color="#990000">,</font>
                                                               volatility<font color="#990000">,</font>
                                                                        t<font color="#990000">,</font>
                                                           <i><font color="#9A1900">//coupon_times,</font></i>
                                                                <i><font color="#9A1900">//coupons);</font></i>
                                                      dat<font color="#990000">-&gt;</font>times<font color="#990000">,</font> 
                                                     dat<font color="#990000">-&gt;</font>amounts<font color="#990000">);</font>

      <b><font color="#000000">pthread_mutex_unlock</font></b><font color="#990000">(&amp;</font>dat<font color="#990000">-&gt;</font>mutexCashflow<font color="#990000">);</font>

      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMFINITEDIFFEXP<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_call_american_finite_diff_explicit"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_call_american_finite_diff_explicit</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
 
    <b><font color="#0000FF">case</font></b> EUROFINITEDIFFEXP<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_call_european_finite_diff_explicit"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_call_european_finite_diff_explicit</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#ifdef</font></b> HAVE_NEWMAT_NEWMAT_H

    <b><font color="#0000FF">case</font></b> AMFINDIFFIMP<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_call_american_finite_diff_implicit"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_call_american_finite_diff_implicit</font></b><font color="#990000">(</font>price<font color="#990000">,</font>
                                                                 strike<font color="#990000">,</font>
                                                                   rate<font color="#990000">,</font> 
                                                             volatility<font color="#990000">,</font>
                                                                      t<font color="#990000">,</font> 
                                                             dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>
                                                              dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> EURFINDDIFFIMP<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_call_european_finite_diff_implicit"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">option_price_call_european_finite_diff_implicit</font></b><font color="#990000">(</font>price<font color="#990000">,</font>
                                                                 strike<font color="#990000">,</font>
                                                                   rate<font color="#990000">,</font> 
                                                             volatility<font color="#990000">,</font>
                                                                      t<font color="#990000">,</font> 
                                                             dat<font color="#990000">-&gt;</font>steps<font color="#990000">,</font>
                                                              dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> HAVE_ITPP_ITBASE_H

    <b><font color="#0000FF">case</font></b> AMFINDIFFIMPPUT<font color="#990000">:</font>

      callprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

    <b><font color="#0000FF">case</font></b> WARRANT_NO_DIV<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"warrant_price_adjusted_black_scholes"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">warrant_price_adjusted_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> WARRANT_DIV<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"warrant_price_adjusted_black_scholes"</font><font color="#990000">,</font> <font color="#993399">8</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dividend<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">);</font>

      callprice <font color="#990000">=</font> <b><font color="#000000">warrant_price_adjusted_black_scholes</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>rate<font color="#990000">,</font>dividend<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> AMBINOMIAL<font color="#990000">:</font>
      <font color="#FF0000">{</font>
        <font color="#009900">double</font> <font color="#990000">(*</font>fun<font color="#990000">)(</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;,</font><b><font color="#0000FF">const</font></b> <font color="#009900">double</font><font color="#990000">&amp;);</font>

        <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_call<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_cash_or_nothing_call<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">3</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_asset_or_nothing_call<font color="#990000">;</font>
        <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b><font color="#990000">(</font> dat<font color="#990000">-&gt;</font>UsePound <font color="#990000">==</font> <font color="#993399">4</font> <font color="#990000">)</font>
          fun <font color="#990000">=</font> <font color="#990000">&amp;</font>payoff_binary_call<font color="#990000">;</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"option_price_generic_binomial"</font><font color="#990000">,</font> <font color="#993399">7</font><font color="#990000">,</font>
                <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UsePound<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>volatility<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

        callprice <font color="#990000">=</font> <b><font color="#000000">option_price_generic_binomial</font></b><font color="#990000">(</font>price<font color="#990000">,</font>strike<font color="#990000">,</font>fun<font color="#990000">,</font>rate<font color="#990000">,</font>volatility<font color="#990000">,</font>t<font color="#990000">,</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>
      <font color="#FF0000">}</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <b><font color="#0000FF">case</font></b> BOND_ZERO_AM_RENDLEMAN_BARTTER<font color="#990000">:</font>

      <b><font color="#0000FF">if</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>debug<font color="#990000">)</font>
        <b><font color="#000000">logger</font></b><font color="#990000">(</font> <font color="#990000">(</font><font color="#009900">char</font> <font color="#990000">*)</font><font color="#FF0000">"bond_option_price_call_zero_american_rendleman_bartter"</font><font color="#990000">,</font> <font color="#993399">8</font><font color="#990000">,</font>
                      <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>strike<font color="#990000">,</font>
                      <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> t2<font color="#990000">),</font>
                      <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>
                      <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>
                      <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>rate<font color="#990000">,</font>
                      <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>t<font color="#990000">,</font>
                      <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>price<font color="#990000">,</font>
                      <font color="#990000">(</font><font color="#009900">double</font><font color="#990000">)</font>dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>


      callprice <font color="#990000">=</font> <b><font color="#000000">bond_option_price_call_zero_american_rendleman_bartter</font></b><font color="#990000">(</font>
                      strike<font color="#990000">,</font>
                      <font color="#990000">(</font>t2 <font color="#990000">&gt;</font> t <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> t2<font color="#990000">),</font>
                      dat<font color="#990000">-&gt;</font>UseB<font color="#990000">,</font>
                      dat<font color="#990000">-&gt;</font>UseZ<font color="#990000">,</font>
                      rate<font color="#990000">,</font>
                      t<font color="#990000">,</font>
                      price<font color="#990000">,</font>
                      dat<font color="#990000">-&gt;</font>steps<font color="#990000">);</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifdef</font></b> DUMMYTESTMODELS

    <b><font color="#0000FF">case</font></b> TESTOPTION1<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> TESTOPTION2<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> TESTOPTION3<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> TESTOPTION4<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> TESTOPTIONONEDIVIDEND1<font color="#990000">:</font>
    <b><font color="#0000FF">case</font></b> TESTOPTIONONEDIVIDEND2<font color="#990000">:</font>

      callprice <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>

      <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
<b><font color="#000080">#endif</font></b>
   
<b><font color="#008080">    default:</font></b>

      <b><font color="#000000">fprintf</font></b><font color="#990000">(</font>stderr<font color="#990000">,</font><font color="#FF0000">"option_call(): No implementation for case %d</font><font color="#CC33CC">\n</font><font color="#FF0000">"</font><font color="#990000">,</font>dat<font color="#990000">-&gt;</font>modeltype<font color="#990000">);</font>

     <b><font color="#0000FF">break</font></b><font color="#990000">;</font>

    <font color="#FF0000">}</font>

  dat<font color="#990000">-&gt;</font>call <font color="#990000">=</font> callprice<font color="#990000">;</font>

  <b><font color="#0000FF">if</font></b><font color="#990000">(</font><b><font color="#000000">isnan</font></b><font color="#990000">(</font>dat<font color="#990000">-&gt;</font>call<font color="#990000">))</font>
  <font color="#FF0000">{</font>
    dat<font color="#990000">-&gt;</font>isnan <font color="#990000">=</font> <font color="#993399">1</font><font color="#990000">;</font>
  <font color="#FF0000">}</font>

  <b><font color="#0000FF">if</font></b><font color="#990000">(</font>properties<font color="#990000">.</font>filterNegativePrices <font color="#990000">==</font> <b><font color="#0000FF">true</font></b> <font color="#990000">&amp;&amp;</font> dat<font color="#990000">-&gt;</font>call <font color="#990000">&lt;</font> <font color="#993399">0.0</font> <font color="#990000">&amp;&amp;</font>
     properties<font color="#990000">.</font>distribution_type<font color="#990000">==</font>NORMAL_DISTRIBUTION<font color="#990000">)</font>
  <font color="#FF0000">{</font>
    dat<font color="#990000">-&gt;</font>call <font color="#990000">=</font> <font color="#993399">0.0</font><font color="#990000">;</font>
  <font color="#FF0000">}</font>

  <font color="#FF0000">}</font>

  <b><font color="#0000FF">catch</font></b> <font color="#990000">(</font>exception<font color="#990000">&amp;</font> e<font color="#990000">)</font>
  <font color="#FF0000">{</font>
    <i><font color="#9A1900">//g_print("option_call(): Exception caught: %s\n", e.what() );</font></i>
    <i><font color="#9A1900">//g_print("P = %f, X = %f, R = %f, V = %f, t = %f, Div = %f\n", price,strike,rate,volatility,t,dividend);</font></i>

    <i><font color="#9A1900">// program might not be recoverable...</font></i>
    <b><font color="#000000">fflush</font></b><font color="#990000">(</font>NULL<font color="#990000">);</font>

    <i><font color="#9A1900">// a number implies probability...force NaN price since exception</font></i>
    dat<font color="#990000">-&gt;</font>call <font color="#990000">=</font> <b><font color="#000000">sqrt</font></b><font color="#990000">(-</font><font color="#993399">1</font><font color="#990000">);</font>
  <font color="#FF0000">}</font>

  <b><font color="#0000FF">return</font></b> <font color="#990000">*</font>dat<font color="#990000">;</font>
<font color="#FF0000">}</font>
</tt></pre>
